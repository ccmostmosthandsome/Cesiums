{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/external \"Cesium\"","webpack://[name]/./src/index.js","webpack://[name]/./src/Core/Cartesian3s.js","webpack://[name]/./src/Core/EventSystem.js","webpack://[name]/./src/Util/NormalUtils.js","webpack://[name]/./src/Scene/Cameras.js","webpack://[name]/./src/Util/TypeUtils.js","webpack://[name]/./src/DataSources/DazzlingLabelEntity.js","webpack://[name]/./src/Util/Math.js","webpack://[name]/./src/DataSources/EditableEntity.js","webpack://[name]/./src/ThirdParty/ChoiceHelper.js","webpack://[name]/./src/ThirdParty/DrawHelper.js","webpack://[name]/(webpack)/buildin/module.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Cameras","Cartesian3s","eventSystem","DazzlingLabelEntity","EditableEntity","ChoiceHelper","drawHelper","DrawHelper","Cesium","cartesian3","Cartographic","fromCartesian","cartographic","toRadians","height","latitude","Math","toDegrees","longitude","heightPlus","arguments","length","undefined","Cartesian3","fromRadians","_NormalUtils","_TypeUtils","EventSystem","accuracy","_classCallCheck","this","_init","_accuracy","viewer","defined","eventBind","_this","handler","ScreenSpaceEventHandler","scene","canvas","setInputAction","movement","callPrimitiveCallback","position","ScreenSpaceEventType","LEFT_CLICK","LEFT_DOUBLE_CLICK","MOUSE_MOVE","LEFT_UP","LEFT_DOWN","eventName","pickedObject","pick","primitive","typeContaines","id","obj","type","callback","setListener","EventType","freeze","getWithDefault","element","defaultElement","camera","isType","instance","typeName","_typeof","constructor","toString","match","typeMatchGroup","indexOf","getType","_Cartesian3s","_EventSystem","_Math","config","simpleCos","SimpleCosBuilder","setPeriod","setAmplitude","setPhase","build","startTime","JulianDate","now","semiMajorAxis","semiMinorAxis","CallbackProperty","time","result","onSelected","calc","secondsDifference","fill","outline","outlineWidth","outlineColor","Color","RED","show","positions","formatHeightZero","_possibleConstructorReturn","__proto__","getPrototypeOf","initEvent","Entity","_this2","onLeftClick","onClickCallback","selected","SimpleSin","A","k","b","_createClass","x","sin","SimpleSinBuilder","number","PI","cos","console","log","_index","_cesiumViewer","util","Util","_scene","_drawHelper","_option","_afterClick","callbacks","afterClick","_primitives","lastOnclick","me","toolbar","container","_toolbarContainer","_toolbar","addToolbar","buttons","clickCallback","event","forEach","index","primitives","remove","pickStrategy","dom","error","document","body","polygon","onclick","e","startDrawingPolygon","self","executeListeners","strategy","polyline","startDrawingPolyline","marker","startDrawingMarker","extent","startDrawingExtent","circle","startDrawingCircle","center","radius","clear","cancel","stopDrawing","_eventInit","pickPositionSupported","pickPosition","pickEllipsoid","_viewer","_ellipsoid","globe","_optionReload","addListener","PolygonPrimitive","material","Material","fromType","LatLngPaths","push","Cartesian3ToLatLng","_filterExecuter","entities","parseEntities","entity","latlng","getValue","_isInPolygon","groundPosition","distance","getCesiumHightZero","cartesian3ToLatLng","west","east","south","north","setOption","option","_callBack","containsCallback","containEntities","values","choice","index2","filter","onChoice","cartesianToCartographic","Cartesian3ToDegrees","formatHetightPlusNumber","paths","isum","icount","y","dLon1","dLon2","dLat1","dLat2","size","abs","ellipsoid","Ellipsoid","WGS84","defaultPickStrategy","_","cesiumWidget","frameDiv","tooltip","_tooltip","div","createElement","className","arrow","appendChild","title","_div","_title","addEvent","setVisible","visible","style","display","showAt","message","innerHTML","count","addEventListener","ev","left","offsetX","top","offsetY","clientHeight","_surfaces","ContextLimits","_maximumAliasedLineWidth","initialiseHandlers","enhancePrimitives","enhanceWithListeners","mouseOutObject","_self","_handlersMuted","endPosition","isDestroyed","mouseOut","mouseMove","muteHandlers","muted","registerEditableShape","surface","setHighlighted","_editMode","setEditMode","startDrawing","cleanUp","disableAllEditMode","editCleanUp","disableAllHighlights","_highlightedSurface","setEdited","_editedSurface","ColorType","uniforms","color","defaultShapeOptions","textureRotationAngle","asynchronous","debugShowBoundingVolume","defaultSurfaceOptions","copyOptions","appearance","EllipsoidSurfaceAppearance","aboveGround","granularity","defaultPolygonOptions","defaultExtentOptions","defaultCircleOptions","defaultEllipseOptions","rotation","defaultPolylineOptions","width","geodesic","PolylineMaterialAppearance","ChangeablePrimitive","initialiseOptions","options","fillOptions","_granularity","_height","_textureRotationAngle","_id","_createPrimitive","_primitive","_outlinePolygon","setAttribute","getAttribute","update","context","frameState","commandList","DeveloperError","geometry","getGeometry","destroy","Primitive","geometryInstances","GeometryInstance","pickPrimitive","strokeColor","getOutlineGeometry","attributes","ColorGeometryInstanceAttribute","fromColor","PerInstanceColorAppearance","flat","renderState","depthTest","enabled","lineWidth","min","strokeWidth","destroyObject","setStrokeStyle","equals","ExtentPrimitive","setExtent","getExtent","RectangleGeometry","rectangle","vertexFormat","VERTEX_FORMAT","stRotation","RectangleOutlineGeometry","isPolygon","setPositions","getPositions","PolygonGeometry","fromPositions","PolygonOutlineGeometry","CirclePrimitive","setRadius","setCenter","max","getCenter","getRadius","CircleGeometry","CircleOutlineGeometry","EllipsePrimitive","setSemiMajorAxis","getSemiMinorAxis","setSemiMinorAxis","getSemiMajorAxis","setRotation","getRotation","_ref","EllipseGeometry","_defineProperty","EllipseOutlineGeometry","PolylinePrimitive","setWidth","setGeodesic","getWidth","getGeodesic","PolylineGeometry","defaultBillboard","iconUrl","shiftX","shiftY","dragBillboard","getExtentCorners","cartographicArrayToCartesianArray","Rectangle","northwest","northeast","southeast","southwest","mn","mx","epsilon","EPSILON7","clone","from","to","Array","Date","RegExp","Function","String","Number","Boolean","defaultOptions","newOptions","_listeners","defaultCallback","cesium3","createBillboardGroup","points","markers","BillboardGroup","addBillboards","_options","BillboardCollection","add","_billboards","_orderedBillboards","createBillboard","billboard","pixelOffset","Cartesian2","eyeOffset","horizontalOrigin","HorizontalOrigin","CENTER","verticalOrigin","VerticalOrigin","scale","image","enableRotation","enable","screenSpaceCameraController","enableRotate","getIndex","I","dragHandlers","onDragEnd","cartesian","onDrag","onDragStart","onDoubleClick","onClick","insertBillboard","splice","addBillboard","updateBillboardsPositions","getBillboard","countBillboards","removeBillboard","removeAll","setOnTop","raiseToTop","mouseHandler","precision","toFixed","startDrawingPolyshape","poly","minPoints","pop","firstPoint","updateExtent","corners","highlighted","_highlighted","_strokeColor","fromCssColorString","editMode","_markers","updateHalfMarkers","editIndex","editMarkers","calculateHalfMarkerPosition","onEdited","cartographicToCartesian","EllipsoidGeodesic","interpolateUsingFraction","thisDragBillboard","thisDragHalfBillboard","dragHalfBillboard","handleMarkerChanges","halfPositions","handleEditMarkerChanges","_editMarkers","_globeClickhandler","Billboard","setEditable","_editable","editable","modeType","originalWidth","Extent","fromCartographicArray","cartesianArrayToCartographicArray","corner","ellipse","getMarkerPositions","Shapes","computeEllipseBoundary","getCircleCartesianCoordinates","createGeometry","PI_OVER_TWO","DrawHelperWidget","drawOptions","markerIcon","polylineIcon","polygonIcon","circleIcon","extentIcon","clearIcon","polylineDrawingOptions","polygonDrawingOptions","extentDrawingOptions","circleDrawingOptions","addIcon","url","__WEBPACK_AMD_DEFINE_RESULT__","__WEBPACK_AMD_DEFINE_FACTORY__","apply","__WEBPACK_AMD_DEFINE_ARRAY__","webpackPolyfill","deprecate","children"],"mappings":"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","file":"Cesiums.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Cesium\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Cesium\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Cesiums\"] = factory(require(\"Cesium\"));\n\telse\n\t\troot[\"Cesiums\"] = factory(root[\"Cesium\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","/**\r\n * 用于组织管理输出,打包输出的内容依赖此文件的输出\r\n */\r\n/*Scene*/\r\nexport {Cameras} from \"./Scene/Cameras\"\r\nimport \"./Scene/Cameras.css\"\r\n\r\n/*Core*/\r\nexport {Cartesian3s} from \"./Core/Cartesian3s\"\r\nexport {eventSystem} from \"./Core/EventSystem\"\r\n\r\n\r\n/*DataSources*/\r\nexport {DazzlingLabelEntity} from \"./DataSources/DazzlingLabelEntity\"\r\nexport {EditableEntity} from \"./DataSources/EditableEntity\"\r\n\r\n\r\n/*ThirdParty*/\r\nimport * as drawHelper from \"./ThirdParty/DrawHelper\";\r\nexport const DrawHelper = drawHelper;\r\n\r\nexport {ChoiceHelper} from \"./ThirdParty/ChoiceHelper\"\r\n\r\nimport \"./ThirdParty/DrawHelper.css\"\r\n\r\n\r\n\r\n","import * as Cesium from \"Cesium\";\r\n\r\nexport class Cartesian3s {\r\n\r\n    /**\r\n     * 将地球坐标系基于WSG84椭球体转换成经纬度（弧度制）\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     * @returns {{height: *, latitude: *, longitude: *}}\r\n     */\r\n    static toRadians(cartesian3){\r\n        return Cesium.Cartographic.fromCartesian(cartesian3);\r\n    }\r\n\r\n    /**\r\n     * 输出角度单位的经纬度\r\n     * @param {Cesium.Cartesian3}  cartesian3\r\n     * @returns {{height: *, latitude: *, longitude: *}}\r\n     */\r\n    static toDegrees(cartesian3){\r\n        let cartographic = Cartesian3s.toRadians(cartesian3);\r\n        return {\r\n            height: cartographic.height,\r\n            latitude: Cesium.Math.toDegrees(cartographic.latitude),\r\n            longitude: Cesium.Math.toDegrees(cartographic.longitude)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 修正当前点位的高度\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     * @param {number} heightPlus - 修正高度，默认为5\r\n     */\r\n    static formatHeightPlus(cartesian3, heightPlus = 5) {\r\n        let fromCartesian = Cartesian3s.toRadians(cartesian3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, fromCartesian.height + heightPlus);\r\n    }\r\n\r\n    /**\r\n     * 修正当前点位的高度到0\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     */\r\n    static formatHeightZero(cartesian3){\r\n        let fromCartesian = Cartesian3s.toRadians(cartesian3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n\r\n}","import * as Cesium from \"Cesium\";\r\nimport {defined} from \"../Util/NormalUtils\"\r\nimport {typeContaines} from \"../Util/TypeUtils\"\r\n\r\n/**\r\n * 接管Cesium的事件系统（对于entity和primitive）\r\n */\r\n\r\nclass EventSystem {\r\n\r\n    constructor(accuracy = 3) {\r\n        this._init = false;\r\n        this._accuracy = accuracy;\r\n    }\r\n\r\n    /**\r\n     * 单地图\r\n     * @param viewer\r\n     */\r\n    setView(viewer) {\r\n        if (!this._init) {\r\n            this.viewer = viewer;\r\n            if (defined(viewer)) {\r\n                this._init = true;\r\n                this.eventBind();\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n\r\n    setAccuracy(value = 3) {\r\n        this._accuracy = value;\r\n        return this;\r\n    }\r\n\r\n    eventBind() {\r\n        let handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftClick', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftDoubleClick', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n\r\n        handler.setInputAction((movement) => {\r\n\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftUp', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftDown', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n    }\r\n\r\n    callPrimitiveCallback(eventName, position) {\r\n        let pickedObject = this.viewer.scene.pick(position, this._accuracy, this._accuracy);\r\n        //primitive\r\n        if (pickedObject && pickedObject.primitive && pickedObject.primitive[eventName]) {\r\n            pickedObject.primitive[eventName](position);\r\n        }\r\n        //entity\r\n        if (pickedObject && typeContaines(pickedObject.id, \"Entity\") && pickedObject.id[eventName]) {\r\n            pickedObject.id[eventName](position);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {Cesium.Entity | Cesium.Primitive} obj\r\n     * @param {string} type\r\n     * @param callback\r\n     */\r\n    setListener(obj, type, callback) {\r\n        if (defined(obj) && defined(type) && (typeof callback === \"function\")) {\r\n            obj[type] = callback;\r\n        }\r\n    }\r\n    //pass\r\n    onLeftClick(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_CLICK, callback);\r\n    }\r\n\r\n    onLeftDoubleClick(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_DOUBLE_CLICK, callback);\r\n    }\r\n\r\n    onMouseMove(obj, callback) {\r\n        this.setListener(obj, EventType.MOUSE_MOVE, callback);\r\n    }\r\n\r\n    onLeftUp(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_UP, callback);\r\n    }\r\n\r\n    onLeftDown(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_DOWN, callback);\r\n    }\r\n}\r\n\r\nconst EventType = Object.freeze({\r\n    LEFT_CLICK: \"leftClick\",\r\n    LEFT_DOUBLE_CLICK: \"leftDoubleClick\",\r\n    MOUSE_MOVE: \"mouseMove\",\r\n    LEFT_UP: \"leftUp\",\r\n    LEFT_DOWN: \"leftDown\"\r\n})\r\n\r\nexport const eventSystem = new EventSystem();\r\n","export const getWithDefault = (element, defaultElement) => {\r\n    return defined(element) ? element : defaultElement;\r\n}\r\n\r\nexport const defined = (element) =>{\r\n    return element !== null && element !== undefined;\r\n}\r\n\r\n","\r\nexport class Cameras {\r\n    constructor(camera) {\r\n    }\r\n}","import {defined} from \"./NormalUtils\"\r\n\r\nexport const isType = (instance, typeName) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        return instance.constructor.toString().match(/^function\\s*([^\\s(]+)/)[1] === typeName;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * 类名包含\r\n * @param instance\r\n * @param typeName\r\n * @returns {boolean}\r\n */\r\nexport const typeContaines = (instance, typeName) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        let typeMatchGroup = instance.constructor.toString().match(/^function\\s*([^\\s(]+)/);\r\n        if (defined(typeMatchGroup) && defined(typeMatchGroup[1])) {\r\n            return typeMatchGroup[1].indexOf(typeName) !== -1;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport const getType = (instance) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        let typeMatchGroup = instance.constructor.toString().match(/^function\\s*([^\\s(]+)/);\r\n        if (defined(typeMatchGroup) && defined(typeMatchGroup[1])) {\r\n            return typeMatchGroup[1];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n","import * as Cesium from \"Cesium\";\r\nimport {Cartesian3s} from \"../Core/Cartesian3s\";\r\nimport {eventSystem} from \"../Core/EventSystem\"\r\nimport {SimpleCosBuilder, SimpleSinBuilder} from \"../Util/Math\"\r\n\r\nexport class DazzlingLabelEntity extends Cesium.Entity {\r\n    /**\r\n     *\r\n     * @param {Cesium.Entity} entity\r\n     * @param {Object} config\r\n     */\r\n    constructor(config) {\r\n        // let simpleSin = new SimpleSinBuilder().setPeriod(20).setAmplitude(1).setPhase(0).build();\r\n        let simpleCos = new SimpleCosBuilder().setPeriod(5).setAmplitude(-0.5).setPhase(0).build();\r\n        let startTime = Cesium.JulianDate.now();\r\n        config[\"ellipse\"] = {\r\n            semiMajorAxis: 1000,\r\n            semiMinorAxis: 1000,\r\n            height: new Cesium.CallbackProperty((time, result) => {\r\n                if (this.onSelected) {\r\n                    return (0.5 +  simpleCos.calc(Cesium.JulianDate.secondsDifference(Cesium.JulianDate.now(), startTime) % 5) )*  Cartesian3s.toRadians(config.position).height;\r\n                } else {\r\n                    return Cartesian3s.toRadians(config.position).height/2;\r\n                }\r\n            },false),\r\n            // material:Cesium.Color.ALICEBLUE.withAlpha(0) ,\r\n            fill: false,\r\n            outline: true,\r\n            outlineWidth: 20,\r\n            outlineColor: Cesium.Color.RED,\r\n            show: new Cesium.CallbackProperty((time, result) => {\r\n                return this.onSelected;\r\n            },false),\r\n        }\r\n        config[\"polyline\"] = {\r\n            positions: [Cartesian3s.formatHeightZero(config.position), config.position]\r\n        }\r\n        super(config)\r\n        // this.entity = entity;\r\n        this.initEvent();\r\n        this.onSelected = false;\r\n    }\r\n\r\n    initEvent() {\r\n        eventSystem.onLeftClick(this, (position) => {\r\n            // this.onSelected ^= true;//反向\r\n            if (typeof this.onClickCallback === \"function\") {\r\n                this.onClickCallback(position);\r\n            }\r\n        })\r\n    }\r\n\r\n    onClick(callback) {\r\n        this.onClickCallback = callback;\r\n    }\r\n\r\n    setSelected(selected = true){\r\n        this.onSelected = selected;\r\n    }\r\n\r\n    cancelSelected(){\r\n        this.onSelected = false;\r\n    }\r\n}","export const SimpleSin = class {\r\n    constructor(A, k, b) {\r\n        this.A = A;\r\n        this.k = k;\r\n        this.b = b;\r\n        return this;\r\n    }\r\n\r\n    calc(x) {\r\n        return Math.sin(this.k * x + this.b) * this.A;\r\n    }\r\n}\r\n\r\nexport const SimpleSinBuilder = class {\r\n    setPeriod(number) {\r\n        this.k = 2 * Math.PI / number;\r\n        return this;\r\n    }\r\n\r\n    setAmplitude(number) {\r\n        this.A = number;\r\n        return this;\r\n    }\r\n\r\n    setPhase(number) {\r\n        this.b = number;\r\n        return this;\r\n    }\r\n\r\n    build() {\r\n        return new SimpleSin(this.A, this.k, this.b)\r\n    }\r\n}\r\n\r\n\r\nexport const simpleCos = class  {\r\n    constructor(A, k, b) {\r\n        this.A = A;\r\n        this.k = k;\r\n        this.b = b;\r\n        return this;\r\n    }\r\n\r\n    calc(x) {\r\n        return Math.cos(this.k * x + this.b) * this.A;\r\n    }\r\n}\r\n\r\nexport const SimpleCosBuilder = class {\r\n    setPeriod(number) {\r\n        this.k = 2 * Math.PI / number;\r\n        return this;\r\n    }\r\n\r\n    setAmplitude(number) {\r\n        this.A = number;\r\n        return this;\r\n    }\r\n\r\n    setPhase(number) {\r\n        this.b = number;\r\n        return this;\r\n    }\r\n\r\n    build() {\r\n        return new simpleCos(this.A, this.k, this.b)\r\n    }\r\n}","import * as Cesium from \"Cesium\";\r\n\r\nexport class EditableEntity extends Cesium.Entity{\r\n    test(){\r\n        console.log(\"test\");\r\n    }\r\n\r\n    static test2(){\r\n        console.log(\"test2\");\r\n    }\r\n}","/*   if (typeof exports === 'object' && typeof module === 'object')\r\n       module.exports = factory(require('Cesium'), require('DrawHelper'));\r\n   else if (typeof define === 'function' && define.amd)\r\n       define('ChoiceHelper', [ 'Cesium', 'DrawHelper'], factory);\r\n   else {\r\n       root.ChoiceHelper = factory(root.Cesium, root.DrawHelper);\r\n   }*/\r\nimport * as Cesium from \"Cesium\";\r\nimport {DrawHelper} from \"../index\"\r\n\r\n// export const ChoiceHelper =  factory(Cesium,DrawHelper);\r\n\r\n\r\n/**\r\n * @param {Object} config\r\n * @param {Object} config.viewer - Cesium.viewer对象\r\n * @param {Object} config.toolbar - toolbar,为空则不创建\r\n * @param {Element} config.toolbar.container - toolbar所在容器\r\n * @param {string[]} config.toolbar.buttons - 包括 'polygon', 'circle', 'extent' 代表多边形、圆形、矩形\r\n * @param {Object} config.dom - dom事件绑定模式\r\n * @param {Element} config.polygon - 绑定开始画polygon的事件\r\n * @param {Element} config.marker - 绑定开始画marker的事件\r\n * @param {Element} config.extent - 绑定开始画extent的事件\r\n * @param {Element} config.circle - 绑定开始画circle的事件\r\n * @param {Element} config.clear - 清空绘制事件\r\n * @param {Element} config.cancel - 结束绘制事件\r\n * @param {Array} config.callbacks - 选择回调，可配置多种选择回调\r\n * @param {function(Cesium.Entity):boolean} config.callbacks.choice[].filter - 过滤器，即选择器,确认为需要选择的对象，返回ture\r\n * @param {function(Cesium.Entity[])} config.callbacks.choice[].onChoice - 选择回调\r\n * @param {function(Cesium.Cartesian3)} config.callbacks.marker - marker创建回调\r\n * @param {function} config.callbacks.afterClick - 工具栏点击回调\r\n * {\r\n *     viewer: viewer对象,\r\n *     toolbar:{\r\n *         container: toolbar所在容器,\r\n *         buttons: [],//\r\n *     },\r\n *     dom:{//\r\n *             polygon: function | dom ,\r\n *             marker: function | dom ,\r\n *             extent: function | dom ,\r\n *             circle: function | dom ,\r\n *             clear : dom,\r\n *             cancel : dom\r\n *     },\r\n *     callbacks:{\r\n *          choice:[{\r\n *             filter: function\r\n *             onChoice: function\r\n *         }],\r\n *         marker: function,\r\n *         afterClick: function,\r\n *     }\r\n * }\r\n * @constructor\r\n */\r\nexport function ChoiceHelper(config) {\r\n    this._cesiumViewer = config.viewer;\r\n    this.util = new Util(this._cesiumViewer);\r\n\r\n    this._scene = this._cesiumViewer.scene;\r\n    this._drawHelper = new DrawHelper(this._cesiumViewer);\r\n    this._option = config;\r\n    this._afterClick = config.callbacks.afterClick;\r\n\r\n    this._primitives = [];\r\n    var me = this;\r\n\r\n    if (Cesium.defined(config.toolbar) && Cesium.defined(config.toolbar.container)) {\r\n        this._toolbarContainer = config.toolbar.container;\r\n\r\n        this._toolbar = this._drawHelper.addToolbar(this._toolbarContainer, {\r\n            buttons: config.toolbar.buttons,\r\n            clickCallback: function (event) {\r\n                //移除之前绘制的\r\n                me._afterClick && me._afterClick();\r\n                me.util.getWithDefault(me._primitives, []).forEach(function (element, index) {\r\n                    me._scene.primitives.remove(element);\r\n                })\r\n            },\r\n            //点位选取策略配置\r\n            pickStrategy: pickStrategy\r\n        })\r\n    } else if (Cesium.defined(config.dom)) {\r\n        this._toolbar = this._drawHelper.addToolbar(document.body, {buttons: []});\r\n        var toolbar = this._toolbar;\r\n        config.dom.polygon && function () {\r\n            var lastOnclick = config.dom.polygon.onclick;\r\n            config.dom.polygon.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingPolygon({\r\n                    callback: function (positions, self) {\r\n                        toolbar.executeListeners({name: 'polygonCreated', positions: positions});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.polygon).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingPolygon({\r\n            //         callback: function (positions, self) {\r\n            //             toolbar.executeListeners({name: 'polygonCreated', positions: positions});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.polygon && function () {\r\n            var lastOnclick = config.dom.polyline.onclick;\r\n            config.dom.polyline.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingPolyline({\r\n                    callback: function (positions, self) {\r\n                        toolbar.executeListeners({name: 'polylineCreated', positions: positions});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.polyline).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingPolyline({\r\n            //         callback: function (positions, self) {\r\n            //             toolbar.executeListeners({name: 'polylineCreated', positions: positions});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.marker && function () {\r\n            var lastOnclick = config.dom.marker.onclick;\r\n            config.dom.marker.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingMarker({\r\n                    callback: function (position, self) {\r\n                        toolbar.executeListeners({name: 'markerCreated', position: position});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.marker).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingMarker({\r\n            //         callback: function (position, self) {\r\n            //             toolbar.executeListeners({name: 'markerCreated', position: position});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.extent && function () {\r\n            var lastOnclick = config.dom.extent.onclick;\r\n\r\n            config.dom.extent.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingExtent({\r\n                    callback: function (extent, self) {\r\n                        toolbar.executeListeners({name: 'extentCreated', extent: extent});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.extent).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingExtent({\r\n            //         callback: function (extent, self) {\r\n            //             toolbar.executeListeners({name: 'extentCreated', extent: extent});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.circle && function () {\r\n            var lastOnclick = config.dom.circle.onclick;\r\n\r\n            config.dom.circle.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingCircle({\r\n                    callback: function (center, radius, self) {\r\n                        toolbar.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.circle).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingCircle({\r\n            //         callback: function (center, radius, self) {\r\n            //             toolbar.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.clear && function () {\r\n            var lastOnclick = config.dom.clear.onclick;\r\n\r\n            config.dom.clear.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n            }\r\n            // $(config.dom.clear).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //\r\n            // });\r\n        }();\r\n        config.dom.cancel && function () {\r\n            var lastOnclick = config.dom.cancel.onclick;\r\n\r\n            config.dom.cancel.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.stopDrawing()\r\n            }\r\n            // $(config.dom.cancel).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.stopDrawing()\r\n            // });\r\n        }();\r\n    } else {\r\n        console.error(\"传入参数有误！\");\r\n        return;\r\n    }\r\n    this._eventInit();\r\n}\r\n\r\nvar pickStrategy = function (position, viewer) {\r\n    if (Cesium.defined(viewer.scene.pick(position)) && viewer.scene.pickPositionSupported) {\r\n        return viewer.scene.pickPosition(position);\r\n        // var fromCartesian = Cesium.Cartographic.fromCartesian(viewer.scene.pickPosition(position));\r\n        // return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    } else {\r\n        var fromCartesian = Cesium.Cartographic.fromCartesian(viewer.scene.camera.pickEllipsoid(position));\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n};\r\n\r\nChoiceHelper.prototype._optionReload = function () {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._eventInit = function () {\r\n    var me = this;\r\n    me._toolbar.addListener('polygonCreated', function (event) {\r\n        var polygon = new DrawHelper.PolygonPrimitive({\r\n            positions: event.positions,\r\n            material: Cesium.Material.fromType('Checkerboard')\r\n        });\r\n\r\n        console.log(event)\r\n        var LatLngPaths = [];\r\n\r\n        me.util.getWithDefault(event.positions, []).forEach(function (position, index) {\r\n            LatLngPaths.push(me.util.Cartesian3ToLatLng(position));\r\n        });\r\n\r\n\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var latlng = Cesium.Cartographic.fromCartesian(entity.position.getValue(0));\r\n                if (me.util._isInPolygon(latlng, LatLngPaths)) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            });\r\n            return parseEntities;\r\n        })\r\n\r\n\r\n    });\r\n    // circle.center :  Cartesian3\r\n    // circle.ellipsoid._maximumRadius : number\r\n    // circle.ellipsoid._minimumRadius : number\r\n    me._toolbar.addListener('circleCreated', function (event) {\r\n\r\n        // var r = event.radius\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var latlng = Cesium.Cartographic.fromCartesian(entity.position.getValue(0));\r\n                var groundPosition = Cesium.Cartesian3.fromRadians(latlng.longitude, latlng.latitude, 0.0);\r\n                if (Cesium.Cartesian3.distance(me.util.getCesiumHightZero(event.center), groundPosition) <= event.radius) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            })\r\n\r\n            return parseEntities;\r\n        });\r\n    });\r\n\r\n    //Cesium.Rectangle.subsample(e.extent)\r\n    me._toolbar.addListener('extentCreated', function (e) {\r\n        var extent = e.extent;\r\n\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var cartesian3ToLatLng = me.util.Cartesian3ToLatLng(entity.position.getValue(0));\r\n                if (extent.west <= cartesian3ToLatLng.longitude && extent.east >= cartesian3ToLatLng.longitude\r\n                    && extent.south <= cartesian3ToLatLng.latitude && extent.north >= cartesian3ToLatLng.latitude) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            })\r\n\r\n            return parseEntities;\r\n        });\r\n    });\r\n\r\n    me._toolbar.addListener('markerCreated', function (event) {\r\n        me._option.callbacks.marker(event.position);\r\n        // loggingMessage('Marker created at ' + event.position.toString());\r\n        // create one common billboard collection for all billboards\r\n        // var b = new Cesium.BillboardCollection();\r\n        // viewer.scene.primitives.add(b);\r\n        // var billboard = b.add({\r\n        //     show : true,\r\n        //     position : event.position,\r\n        //     pixelOffset : new Cesium.Cartesian2(0, 0),\r\n        //     eyeOffset : new Cesium.Cartesian3(0.0, 0.0, 0.0),\r\n        //     horizontalOrigin : Cesium.HorizontalOrigin.CENTER,\r\n        //     verticalOrigin : Cesium.VerticalOrigin.CENTER,\r\n        //     scale : 1.0,\r\n        //     image: './img/glyphicons_242_google_maps.png',\r\n        //     color : new Cesium.Color(1.0, 1.0, 1.0, 1.0)\r\n        // });\r\n        // billboard.setEditable();\r\n    });\r\n}\r\n\r\n\r\nChoiceHelper.prototype.setOption = function (option) {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._callBack = function () {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._filterExecuter = function (containsCallback) {\r\n    var me = this;\r\n    //选出在圈内的entities\r\n    var containEntities = containsCallback(me._cesiumViewer.entities.values);\r\n\r\n    me.util.getWithDefault(me._option.callbacks.choice, []).forEach(function (callback, index) {\r\n        var entities = [];\r\n        //过滤出需要的entity\r\n        me.util.getWithDefault(containEntities, []).forEach(function (entity, index2) {\r\n            if (callback.filter(entity)) entities.push(entity);\r\n        })\r\n        //callback\r\n        callback.onChoice(entities);\r\n    })\r\n\r\n};\r\n\r\n\r\nfunction Util(viewer) {\r\n    this._viewer = viewer;\r\n    this._ellipsoid = this._viewer.scene.globe._ellipsoid;\r\n}\r\n\r\n/**\r\n * 将Cartesian3转为经纬度\r\n * @param cartesian3\r\n * @returns {{height:number,latitude:number,longitude:number}}\r\n */\r\nUtil.prototype.Cartesian3ToLatLng = function (cartesian3) {\r\n    // return  Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return this._ellipsoid.cartesianToCartographic(cartesian3);\r\n}\r\n/**\r\n * 但是Cesium不支持此类\r\n * @param cartesian3\r\n * @return {{height: *, latitude: *, longitude: *}}\r\n * @constructor\r\n */\r\nUtil.prototype.Cartesian3ToDegrees = function (cartesian3) {\r\n    var cartographic = this._ellipsoid.cartesianToCartographic(cartesian3);\r\n    var degree = {\r\n        height: cartographic.height,\r\n        latitude: Cesium.Math.toDegrees(cartographic.latitude),\r\n        longitude: Cesium.Math.toDegrees(cartographic.longitude)\r\n    }\r\n    return degree;\r\n}\r\n\r\nUtil.prototype.getWithDefault = function (element, defaultElement) {\r\n    return element ? element : defaultElement;\r\n}\r\n\r\n/**\r\n * 获取当前点位的近地点位\r\n * @param {Cesium.Cartesian3} cartesian3\r\n * @return {Cesium.Cartesian3}\r\n */\r\nUtil.prototype.getCesiumHightZero = function (cartesian3) {\r\n    var fromCartesian = Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n}\r\n\r\n/**\r\n * 修正当前点位的高度\r\n * @param {Cesium.Cartesian3} cartesian3\r\n * @param {number} heightPlus\r\n * @return {Cesium.Cartesian3}\r\n */\r\nUtil.prototype.formatHetightPlusNumber = function (cartesian3, heightPlus) {\r\n    var fromCartesian = Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, fromCartesian.height + heightPlus);\r\n\r\n}\r\n\r\n/**\r\n *\r\n * @param position\r\n * @param paths\r\n */\r\nUtil.prototype._isInPolygon = function (position, paths) {\r\n    var x = position.longitude;\r\n    var y = position.latitude;\r\n\r\n    var isum, icount, index = 0;\r\n    var dLon1 = 0, dLon2 = 0, dLat1 = 0, dLat2 = 0, dLon;\r\n\r\n    if (paths.size < 3) {\r\n        return false;\r\n    }\r\n\r\n    isum = 0;\r\n    icount = paths.length;\r\n\r\n    for (index = 0; index < icount - 1; index++) {\r\n        if (index === icount - 1) {\r\n            dLon1 = paths[index].longitude;\r\n            dLat1 = paths[index].latitude;\r\n            dLon2 = paths[0].longitude;\r\n            dLat2 = paths[0].latitude;\r\n        }\r\n        else {\r\n            dLon1 = paths[index].longitude;\r\n            dLat1 = paths[index].latitude;\r\n            dLon2 = paths[index + 1].longitude;\r\n            dLat2 = paths[index + 1].latitude;\r\n        }\r\n\r\n        if (((y >= dLat1) && (y < dLat2)) || ((y >= dLat2) && (y < dLat1))) {\r\n            if (Math.abs(dLat1 - dLat2) > 0) {\r\n                dLon = dLon1 - ((dLon1 - dLon2) * (dLat1 - y)) / (dLat1 - dLat2);\r\n                if (dLon < x)\r\n                    isum++;\r\n            }\r\n        }\r\n    }\r\n\r\n    return (isum % 2) !== 0;\r\n}\r\n\r\n","/**\r\n * Created by thomas on 9/01/14.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * (c) www.geocento.com\r\n * www.metaaps.com\r\n * <pre>\r\n *      update:\r\n *          2018-9-17:\r\n *              - pickStrategy属性兼容性\r\n *              - 适配stopDrawing在未开始标绘的情况\r\n *          2019-9-24:\r\n *              - 对属性带有modeType:billboard的entity加入setEditable(boolean)的方法,用于改变位置\r\n * </pre>\r\n *\r\n */\r\n(function webpackUniversalModuleDefinition(root, factory) {\r\n    if (typeof exports === 'object' && typeof module === 'object')\r\n        module.exports = factory(require('Cesium'));\r\n    else if (typeof define === 'function' && define.amd)\r\n        define('DrawHelper', ['Cesium'], factory);\r\n    else {\r\n        root.DrawHelper = factory(root.Cesium);\r\n    }\r\n}(window, function (Cesium) {\r\n    // static variables\r\n    var ellipsoid = Cesium.Ellipsoid.WGS84;\r\n\r\n    /**\r\n     *\r\n     * @param { Cesium.Cartesian2} position\r\n     * @param {Cesium.Viewer} viewer\r\n     * @return {Cesium.Cartesian3}\r\n     */\r\n    var defaultPickStrategy = function (position, viewer) {\r\n        return viewer.scene.camera.pickEllipsoid(position);\r\n    };\r\n\r\n    // constructor\r\n    function _(cesiumWidget) {\r\n        this._viewer = cesiumWidget;\r\n        this._scene = cesiumWidget.scene;\r\n        this._tooltip = createTooltip(cesiumWidget.container);\r\n        this._surfaces = [];\r\n        //适配\r\n        (Cesium.defined(Cesium.ContextLimits)) && (\r\n            Cesium.ContextLimits._maximumAliasedLineWidth = 10);\r\n\r\n        this.initialiseHandlers();\r\n\r\n        this.enhancePrimitives();\r\n        enhanceWithListeners(this);\r\n    }\r\n\r\n    _.prototype.initialiseHandlers = function () {\r\n        var scene = this._scene;\r\n        var _self = this;\r\n        // scene events\r\n        var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function callPrimitiveCallback(name, position) {\r\n            if (_self._handlersMuted == true) return;\r\n            var pickedObject = scene.pick(position);\r\n            if (pickedObject && pickedObject.primitive && pickedObject.primitive[name]) {\r\n                pickedObject.primitive[name](position);\r\n            }\r\n            if (pickedObject && pickedObject.id && pickedObject.id.constructor.toString().match(/^function\\s*([^\\s(]+)/)[1] === \"Entity\" && pickedObject.id[name]){\r\n                pickedObject.id[name](position);\r\n            }\r\n         }\r\n\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftClick', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftDoubleClick', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        var mouseOutObject;\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                if (_self._handlersMuted == true) return;\r\n                var pickedObject = scene.pick(movement.endPosition);\r\n                if (mouseOutObject && (!pickedObject || mouseOutObject != pickedObject.primitive)) {\r\n                    !(mouseOutObject.isDestroyed && mouseOutObject.isDestroyed()) && mouseOutObject.mouseOut(movement.endPosition);\r\n                    mouseOutObject = null;\r\n                }\r\n                if (pickedObject && pickedObject.primitive) {\r\n                    pickedObject = pickedObject.primitive;\r\n                    if (pickedObject.mouseOut) {\r\n                        mouseOutObject = pickedObject;\r\n                    }\r\n                    if (pickedObject.mouseMove) {\r\n                        pickedObject.mouseMove(movement.endPosition);\r\n                    }\r\n                }\r\n            }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftUp', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftDown', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n    }\r\n\r\n    _.prototype.setListener = function (primitive, type, callback) {\r\n        primitive[type] = callback;\r\n    }\r\n\r\n    _.prototype.muteHandlers = function (muted) {\r\n        this._handlersMuted = muted;\r\n    }\r\n\r\n    // register event handling for an editable shape\r\n    // shape should implement setEditMode and setHighlighted\r\n    _.prototype.registerEditableShape = function (surface) {\r\n        var _self = this;\r\n\r\n        // handlers for interactions\r\n        // highlight polygon when mouse is entering\r\n        setListener(surface, 'mouseMove', function (position) {\r\n            surface.setHighlighted(true);\r\n            if (!surface._editMode) {\r\n                _self._tooltip.showAt(position, \"Click to edit this shape\");\r\n            }\r\n        });\r\n        // hide the highlighting when mouse is leaving the polygon\r\n        setListener(surface, 'mouseOut', function (position) {\r\n            surface.setHighlighted(false);\r\n            _self._tooltip.setVisible(false);\r\n        });\r\n        setListener(surface, 'leftClick', function (position) {\r\n            surface.setEditMode(true);\r\n        });\r\n    }\r\n\r\n    _.prototype.startDrawing = function (cleanUp) {\r\n        // undo any current edit of shapes\r\n        this.disableAllEditMode();\r\n        // check for cleanUp first\r\n        if (this.editCleanUp) {\r\n            this.editCleanUp();\r\n        }\r\n        this.editCleanUp = cleanUp;\r\n        this.muteHandlers(true);\r\n    }\r\n\r\n    _.prototype.stopDrawing = function () {\r\n        // check for cleanUp first\r\n        if (this.editCleanUp) {\r\n            this.editCleanUp();\r\n            this.editCleanUp = null;\r\n        }\r\n        this.muteHandlers(false);\r\n    }\r\n\r\n    // make sure only one shape is highlighted at a time\r\n    _.prototype.disableAllHighlights = function () {\r\n        this.setHighlighted(undefined);\r\n    }\r\n\r\n    _.prototype.setHighlighted = function (surface) {\r\n        if (this._highlightedSurface && !this._highlightedSurface.isDestroyed() && this._highlightedSurface != surface) {\r\n            this._highlightedSurface.setHighlighted(false);\r\n        }\r\n        this._highlightedSurface = surface;\r\n    }\r\n\r\n    _.prototype.disableAllEditMode = function () {\r\n        this.setEdited(undefined);\r\n    }\r\n\r\n    _.prototype.setEdited = function (surface) {\r\n        if (this._editedSurface && !this._editedSurface.isDestroyed()) {\r\n            this._editedSurface.setEditMode(false);\r\n        }\r\n        this._editedSurface = surface;\r\n    }\r\n\r\n    var material = Cesium.Material.fromType(Cesium.Material.ColorType);\r\n    material.uniforms.color = new Cesium.Color(1.0, 1.0, 0.0, 0.5);\r\n\r\n    var defaultShapeOptions = {\r\n        ellipsoid: Cesium.Ellipsoid.WGS84,\r\n        textureRotationAngle: 0.0,\r\n        height: 0.0,\r\n        asynchronous: true,\r\n        show: true,\r\n        debugShowBoundingVolume: false,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    }\r\n\r\n    var defaultSurfaceOptions = copyOptions(defaultShapeOptions, {\r\n        appearance: new Cesium.EllipsoidSurfaceAppearance({\r\n            aboveGround: false\r\n        }),\r\n        material: material,\r\n        granularity: Math.PI / 180.0,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    });\r\n\r\n    var defaultPolygonOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultExtentOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultCircleOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultEllipseOptions = copyOptions(defaultSurfaceOptions, {rotation: 0});\r\n\r\n    var defaultPolylineOptions = copyOptions(defaultShapeOptions, {\r\n        width: 5,\r\n        geodesic: true,\r\n        granularity: 10000,\r\n        appearance: new Cesium.PolylineMaterialAppearance({\r\n            aboveGround: false\r\n        }),\r\n        material: material\r\n    });\r\n\r\n\r\n//    Cesium.Polygon.prototype.setStrokeStyle = setStrokeStyle;\r\n//\r\n//    Cesium.Polygon.prototype.drawOutline = drawOutline;\r\n//\r\n\r\n    var ChangeablePrimitive = (function () {\r\n        function _() {\r\n        }\r\n\r\n        _.prototype.initialiseOptions = function (options) {\r\n\r\n            fillOptions(this, options);\r\n\r\n            this._ellipsoid = undefined;\r\n            this._granularity = undefined;\r\n            this._height = undefined;\r\n            this._textureRotationAngle = undefined;\r\n            this._id = undefined;\r\n\r\n            // set the flags to initiate a first drawing\r\n            this._createPrimitive = true;\r\n            this._primitive = undefined;\r\n            this._outlinePolygon = undefined;\r\n\r\n        }\r\n\r\n        _.prototype.setAttribute = function (name, value) {\r\n            this[name] = value;\r\n            this._createPrimitive = true;\r\n        };\r\n\r\n        _.prototype.getAttribute = function (name) {\r\n            return this[name];\r\n        };\r\n\r\n        /**\r\n         * @private\r\n         */\r\n        _.prototype.update = function (context, frameState, commandList) {\r\n\r\n            if (!Cesium.defined(this.ellipsoid)) {\r\n                throw new Cesium.DeveloperError('this.ellipsoid must be defined.');\r\n            }\r\n\r\n            if (!Cesium.defined(this.appearance)) {\r\n                throw new Cesium.DeveloperError('this.material must be defined.');\r\n            }\r\n\r\n            if (this.granularity < 0.0) {\r\n                throw new Cesium.DeveloperError('this.granularity and scene2D/scene3D overrides must be greater than zero.');\r\n            }\r\n\r\n            if (!this.show) {\r\n                return;\r\n            }\r\n\r\n            if (!this._createPrimitive && (!Cesium.defined(this._primitive))) {\r\n                // No positions/hierarchy to draw\r\n                return;\r\n            }\r\n\r\n            if (this._createPrimitive ||\r\n                (this._ellipsoid !== this.ellipsoid) ||\r\n                (this._granularity !== this.granularity) ||\r\n                (this._height !== this.height) ||\r\n                (this._textureRotationAngle !== this.textureRotationAngle) ||\r\n                (this._id !== this.id)) {\r\n\r\n                var geometry = this.getGeometry();\r\n                if (!geometry) {\r\n                    return;\r\n                }\r\n\r\n                this._createPrimitive = false;\r\n                this._ellipsoid = this.ellipsoid;\r\n                this._granularity = this.granularity;\r\n                this._height = this.height;\r\n                this._textureRotationAngle = this.textureRotationAngle;\r\n                this._id = this.id;\r\n\r\n                this._primitive = this._primitive && this._primitive.destroy();\r\n                var me = this;\r\n                this._primitive = new Cesium.Primitive({\r\n                    geometryInstances: new Cesium.GeometryInstance({\r\n                        geometry: geometry,\r\n                        id: this.id,\r\n                        pickPrimitive: this\r\n                    }),\r\n                    appearance: this.appearance,\r\n                    asynchronous: this.asynchronous\r\n                });\r\n                // this._primitive = new Cesium.GroundPrimitive({\r\n                //     geometryInstances: new Cesium.GeometryInstance({\r\n                //         geometry: geometry,\r\n                //         id: me.id,\r\n                //         pickPrimitive: me\r\n                //     }),\r\n                //     attributes: {\r\n                //         // color :  Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.BLUE.withAlpha(0.5))\r\n                //         color: Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)\r\n                //     }\r\n                // });\r\n\r\n                this._outlinePolygon = this._outlinePolygon && this._outlinePolygon.destroy();\r\n                if (this.strokeColor && this.getOutlineGeometry) {\r\n                    // create the highlighting frame\r\n                    this._outlinePolygon = new Cesium.Primitive({\r\n                        geometryInstances: new Cesium.GeometryInstance({\r\n                            geometry: this.getOutlineGeometry(),\r\n                            attributes: {\r\n                                color: Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)\r\n                            }\r\n                        }),\r\n                        appearance: new Cesium.PerInstanceColorAppearance({\r\n                            flat: true,\r\n                            renderState: {\r\n                                depthTest: {\r\n                                    enabled: true\r\n                                },\r\n                                lineWidth: Math.min(this.strokeWidth || 4.0)\r\n                            }\r\n                        })\r\n                    });\r\n                }\r\n            }\r\n\r\n            var primitive = this._primitive;\r\n            // primitive.appearance.material = this.material;\r\n            // primitive.appearance = this.appearance;\r\n            primitive.appearance.material = this.material;\r\n            // primitive.debugShowBoundingVolume = this.debugShowBoundingVolume;\r\n            primitive.update(context, frameState, commandList);\r\n            //debug\r\n            // console.log(context)\r\n            // console.log(frameState)\r\n            // console.log(commandList)\r\n            this._outlinePolygon && this._outlinePolygon.update(context, frameState, commandList);\r\n\r\n        };\r\n\r\n        _.prototype.isDestroyed = function () {\r\n            return false;\r\n        };\r\n\r\n        _.prototype.destroy = function () {\r\n            this._primitive = this._primitive && this._primitive.destroy();\r\n            return Cesium.destroyObject(this);\r\n        };\r\n\r\n        _.prototype.setStrokeStyle = function (strokeColor, strokeWidth) {\r\n            if (!this.strokeColor || !this.strokeColor.equals(strokeColor) || this.strokeWidth != strokeWidth) {\r\n                this._createPrimitive = true;\r\n                this.strokeColor = strokeColor;\r\n                this.strokeWidth = strokeWidth;\r\n            }\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.ExtentPrimitive = (function () {\r\n        function _(options) {\r\n\r\n            if (!Cesium.defined(options.extent)) {\r\n                throw new Cesium.DeveloperError('Extent is required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.setExtent(options.extent);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setExtent = function (extent) {\r\n            this.setAttribute('extent', extent);\r\n        };\r\n\r\n        _.prototype.getExtent = function () {\r\n            return this.getAttribute('extent');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.extent)) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.RectangleGeometry({\r\n                rectangle: this.extent,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.RectangleOutlineGeometry({\r\n                rectangle: this.extent\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.PolygonPrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.isPolygon = true;\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setPositions = function (positions) {\r\n            this.setAttribute('positions', positions);\r\n        };\r\n\r\n        _.prototype.getPositions = function () {\r\n            return this.getAttribute('positions');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.positions) || this.positions.length < 3) {\r\n                return;\r\n            }\r\n\r\n            return Cesium.PolygonGeometry.fromPositions({\r\n                positions: this.positions,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return Cesium.PolygonOutlineGeometry.fromPositions({\r\n                positions: this.getPositions()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.CirclePrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            if (!(Cesium.defined(options.center) && Cesium.defined(options.radius))) {\r\n                throw new Cesium.DeveloperError('Center and radius are required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.setRadius(options.radius);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setCenter = function (center) {\r\n            this.setAttribute('center', center);\r\n        };\r\n\r\n        _.prototype.setRadius = function (radius) {\r\n            this.setAttribute('radius', Math.max(0.1, radius));\r\n        };\r\n\r\n        _.prototype.getCenter = function () {\r\n            return this.getAttribute('center');\r\n        };\r\n\r\n        _.prototype.getRadius = function () {\r\n            return this.getAttribute('radius');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!(Cesium.defined(this.center) && Cesium.defined(this.radius))) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.CircleGeometry({\r\n                center: this.center,\r\n                radius: this.radius,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.CircleOutlineGeometry({\r\n                center: this.getCenter(),\r\n                radius: this.getRadius()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.EllipsePrimitive = (function () {\r\n        function _(options) {\r\n\r\n            if (!(Cesium.defined(options.center) && Cesium.defined(options.semiMajorAxis) && Cesium.defined(options.semiMinorAxis))) {\r\n                throw new Cesium.DeveloperError('Center and semi major and semi minor axis are required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultEllipseOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setCenter = function (center) {\r\n            this.setAttribute('center', center);\r\n        };\r\n\r\n        _.prototype.setSemiMajorAxis = function (semiMajorAxis) {\r\n            if (semiMajorAxis < this.getSemiMinorAxis()) return;\r\n            this.setAttribute('semiMajorAxis', semiMajorAxis);\r\n        };\r\n\r\n        _.prototype.setSemiMinorAxis = function (semiMinorAxis) {\r\n            if (semiMinorAxis > this.getSemiMajorAxis()) return;\r\n            this.setAttribute('semiMinorAxis', semiMinorAxis);\r\n        };\r\n\r\n        _.prototype.setRotation = function (rotation) {\r\n            return this.setAttribute('rotation', rotation);\r\n        };\r\n\r\n        _.prototype.getCenter = function () {\r\n            return this.getAttribute('center');\r\n        };\r\n\r\n        _.prototype.getSemiMajorAxis = function () {\r\n            return this.getAttribute('semiMajorAxis');\r\n        };\r\n\r\n        _.prototype.getSemiMinorAxis = function () {\r\n            return this.getAttribute('semiMinorAxis');\r\n        };\r\n\r\n        _.prototype.getRotation = function () {\r\n            return this.getAttribute('rotation');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!(Cesium.defined(this.center) && Cesium.defined(this.semiMajorAxis) && Cesium.defined(this.semiMinorAxis))) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.EllipseGeometry({\r\n                ellipsoid: this.ellipsoid,\r\n                center: this.center,\r\n                semiMajorAxis: this.semiMajorAxis,\r\n                semiMinorAxis: this.semiMinorAxis,\r\n                rotation: this.rotation,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.EllipseOutlineGeometry({\r\n                center: this.getCenter(),\r\n                semiMajorAxis: this.getSemiMajorAxis(),\r\n                semiMinorAxis: this.getSemiMinorAxis(),\r\n                rotation: this.getRotation()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.PolylinePrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            options = copyOptions(options, defaultPolylineOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setPositions = function (positions) {\r\n            this.setAttribute('positions', positions);\r\n        };\r\n\r\n        _.prototype.setWidth = function (width) {\r\n            this.setAttribute('width', width);\r\n        };\r\n\r\n        _.prototype.setGeodesic = function (geodesic) {\r\n            this.setAttribute('geodesic', geodesic);\r\n        };\r\n\r\n        _.prototype.getPositions = function () {\r\n            return this.getAttribute('positions');\r\n        };\r\n\r\n        _.prototype.getWidth = function () {\r\n            return this.getAttribute('width');\r\n        };\r\n\r\n        _.prototype.getGeodesic = function (geodesic) {\r\n            return this.getAttribute('geodesic');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.positions) || this.positions.length < 2) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.PolylineGeometry({\r\n                positions: this.positions,\r\n                height: this.height,\r\n                width: this.width < 1 ? 1 : this.width,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                ellipsoid: this.ellipsoid\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n\r\n    var defaultBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABbElEQVQoU2NkIAEwwtR6enqyc3Jy6jEzMyv9//+fl5GR8fPfv3/vff/+/dL27dt/gtSBFYMUcnBwePj4+ARYW1u7cHFxiX/9+vXl0aNH92zdunXDjx8/doA0gBV7eXmZ+/r6Zjo4OMR+//6dCWYbOzv7v3379i3evn379G3btp0EK3Z3d49tampq//79u/T///8Zfv36xfD792+Gf//+MbCwsDydOHFi5c6dOxeDFTs5OeV0dHT0vXr1ivXLl28Mf//+gXubjY3t9/Tp04r27ds3BazYysoqsaqqtuX7919S6IHz7dvXZzNnTqk5duzYfLBiY2NjG2dnt2w7O9ewf//+wd38/z/Dv717t686evTA1LNnzx4BK3ZwcOB49epViKOju7+NjYsNHx+/yKdPH94cPrz3yIEDOzeKiYmtOXDgwA94OMvIyHB+//7d+v///7oMDAwCDAwMHxgZGS9zcnIeffLkyXd4OBMbiQDHU6AM+91hMQAAAABJRU5ErkJggg==\",\r\n        shiftX: 0,\r\n        shiftY: 0,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    }\r\n\r\n    var dragBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABbElEQVQoU2NkIAEwwtR6enqyc3Jy6jEzMyv9//+fl5GR8fPfv3/vff/+/dL27dt/gtSBFYMUcnBwePj4+ARYW1u7cHFxiX/9+vXl0aNH92zdunXDjx8/doA0gBV7eXmZ+/r6Zjo4OMR+//6dCWYbOzv7v3379i3evn379G3btp0EK3Z3d49tampq//79u/T///8Zfv36xfD792+Gf//+MbCwsDydOHFi5c6dOxeDFTs5OeV0dHT0vXr1ivXLl28Mf//+gXubjY3t9/Tp04r27ds3BazYysoqsaqqtuX7919S6IHz7dvXZzNnTqk5duzYfLBiY2NjG2dnt2w7O9ewf//+wd38/z/Dv717t686evTA1LNnzx4BK3ZwcOB49epViKOju7+NjYsNHx+/yKdPH94cPrz3yIEDOzeKiYmtOXDgwA94OMvIyHB+//7d+v///7oMDAwCDAwMHxgZGS9zcnIeffLkyXd4OBMbiQDHU6AM+91hMQAAAABJRU5ErkJggg==\",\r\n        shiftX: 0,\r\n        shiftY: 0\r\n    }\r\n\r\n    var dragHalfBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABCklEQVQoU5XRMUiEcBTH8e8/iBQMAoXAULBRqTWwGxvaagi3GxqjpragMWhrKhobbpOG2hoaL6G18MYTlIRAIUjQCDKU7mhwqDd/Hvze7wn+MWJi67qeA1aBZWAeeAfGwJMQ4qNxLf6Bm8A2sAEsAq/APXAD3DULE7wG7AF9YOZXsi9gAFwKIR5bXJZlX5KkU2Cp44SXqqqOZFketDjLsgNVVc+A2Q78mef5oaZp5y2O43jXMIwTQO/AaZIkx6ZpXrU4DMOebdv7gNeR2R+NRheO4wxbHEWRlKbpjuu6W0AP0Jp0wDAIgltd168ty6qmPfu+LxdFsQ6sAAvAG/CsKMqD53nltOe/PvEbmPRTDApQ3d8AAAAASUVORK5CYII=\",\r\n        shiftX: 0,\r\n        shiftY: 0\r\n    }\r\n\r\n    _.prototype.createBillboardGroup = function (points, options, callbacks) {\r\n        var markers = new _.BillboardGroup(this, options);\r\n        markers.addBillboards(points, callbacks);\r\n        return markers;\r\n    }\r\n\r\n    _.BillboardGroup = function (drawHelper, options) {\r\n\r\n        this._drawHelper = drawHelper;\r\n        this._scene = drawHelper._scene;\r\n\r\n        this._options = copyOptions(options, defaultBillboard);\r\n\r\n        // create one common billboard collection for all billboards\r\n        var b = new Cesium.BillboardCollection();\r\n        this._scene.primitives.add(b);\r\n        this._billboards = b;\r\n        // keep an ordered list of billboards\r\n        this._orderedBillboards = [];\r\n    }\r\n\r\n    _.BillboardGroup.prototype.createBillboard = function (position, callbacks) {\r\n\r\n        var billboard = this._billboards.add({\r\n            show: true,\r\n            position: position,\r\n            pixelOffset: new Cesium.Cartesian2(this._options.shiftX, this._options.shiftY),\r\n            eyeOffset: new Cesium.Cartesian3(0.0, 0.0, 0.0),\r\n            horizontalOrigin: Cesium.HorizontalOrigin.CENTER,\r\n            verticalOrigin: Cesium.VerticalOrigin.CENTER,\r\n            scale: 1.0,\r\n            image: this._options.iconUrl,\r\n            color: new Cesium.Color(1.0, 1.0, 1.0, 1.0)\r\n        });\r\n\r\n        // if editable\r\n        if (callbacks) {\r\n            var _self = this;\r\n            var screenSpaceCameraController = this._scene.screenSpaceCameraController;\r\n\r\n            function enableRotation(enable) {\r\n                screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            function getIndex() {\r\n                // find index\r\n                for (var i = 0, I = _self._orderedBillboards.length; i < I && _self._orderedBillboards[i] != billboard; ++i) ;\r\n                return i;\r\n            }\r\n\r\n            if (callbacks.dragHandlers) {\r\n                var _self = this;\r\n                setListener(billboard, 'leftDown', function (position) {\r\n                    // TODO - start the drag handlers here\r\n                    // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                    function onDrag(position) {\r\n                        billboard.position = position;\r\n                        // find index\r\n                        for (var i = 0, I = _self._orderedBillboards.length; i < I && _self._orderedBillboards[i] != billboard; ++i) ;\r\n                        callbacks.dragHandlers.onDrag && callbacks.dragHandlers.onDrag(getIndex(), position);\r\n                    }\r\n\r\n                    function onDragEnd(position) {\r\n                        handler.destroy();\r\n                        enableRotation(true);\r\n                        callbacks.dragHandlers.onDragEnd && callbacks.dragHandlers.onDragEnd(getIndex(), position);\r\n                    }\r\n\r\n                    var handler = new Cesium.ScreenSpaceEventHandler(_self._scene.canvas);\r\n\r\n                    handler.setInputAction(function (movement) {\r\n                        var cartesian = _self._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                        if (cartesian) {\r\n                            onDrag(cartesian);\r\n                        } else {\r\n                            onDragEnd(cartesian);\r\n                        }\r\n                    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                    handler.setInputAction(function (movement) {\r\n                        onDragEnd(_self._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                    }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                    enableRotation(false);\r\n\r\n                    callbacks.dragHandlers.onDragStart && callbacks.dragHandlers.onDragStart(getIndex(), _self._scene.camera.pickEllipsoid(position, ellipsoid));\r\n                });\r\n            }\r\n            if (callbacks.onDoubleClick) {\r\n                setListener(billboard, 'leftDoubleClick', function (position) {\r\n                    callbacks.onDoubleClick(getIndex());\r\n                });\r\n            }\r\n            if (callbacks.onClick) {\r\n                setListener(billboard, 'leftClick', function (position) {\r\n                    callbacks.onClick(getIndex());\r\n                });\r\n            }\r\n            if (callbacks.tooltip) {\r\n                setListener(billboard, 'mouseMove', function (position) {\r\n                    _self._drawHelper._tooltip.showAt(position, callbacks.tooltip());\r\n                });\r\n                setListener(billboard, 'mouseOut', function (position) {\r\n                    _self._drawHelper._tooltip.setVisible(false);\r\n                });\r\n            }\r\n        }\r\n\r\n        return billboard;\r\n    }\r\n\r\n    _.BillboardGroup.prototype.insertBillboard = function (index, position, callbacks) {\r\n        this._orderedBillboards.splice(index, 0, this.createBillboard(position, callbacks));\r\n    }\r\n\r\n    _.BillboardGroup.prototype.addBillboard = function (position, callbacks) {\r\n        this._orderedBillboards.push(this.createBillboard(position, callbacks));\r\n    }\r\n\r\n    _.BillboardGroup.prototype.addBillboards = function (positions, callbacks) {\r\n        var index = 0;\r\n        for (; index < positions.length; index++) {\r\n            this.addBillboard(positions[index], callbacks);\r\n        }\r\n    }\r\n\r\n    _.BillboardGroup.prototype.updateBillboardsPositions = function (positions) {\r\n        var index = 0;\r\n        for (; index < positions.length; index++) {\r\n            this.getBillboard(index).position = positions[index];\r\n        }\r\n    }\r\n\r\n    _.BillboardGroup.prototype.countBillboards = function () {\r\n        return this._orderedBillboards.length;\r\n    }\r\n\r\n    _.BillboardGroup.prototype.getBillboard = function (index) {\r\n        return this._orderedBillboards[index];\r\n    }\r\n\r\n    _.BillboardGroup.prototype.removeBillboard = function (index) {\r\n        this._billboards.remove(this.getBillboard(index));\r\n        this._orderedBillboards.splice(index, 1);\r\n    }\r\n\r\n    _.BillboardGroup.prototype.remove = function () {\r\n        this._billboards = this._billboards && this._billboards.removeAll() && this._billboards.destroy();\r\n    }\r\n\r\n    _.BillboardGroup.prototype.setOnTop = function () {\r\n        this._scene.primitives.raiseToTop(this._billboards);\r\n    }\r\n\r\n    _.prototype.startDrawingMarker = function (options) {\r\n\r\n        var options = copyOptions(options, defaultBillboard);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n\r\n        var primitives = scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var markers = new _.BillboardGroup(this, options);\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n                if (cartesian) {\r\n                    markers.addBillboard(cartesian);\r\n                    _self.stopDrawing();\r\n                    options.callback(cartesian, _self);\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(position, viewer);\r\n                if (cartesian) {\r\n                    tooltip.showAt(position, \"<p>Click to add your marker. Position is: </p>\" + getDisplayLatLngString(ellipsoid.cartesianToCartographic(cartesian)));\r\n                } else {\r\n                    tooltip.showAt(position, \"<p>Click on the globe to add your marker.</p>\");\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.startDrawingPolygon = function (options) {\r\n        // var options = copyOptions(options, defaultSurfaceOptions);\r\n        this.startDrawingPolyshape(true, options);\r\n    }\r\n\r\n    _.prototype.startDrawingPolyline = function (options) {\r\n        // var options = copyOptions(options, defaultPolylineOptions);\r\n        this.startDrawingPolyshape(false, options);\r\n    }\r\n\r\n    _.prototype.startDrawingPolyshape = function (isPolygon, options) {\r\n        options = isPolygon ? copyOptions(options, defaultSurfaceOptions) : copyOptions(options, defaultPolylineOptions);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                primitives && primitives.remove(poly);\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var minPoints = isPolygon ? 3 : 2;\r\n        var poly;\r\n        if (isPolygon) {\r\n            poly = new _.PolygonPrimitive(options);\r\n        } else {\r\n            poly = new _.PolylinePrimitive(options);\r\n        }\r\n        poly.asynchronous = false;\r\n        primitives.add(poly);\r\n\r\n        var positions = [];\r\n        var markers = new _.BillboardGroup(this, defaultBillboard);\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n\r\n            var position = movement.position;\r\n            if (position != null) {\r\n                if (positions.length < minPoints /*+ 2*/) {\r\n                    return;\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        _self.stopDrawing();\r\n                        if (typeof options.callback == 'function') {\r\n                            // remove overlapping ones\r\n                            var index = positions.length - 1;\r\n                            options.callback(positions, _self);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n\r\n            var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n            cartesian = getCesiumHightZero(cartesian);\r\n\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n\r\n                if (cartesian) {\r\n                    // first click\r\n                    if (positions.length == 0) {\r\n                        positions.push(cartesian.clone());\r\n                        markers.addBillboard(positions[0]);\r\n                    }\r\n                    if (positions.length >= minPoints) {\r\n                        poly.positions = positions;\r\n                        poly._createPrimitive = true;\r\n                    }\r\n                    // add new point to polygon\r\n                    // this one will move with the mouse\r\n                    positions.push(cartesian);\r\n                    // add marker at the new position\r\n                    markers.addBillboard(cartesian);\r\n                }\r\n            }\r\n\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (positions.length == 0) {\r\n                    tooltip.showAt(position, \"<p>Click to add first point</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    // var cartesian = scene.pickPosition(position);\r\n                    // cartesian = getCesiumHightZero(cartesian);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        positions.pop();\r\n                        // make sure it is slightly different\r\n                        // cartesian.y += (1 + Math.random());\r\n                        cartesian.y += Cesium.Math.EPSILON7;\r\n                        positions.push(cartesian);\r\n                        if (positions.length >= minPoints) {\r\n                            poly.positions = positions;\r\n                            poly._createPrimitive = true;\r\n                        }\r\n                        // update marker\r\n                        markers.getBillboard(positions.length - 1).position = cartesian;\r\n                        // show tooltip\r\n                        tooltip.showAt(position, \"<p>Click to add new point (\" + positions.length + \")</p>\" + (positions.length > minPoints ? \"<p>Double click to finish drawing</p>\" : \"\"));\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n\r\n    }\r\n\r\n    function getExtentCorners(value) {\r\n        return ellipsoid.cartographicArrayToCartesianArray([Cesium.Rectangle.northwest(value), Cesium.Rectangle.northeast(value), Cesium.Rectangle.southeast(value), Cesium.Rectangle.southwest(value)]);\r\n    }\r\n\r\n    _.prototype.startDrawingExtent = function (options) {\r\n\r\n        var options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                if (extent != null) {\r\n                    primitives && primitives.remove(extent);\r\n                }\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = this._scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var firstPoint = null;\r\n        var extent = null;\r\n        var markers = null;\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function updateExtent(value) {\r\n            if (extent == null) {\r\n                extent = new _.ExtentPrimitive({extent: value, material: options.material,});\r\n                extent.asynchronous = false;\r\n                primitives.add(extent);\r\n            }\r\n            extent.setExtent(value);\r\n            extent.rectangle = value;\r\n            // update the markers\r\n            var corners = getExtentCorners(value);\r\n            // create if they do not yet exist\r\n            if (markers == null) {\r\n                markers = new _.BillboardGroup(_self, defaultBillboard);\r\n                markers.addBillboards(corners);\r\n            } else {\r\n                markers.updateBillboardsPositions(corners);\r\n            }\r\n        }\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n\r\n                if (cartesian) {\r\n                    if (extent == null) {\r\n                        // create the rectangle\r\n                        firstPoint = ellipsoid.cartesianToCartographic(cartesian);\r\n                        var value = getExtent(firstPoint, firstPoint);\r\n                        updateExtent(value);\r\n                    } else {\r\n                        _self.stopDrawing();\r\n                        if (typeof options.callback == 'function') {\r\n                            options.callback(getExtent(firstPoint, ellipsoid.cartesianToCartographic(cartesian), _self));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (extent == null) {\r\n                    tooltip.showAt(position, \"<p>Click to start drawing rectangle</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        var value = getExtent(firstPoint, ellipsoid.cartesianToCartographic(cartesian));\r\n                        updateExtent(value);\r\n                        tooltip.showAt(position, \"<p>Drag to change rectangle extent</p><p>Click again to finish drawing</p>\");\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.startDrawingCircle = function (options) {\r\n\r\n        var options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n        this.startDrawing(\r\n            function cleanUp() {\r\n                if (circle != null) {\r\n                    primitives && primitives.remove(circle);\r\n                }\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = this._scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var circle = null;\r\n        var markers = null;\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function pickPosition(position) {\r\n            if (Cesium.defined(viewer.scene.pick(position))) {\r\n                return getCesiumHightZero(viewer.scene.pickPosition(position));\r\n            } else {\r\n                return getCesiumHightZero(viewer.scene.camera.pickEllipsoid(position))\r\n            }\r\n        }\r\n\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                // var cartesian = scene.pickPosition(movement.position);\r\n                // cartesian = getCesiumHightZero(cartesian);\r\n                // var cartesian = pickPosition(movement.position);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n                if (cartesian) {\r\n                    if (circle == null) {\r\n                        // create the circle\r\n                        circle = new _.CirclePrimitive({\r\n                            center: cartesian,\r\n                            radius: 0,\r\n                            asynchronous: false,\r\n                            material: options.material\r\n                        });\r\n                        primitives.add(circle);\r\n                        markers = new _.BillboardGroup(_self, defaultBillboard);\r\n                        markers.addBillboards([cartesian]);\r\n                    } else {\r\n                        if (typeof options.callback == 'function') {\r\n                            options.callback(circle.getCenter(), circle.getRadius(), _self);\r\n                        }\r\n                        _self.stopDrawing();\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (circle == null) {\r\n                    tooltip.showAt(position, \"<p>Click to start drawing the circle</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    // var cartesian = scene.pickPosition(position);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        // Cesium.Cartographic.fromCartesian(circle.getCenter())\r\n                        circle.setRadius(Cesium.Cartesian3.distance(getCesiumHightZero(circle.getCenter()), getCesiumHightZero(cartesian)));\r\n                        // circle.setRadius(Cesium.Cartesian3.distance(circle.getCenter(), cartesian));\r\n                        markers.updateBillboardsPositions(cartesian);\r\n                        tooltip.showAt(position, \"<p>Move mouse to change circle radius</p><p>Click again to finish drawing</p>\");\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.enhancePrimitives = function () {\r\n\r\n        var drawHelper = this;\r\n\r\n        Cesium.Billboard.prototype.setEditable = function () {\r\n\r\n            if (this._editable) {\r\n                return;\r\n            }\r\n\r\n            this._editable = true;\r\n\r\n            var billboard = this;\r\n\r\n            var _self = this;\r\n\r\n            function enableRotation(enable) {\r\n                drawHelper._scene.screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            setListener(billboard, 'leftDown', function (position) {\r\n                // TODO - start the drag handlers here\r\n                // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                function onDrag(position) {\r\n                    billboard.position = position;\r\n                    _self.executeListeners({name: 'drag', positions: position});\r\n                }\r\n\r\n                function onDragEnd(position) {\r\n                    handler.destroy();\r\n                    enableRotation(true);\r\n                    _self.executeListeners({name: 'dragEnd', positions: position});\r\n                }\r\n\r\n                var handler = new Cesium.ScreenSpaceEventHandler(drawHelper._scene.canvas);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    var cartesian = drawHelper._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                    if (cartesian) {\r\n                        onDrag(cartesian);\r\n                    } else {\r\n                        onDragEnd(cartesian);\r\n                    }\r\n                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    onDragEnd(drawHelper._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                enableRotation(false);\r\n\r\n            });\r\n\r\n            enhanceWithListeners(billboard);\r\n\r\n        }\r\n\r\n        Cesium.Entity.prototype.setEditable = function (editable) {\r\n            if(editable ===  false){\r\n                var billboard = this;\r\n                removeListener(billboard,'leftDown');\r\n                this._editable = false;\r\n                return;\r\n            }\r\n\r\n            if (this.modeType !== 'billboard' || this._editable) {\r\n                return;\r\n            }\r\n\r\n            this._editable = true;\r\n\r\n            var billboard = this;\r\n\r\n            var _self = this;\r\n\r\n            function enableRotation(enable) {\r\n                drawHelper._scene.screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            setListener(billboard, 'leftDown', function (position) {\r\n                // TODO - start the drag handlers here\r\n                // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                function onDrag(position) {\r\n                    billboard.position = position;\r\n                    _self.executeListeners({name: 'drag', positions: position});\r\n                }\r\n\r\n                function onDragEnd(position) {\r\n                    handler.destroy();\r\n                    enableRotation(true);\r\n                    _self.executeListeners({name: 'dragEnd', positions: position});\r\n                }\r\n\r\n                var handler = new Cesium.ScreenSpaceEventHandler(drawHelper._scene.canvas);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    var cartesian = drawHelper._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                    if (cartesian) {\r\n                        onDrag(cartesian);\r\n                    } else {\r\n                        onDragEnd(cartesian);\r\n                    }\r\n                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    onDragEnd(drawHelper._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                enableRotation(false);\r\n\r\n            });\r\n\r\n            enhanceWithListeners(billboard);\r\n        }\r\n\r\n        function setHighlighted(highlighted) {\r\n\r\n            var scene = drawHelper._scene;\r\n\r\n            // if no change\r\n            // if already highlighted, the outline polygon will be available\r\n            if (this._highlighted && this._highlighted == highlighted) {\r\n                return;\r\n            }\r\n            // disable if already in edit mode\r\n            if (this._editMode === true) {\r\n                return;\r\n            }\r\n            this._highlighted = highlighted;\r\n            // highlight by creating an outline polygon matching the polygon points\r\n            if (highlighted) {\r\n                // make sure all other shapes are not highlighted\r\n                drawHelper.setHighlighted(this);\r\n                this._strokeColor = this.strokeColor;\r\n                this.setStrokeStyle(Cesium.Color.fromCssColorString('white'), this.strokeWidth);\r\n            } else {\r\n                if (this._strokeColor) {\r\n                    this.setStrokeStyle(this._strokeColor, this.strokeWidth);\r\n                } else {\r\n                    this.setStrokeStyle(undefined, undefined);\r\n                }\r\n            }\r\n        }\r\n\r\n        function setEditMode(editMode) {\r\n            // if no change\r\n            if (this._editMode == editMode) {\r\n                return;\r\n            }\r\n            // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n            drawHelper.disableAllHighlights();\r\n            // display markers\r\n            if (editMode) {\r\n                drawHelper.setEdited(this);\r\n                var scene = drawHelper._scene;\r\n                var _self = this;\r\n                // create the markers and handlers for the editing\r\n                if (this._markers == null) {\r\n                    var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n                    var thisDragHalfBillboard = this.dragHalfBillboard? this.dragHalfBillboard: dragBillboard;\r\n                    var markers = new _.BillboardGroup(drawHelper, thisDragBillboard);\r\n                    var editMarkers = new _.BillboardGroup(drawHelper, thisDragHalfBillboard);\r\n\r\n                    // function for updating the edit markers around a certain point\r\n                    function updateHalfMarkers(index, positions) {\r\n                        // update the half markers before and after the index\r\n                        var editIndex = index - 1 < 0 ? positions.length - 1 : index - 1;\r\n                        if (editIndex < editMarkers.countBillboards()) {\r\n                            editMarkers.getBillboard(editIndex).position = calculateHalfMarkerPosition(editIndex);\r\n                        }\r\n                        editIndex = index;\r\n                        if (editIndex < editMarkers.countBillboards()) {\r\n                            editMarkers.getBillboard(editIndex).position = calculateHalfMarkerPosition(editIndex);\r\n                        }\r\n                    }\r\n\r\n                    function onEdited() {\r\n                        _self.executeListeners({name: 'onEdited', positions: _self.positions});\r\n                    }\r\n\r\n                    var handleMarkerChanges = {\r\n                        dragHandlers: {\r\n                            onDrag: function (index, position) {\r\n                                _self.positions[index] = position;\r\n                                updateHalfMarkers(index, _self.positions);\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDragEnd: function (index, position) {\r\n                                _self._createPrimitive = true;\r\n                                onEdited();\r\n                            }\r\n                        },\r\n                        onDoubleClick: function (index) {\r\n                            if (_self.positions.length < 4) {\r\n                                return;\r\n                            }\r\n                            // remove the point and the corresponding markers\r\n                            _self.positions.splice(index, 1);\r\n                            _self._createPrimitive = true;\r\n                            markers.removeBillboard(index);\r\n                            editMarkers.removeBillboard(index);\r\n                            updateHalfMarkers(index, _self.positions);\r\n                            onEdited();\r\n                        },\r\n                        tooltip: function () {\r\n                            if (_self.positions.length > 3) {\r\n                                return \"Double click to remove this point\";\r\n                            }\r\n                        }\r\n                    };\r\n                    // add billboards and keep an ordered list of them for the polygon edges\r\n                    markers.addBillboards(_self.positions, handleMarkerChanges);\r\n                    this._markers = markers;\r\n\r\n                    function calculateHalfMarkerPosition(index) {\r\n                        var positions = _self.positions;\r\n                        return ellipsoid.cartographicToCartesian(\r\n                            new Cesium.EllipsoidGeodesic(ellipsoid.cartesianToCartographic(positions[index]),\r\n                                ellipsoid.cartesianToCartographic(positions[index < positions.length - 1 ? index + 1 : 0])).interpolateUsingFraction(0.5)\r\n                        );\r\n                    }\r\n\r\n                    var halfPositions = [];\r\n                    var index = 0;\r\n                    var length = _self.positions.length + (this.isPolygon ? 0 : -1);\r\n                    for (; index < length; index++) {\r\n                        halfPositions.push(calculateHalfMarkerPosition(index));\r\n                    }\r\n                    var handleEditMarkerChanges = {\r\n                        dragHandlers: {\r\n                            onDragStart: function (index, position) {\r\n                                // add a new position to the polygon but not a new marker yet\r\n                                this.index = index + 1;\r\n                                _self.positions.splice(this.index, 0, position);\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDrag: function (index, position) {\r\n                                _self.positions[this.index] = position;\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDragEnd: function (index, position) {\r\n                                // create new sets of makers for editing\r\n                                markers.insertBillboard(this.index, position, handleMarkerChanges);\r\n                                editMarkers.getBillboard(this.index - 1).position = calculateHalfMarkerPosition(this.index - 1);\r\n                                editMarkers.insertBillboard(this.index, calculateHalfMarkerPosition(this.index), handleEditMarkerChanges);\r\n                                _self._createPrimitive = true;\r\n                                onEdited();\r\n                            }\r\n                        },\r\n                        tooltip: function () {\r\n                            return \"Drag to create a new point\";\r\n                        }\r\n                    };\r\n                    editMarkers.addBillboards(halfPositions, handleEditMarkerChanges);\r\n                    this._editMarkers = editMarkers;\r\n                    // add a handler for clicking in the globe\r\n                    this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                    this._globeClickhandler.setInputAction(\r\n                        function (movement) {\r\n                            var pickedObject = scene.pick(movement.position);\r\n                            if (!(pickedObject && pickedObject.primitive)) {\r\n                                _self.setEditMode(false);\r\n                            }\r\n                        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                    // set on top of the polygon\r\n                    markers.setOnTop();\r\n                    editMarkers.setOnTop();\r\n                }\r\n                this._editMode = true;\r\n            } else {\r\n                if (this._markers != null) {\r\n                    this._markers.remove();\r\n                    this._editMarkers.remove();\r\n                    this._markers = null;\r\n                    this._editMarkers = null;\r\n                    this._globeClickhandler.destroy();\r\n                }\r\n                this._editMode = false;\r\n            }\r\n\r\n        }\r\n\r\n        _.PolylinePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var polyline = this;\r\n            polyline.isPolygon = false;\r\n            polyline.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(polyline);\r\n\r\n            polyline.setEditMode = setEditMode;\r\n\r\n            var originalWidth = this.width;\r\n\r\n            polyline.setHighlighted = function (highlighted) {\r\n                // disable if already in edit mode\r\n                if (this._editMode === true) {\r\n                    return;\r\n                }\r\n                if (highlighted) {\r\n                    drawHelper.setHighlighted(this);\r\n                    this.setWidth(originalWidth * 2);\r\n                } else {\r\n                    this.setWidth(originalWidth);\r\n                }\r\n            }\r\n\r\n            polyline.getExtent = function () {\r\n                return Cesium.Extent.fromCartographicArray(ellipsoid.cartesianArrayToCartographicArray(this.positions));\r\n            }\r\n\r\n            enhanceWithListeners(polyline);\r\n\r\n            polyline.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.PolygonPrimitive.prototype.setEditable = function () {\r\n\r\n            var polygon = this;\r\n            polygon.asynchronous = false;\r\n\r\n            var scene = drawHelper._scene;\r\n\r\n            drawHelper.registerEditableShape(polygon);\r\n\r\n            polygon.setEditMode = setEditMode;\r\n\r\n            polygon.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(polygon);\r\n\r\n            polygon.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.ExtentPrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var extent = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            drawHelper.registerEditableShape(extent);\r\n            extent.asynchronous = false;\r\n\r\n            extent.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n                        var thisDragHalfBillboard = this.dragHalfBillboard? this.dragHalfBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(thisDragBillboard,thisDragHalfBillboard);\r\n\r\n                        function onEdited() {\r\n                            extent.executeListeners({name: 'onEdited', extent: extent.extent});\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    var corner = markers.getBillboard((index + 2) % 4).position;\r\n                                    extent.setExtent(getExtent(ellipsoid.cartesianToCartographic(corner), ellipsoid.cartesianToCartographic(position)));\r\n                                    markers.updateBillboardsPositions(getExtentCorners(extent.extent));\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the corners of this extent\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getExtentCorners(extent.extent), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                // disable edit if pickedobject is different or not an object\r\n                                try {\r\n                                    if (!(pickedObject && !pickedObject.isDestroyed() && pickedObject.primitive)) {\r\n                                        extent.setEditMode(false);\r\n                                    }\r\n                                } catch (e) {\r\n                                    extent.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            extent.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(extent);\r\n\r\n            extent.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.EllipsePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var ellipse = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            ellipse.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(ellipse);\r\n\r\n            ellipse.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    var _self = this;\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(drawHelper,thisDragBillboard );\r\n\r\n                        function getMarkerPositions() {\r\n                            return Cesium.Shapes.computeEllipseBoundary(ellipsoid, ellipse.getCenter(), ellipse.getSemiMajorAxis(), ellipse.getSemiMinorAxis(), ellipse.getRotation() + Math.PI / 2, Math.PI / 2.0).splice(0, 4);\r\n                        }\r\n\r\n                        function onEdited() {\r\n                            ellipse.executeListeners({\r\n                                name: 'onEdited',\r\n                                center: ellipse.getCenter(),\r\n                                semiMajorAxis: ellipse.getSemiMajorAxis(),\r\n                                semiMinorAxis: ellipse.getSemiMinorAxis(),\r\n                                rotation: 0\r\n                            });\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    var distance = Cesium.Cartesian3.distance(ellipse.getCenter(), position);\r\n                                    if (index % 2 == 0) {\r\n                                        ellipse.setSemiMajorAxis(distance);\r\n                                    } else {\r\n                                        ellipse.setSemiMinorAxis(distance);\r\n                                    }\r\n                                    markers.updateBillboardsPositions(getMarkerPositions());\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the excentricity and radius\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getMarkerPositions(), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                if (!(pickedObject && pickedObject.primitive)) {\r\n                                    _self.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            ellipse.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(ellipse);\r\n\r\n            ellipse.setEditMode(false);\r\n        }\r\n\r\n        _.CirclePrimitive.prototype.getCircleCartesianCoordinates = function (granularity) {\r\n            var geometry = Cesium.CircleOutlineGeometry.createGeometry(new Cesium.CircleOutlineGeometry({\r\n                ellipsoid: ellipsoid,\r\n                center: this.getCenter(),\r\n                radius: this.getRadius(),\r\n                granularity: granularity\r\n            }));\r\n            var count = 0, value, values = [];\r\n            for (; count < geometry.attributes.position.values.length; count += 3) {\r\n                value = geometry.attributes.position.values;\r\n                values.push(new Cesium.Cartesian3(value[count], value[count + 1], value[count + 2]));\r\n            }\r\n            return values;\r\n        };\r\n\r\n        _.CirclePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var circle = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            circle.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(circle);\r\n\r\n            circle.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    var _self = this;\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(drawHelper, thisDragBillboard);\r\n\r\n                        function getMarkerPositions() {\r\n                            // return _self.getCircleCartesianCoordinates(Cesium.Math.PI_OVER_TWO);\r\n                            return _self.getCircleCartesianCoordinates(Cesium.Math.PI_OVER_TWO);\r\n                        }\r\n\r\n                        function onEdited() {\r\n                            circle.executeListeners({\r\n                                name: 'onEdited',\r\n                                center: circle.getCenter(),\r\n                                radius: circle.getRadius()\r\n                            });\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    circle.setRadius(Cesium.Cartesian3.distance(circle.getCenter(), position));\r\n                                    markers.updateBillboardsPositions(getMarkerPositions());\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the radius\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getMarkerPositions(), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                if (!(pickedObject && pickedObject.primitive)) {\r\n                                    _self.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            circle.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(circle);\r\n\r\n            circle.setEditMode(false);\r\n        }\r\n\r\n    }\r\n\r\n    _.DrawHelperWidget = (function () {\r\n\r\n        // constructor\r\n        function _(drawHelper, options) {\r\n\r\n            // container must be specified\r\n            if (!(Cesium.defined(options.container))) {\r\n                throw new Cesium.DeveloperError('Container is required');\r\n            }\r\n\r\n            var drawOptions = {\r\n                // markerIcon: \"./img/glyphicons_242_google_maps.png\",\r\n                // polylineIcon: \"./img/glyphicons_097_vector_path_line.png\",\r\n                // polygonIcon: \"./img/glyphicons_096_vector_path_polygon.png\",\r\n                // circleIcon: \"./img/glyphicons_095_vector_path_circle.png\",\r\n                // extentIcon: \"./img/glyphicons_094_vector_path_square.png\",\r\n                // clearIcon: \"./img/glyphicons_067_cleaning.png\",\r\n                markerIcon: \" marker\",\r\n                polylineIcon: \" polyline\",\r\n                polygonIcon: \" polygon\",\r\n                circleIcon: \" circle\",\r\n                extentIcon: \" extent\",\r\n                clearIcon: \" clear\",\r\n                polylineDrawingOptions: defaultPolylineOptions,\r\n                polygonDrawingOptions: defaultPolygonOptions,\r\n                extentDrawingOptions: defaultExtentOptions,\r\n                circleDrawingOptions: defaultCircleOptions,\r\n                strategy: {\r\n                    pickStrategy: options.pickStrategy ? options.pickStrategy : defaultPickStrategy\r\n                }\r\n            };\r\n\r\n            fillOptions(options, drawOptions);\r\n\r\n            var _self = this;\r\n\r\n            var toolbar = document.createElement('DIV');\r\n            toolbar.className = \"toolbar\";\r\n            options.container.appendChild(toolbar);\r\n\r\n            function addIcon(id, url, title, callback) {\r\n                var div = document.createElement('DIV');\r\n                div.className = 'button' + url;\r\n                div.title = title;\r\n                toolbar.appendChild(div);\r\n                div.onclick = callback;\r\n                // var span = document.createElement('SPAN');\r\n                // div.appendChild(span);\r\n                // var image = document.createElement('IMG');\r\n                // image.src = url;\r\n                // span.appendChild(image);\r\n                return div;\r\n            }\r\n\r\n            var scene = drawHelper._scene;\r\n            // console.log(options.buttons)\r\n\r\n            options.buttons.indexOf(\"marker\") !== -1 && addIcon('marker', options.markerIcon, 'Click to start drawing a 2D marker', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'markerClick'\r\n                });\r\n\r\n                drawHelper.startDrawingMarker({\r\n                    callback: function (position) {\r\n                        _self.executeListeners({name: 'markerCreated', position: position});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"polyline\") !== -1 && addIcon('polyline', options.polylineIcon, 'Click to start drawing a 2D polyline', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'polylineClick'\r\n                });\r\n\r\n                drawHelper.startDrawingPolyline({\r\n                    callback: function (positions) {\r\n                        _self.executeListeners({name: 'polylineCreated', positions: positions});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"polygon\") !== -1 && addIcon('polygon', options.polygonIcon, 'Click to start drawing a 2D polygon', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'polygonClick'\r\n                });\r\n\r\n                drawHelper.startDrawingPolygon({\r\n                    callback: function (positions) {\r\n                        _self.executeListeners({name: 'polygonCreated', positions: positions});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"extent\") !== -1 && addIcon('extent', options.extentIcon, 'Click to start drawing an Extent', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'extentClick'\r\n                });\r\n\r\n                drawHelper.startDrawingExtent({\r\n                    callback: function (extent) {\r\n                        _self.executeListeners({name: 'extentCreated', extent: extent});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"circle\") !== -1 && addIcon('circle', options.circleIcon, 'Click to start drawing a Circle', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'circleClick'\r\n                });\r\n\r\n                drawHelper.startDrawingCircle({\r\n                    callback: function (center, radius) {\r\n                        _self.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            // add a clear button at the end\r\n            // add a divider first\r\n            var div = document.createElement('DIV');\r\n            div.className = 'divider';\r\n            toolbar.appendChild(div);\r\n\r\n            options.buttons.indexOf(\"clear\") !== -1 &&\r\n            addIcon('clear', options.clearIcon, 'Remove all primitives', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'clearClick'\r\n                });\r\n\r\n                scene.primitives.removeAll();\r\n            });\r\n\r\n            enhanceWithListeners(this);\r\n\r\n        }\r\n\r\n\r\n        return _;\r\n\r\n    })();\r\n\r\n    /**\r\n     * 新增工具栏点击回调\r\n     * @param container\r\n     * @param options\r\n     * @param {function(event)} options.clickCallback - event.name包括${toolbarName}Click\r\n     * @returns {_|*}\r\n     */\r\n    _.prototype.addToolbar = function (container, options) {\r\n        options = copyOptions(options, {container: container});\r\n        return new _.DrawHelperWidget(this, options);\r\n    }\r\n\r\n    function getExtent(mn, mx) {\r\n        var e = new Cesium.Rectangle();\r\n\r\n        // Re-order so west < east and south < north\r\n        e.west = Math.min(mn.longitude, mx.longitude);\r\n        e.east = Math.max(mn.longitude, mx.longitude);\r\n        e.south = Math.min(mn.latitude, mx.latitude);\r\n        e.north = Math.max(mn.latitude, mx.latitude);\r\n\r\n        // Check for approx equal (shouldn't require abs due to re-order)\r\n        var epsilon = Cesium.Math.EPSILON7;\r\n\r\n        if ((e.east - e.west) < epsilon) {\r\n            e.east += epsilon * 2.0;\r\n        }\r\n\r\n        if ((e.north - e.south) < epsilon) {\r\n            e.north += epsilon * 2.0;\r\n        }\r\n\r\n        return e;\r\n    };\r\n\r\n    function createTooltip(frameDiv) {\r\n\r\n        var tooltip = function (frameDiv) {\r\n\r\n            var div = document.createElement('DIV');\r\n            div.className = \"twipsy right\";\r\n\r\n            var arrow = document.createElement('DIV');\r\n            arrow.className = \"twipsy-arrow\";\r\n            div.appendChild(arrow);\r\n\r\n            var title = document.createElement('DIV');\r\n            title.className = \"twipsy-inner\";\r\n\r\n            div.appendChild(title);\r\n\r\n            this._div = div;\r\n            this._title = title;\r\n\r\n            // add to frame div and display coordinates\r\n            frameDiv.appendChild(div);\r\n            this.addEvent();\r\n            this.setVisible(false);\r\n        }\r\n\r\n        tooltip.prototype.setVisible = function (visible) {\r\n            this._div.style.display = visible ? 'block' : 'none';\r\n        }\r\n\r\n        tooltip.prototype.showAt = function (position, message) {\r\n            if (position && message) {\r\n                this.setVisible(true);\r\n                this._title.innerHTML = message;\r\n                // this._div.style.left = position.x + 10 + \"px\";\r\n                // this._div.style.top = (position.y - this._div.clientHeight / 2) + \"px\";\r\n            }\r\n        }\r\n\r\n        tooltip.prototype.show = function (message) {\r\n            if (message) {\r\n                this.setVisible(true);\r\n                this._title.innerHTML = message;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 解决拖动到tip上时宕机的问题\r\n         */\r\n        tooltip.prototype.addEvent = function () {\r\n            var me = this;\r\n            var count = 0;\r\n            document.body.addEventListener(\"mousemove\", function (ev) {\r\n                if (me._div.style.display === 'block' && (count = ((count++) % 3)) === 0) {\r\n                    me._div.style.left = ev.offsetX + 20 + \"px\";\r\n                    me._div.style.top = (ev.offsetY - me._div.clientHeight / 2) + \"px\";\r\n                }\r\n            })\r\n        }\r\n\r\n        return new tooltip(frameDiv);\r\n    }\r\n\r\n    function getDisplayLatLngString(cartographic, precision) {\r\n        return cartographic.longitude.toFixed(precision || 3) + \", \" + cartographic.latitude.toFixed(precision || 3);\r\n    }\r\n\r\n    function clone(from, to) {\r\n        if (from == null || typeof from != \"object\") return from;\r\n        if (from.constructor != Object && from.constructor != Array) return from;\r\n        if (from.constructor == Date || from.constructor == RegExp || from.constructor == Function ||\r\n            from.constructor == String || from.constructor == Number || from.constructor == Boolean)\r\n            return new from.constructor(from);\r\n\r\n        to = to || new from.constructor();\r\n\r\n        for (var name in from) {\r\n            to[name] = typeof to[name] == \"undefined\" ? clone(from[name], null) : to[name];\r\n        }\r\n\r\n        return to;\r\n    }\r\n\r\n    function fillOptions(options, defaultOptions) {\r\n        options = options || {};\r\n        var option;\r\n        for (option in defaultOptions) {\r\n            if (options[option] === undefined) {\r\n                options[option] = clone(defaultOptions[option]);\r\n            }\r\n        }\r\n    }\r\n\r\n    // shallow copy\r\n    function copyOptions(options, defaultOptions) {\r\n        var newOptions = clone(options), option;\r\n        for (option in defaultOptions) {\r\n            if (newOptions[option] === undefined) {\r\n                newOptions[option] = clone(defaultOptions[option]);\r\n            }\r\n        }\r\n        return newOptions;\r\n    }\r\n\r\n    function extendOptions(options, defaultOptions) {\r\n        var newOptions = clone(options), option;\r\n        for (option in defaultOptions) {\r\n            newOptions[option] = clone(defaultOptions[option]);\r\n        }\r\n        return newOptions;\r\n    }\r\n\r\n    function setListener(primitive, type, callback) {\r\n        primitive[type] = callback;\r\n    }\r\n\r\n    function removeListener(primitive, type) {\r\n        delete primitive[type];\r\n    }\r\n\r\n    function enhanceWithListeners(element) {\r\n\r\n        element._listeners = {};\r\n\r\n        element.addListener = function (name, callback) {\r\n            this._listeners[name] = (this._listeners[name] || []);\r\n            this._listeners[name].push(callback);\r\n            return this._listeners[name].length;\r\n        }\r\n\r\n        element.executeListeners = function (event, defaultCallback) {\r\n            if (this._listeners[event.name] && this._listeners[event.name].length > 0) {\r\n                var index = 0;\r\n                for (; index < this._listeners[event.name].length; index++) {\r\n                    this._listeners[event.name][index](event);\r\n                }\r\n            } else {\r\n                if (defaultCallback) {\r\n                    defaultCallback(event);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 获取当前点位的近地点位\r\n     * @param {Cesium.Cartesian3} cesium3\r\n     * @returns {Cesium.Cartesian3}\r\n     */\r\n    function getCesiumHightZero(cesium3) {\r\n        var fromCartesian = Cesium.Cartographic.fromCartesian(cesium3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n\r\n\r\n    return _;\r\n}));","module.exports = function(module) {\r\n\tif (!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n"],"sourceRoot":""}