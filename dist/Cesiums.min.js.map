{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/external \"Cesium\"","webpack://[name]/./src/index.js","webpack://[name]/./src/Util/NormalUtils.js","webpack://[name]/./src/Util/OfficialUtils.js","webpack://[name]/./src/Core/Cartesian3s.js","webpack://[name]/./src/Core/EventSystem.js","webpack://[name]/./src/Scene/Cameras.js","webpack://[name]/./src/Util/TypeUtils.js","webpack://[name]/./src/DataSources/DazzlingLabelEntity.js","webpack://[name]/./src/Util/Math.js","webpack://[name]/./src/DataSources/BaseEntity.js","webpack://[name]/./src/DataSources/EditableEntity.js","webpack://[name]/./src/Widgets/Settings.js","webpack://[name]/./src/ThirdParty/ChoiceHelper.js","webpack://[name]/./src/ThirdParty/DrawHelper.js","webpack://[name]/(webpack)/buildin/module.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Cameras","Cartesian3s","eventSystem","DazzlingLabelEntity","EditableEntity","Settings","ChoiceHelper","officialUtils","drawHelper","__dirpath","scriptSrc","nodeList","document","querySelectorAll","length","test","item","src","match","getPathDir","OfficialUtils","DrawHelper","getWithDefault","element","defaultElement","defined","computeCirclularFlight","lon","lat","height","radius","Cesium","SampledPositionProperty","startAngle","Math","nextRandomNumber","endAngle","increment","radians","toRadians","timeIncrement","time","JulianDate","addSeconds","start","position","Cartesian3","fromDegrees","cos","sin","addSample","computeCirclularFlightPositions","positions","push","computeCirclularAugle","angles","computeCircle","Cartesian2","cartesian3","Cartographic","fromCartesian","cartographic","latitude","toDegrees","longitude","heightPlus","arguments","undefined","fromRadians","_NormalUtils","_TypeUtils","EventSystem","accuracy","_classCallCheck","this","_init","_accuracy","viewer","eventBind","_this","handler","ScreenSpaceEventHandler","scene","canvas","setInputAction","movement","callPrimitiveCallback","ScreenSpaceEventType","LEFT_CLICK","LEFT_DOUBLE_CLICK","MOUSE_MOVE","LEFT_UP","LEFT_DOWN","eventName","pickedObject","pick","primitive","typeContaines","id","obj","type","callback","setListener","EventType","freeze","_OfficialUtils","camera","distance","totalDistance","subtract","add","multiplyByScalar","second","pitch","index","timeInterval","interval","setInterval","lookAt","HeadingPitchRange","lookAtTransform","Matrix4","IDENTITY","clearInterval","_ref","_ref$heading","heading","_ref$pitch","_ref$range","range","complete","cancel","rotationTranslation","fromRotationTranslation","Matrix3","fromHeadingPitchRoll","HeadingPitchRoll","PI","relativePosition","multiplyByPoint","earthTransform","Transforms","eastNorthUpToFixedFrame","Ellipsoid","WGS84","cameraPosition","flyTo","destination","orientation","roll","data","dataCompress","x","toFixed","y","z","encodeURIComponent","join","isFly","errorCallback","decodeURIComponent","split","target","parseFloat","setView","e","console","error","isType","instance","typeName","_typeof","constructor","toString","typeMatchGroup","indexOf","getType","_Cartesian3s","_Math","_BaseEntity2","_index","config","_ref$modelColor","modelColor","Color","DARKVIOLET","_ref$line","line","_ref$line$width","width","_ref$ring","ring","_ref$ring$timePeriod","timePeriod","_ref$ring$relativeSiz","relativeSize","_possibleConstructorReturn","__proto__","getPrototypeOf","simpleCos","SimpleCosBuilder","setPeriod","setAmplitude","setPhase","build","startTime","now","ringEntity","Entity","CallbackProperty","result","formatHeight","calc","secondsDifference","model","uri","scale","maximumScale","color","show","selected","polyline","formatHeightZero","material","parent","initEvent","BaseEntity","entities","SimpleSin","A","k","b","_createClass","SimpleSinBuilder","number","_EventSystem","remove","_selectedCallback","_releaseCallback","_this2","onLeftClick","onClickCallback","_selected","log","cesiumWidget","screenSpaceEventHandler","removeInputAction","screenSpaceCameraController","enableTilt","enableRotate","_cesiumViewer","util","Util","_scene","_drawHelper","_option","_afterClick","callbacks","afterClick","_primitives","lastOnclick","me","toolbar","container","_toolbarContainer","_toolbar","addToolbar","buttons","clickCallback","event","forEach","primitives","pickStrategy","dom","body","polygon","onclick","startDrawingPolygon","self","executeListeners","strategy","startDrawingPolyline","marker","startDrawingMarker","extent","startDrawingExtent","circle","startDrawingCircle","center","clear","stopDrawing","_eventInit","pickPositionSupported","pickPosition","pickEllipsoid","_viewer","_ellipsoid","globe","_optionReload","addListener","PolygonPrimitive","Material","fromType","LatLngPaths","Cartesian3ToLatLng","_filterExecuter","parseEntities","entity","latlng","getValue","_isInPolygon","groundPosition","getCesiumHightZero","cartesian3ToLatLng","west","east","south","north","setOption","option","_callBack","containsCallback","containEntities","values","choice","index2","filter","onChoice","cartesianToCartographic","Cartesian3ToDegrees","formatHetightPlusNumber","paths","isum","icount","dLon1","dLon2","dLat1","dLat2","size","abs","ellipsoid","defaultPickStrategy","_","frameDiv","tooltip","_tooltip","div","createElement","className","arrow","appendChild","title","_div","_title","addEvent","setVisible","visible","style","display","showAt","message","innerHTML","count","addEventListener","ev","left","offsetX","top","offsetY","clientHeight","_surfaces","ContextLimits","_maximumAliasedLineWidth","initialiseHandlers","enhancePrimitives","enhanceWithListeners","mouseOutObject","_self","_handlersMuted","endPosition","isDestroyed","mouseOut","mouseMove","muteHandlers","muted","registerEditableShape","surface","setHighlighted","_editMode","setEditMode","startDrawing","cleanUp","disableAllEditMode","editCleanUp","disableAllHighlights","_highlightedSurface","setEdited","_editedSurface","ColorType","uniforms","defaultShapeOptions","textureRotationAngle","asynchronous","debugShowBoundingVolume","defaultSurfaceOptions","copyOptions","appearance","EllipsoidSurfaceAppearance","aboveGround","granularity","defaultPolygonOptions","defaultExtentOptions","defaultCircleOptions","defaultEllipseOptions","rotation","defaultPolylineOptions","geodesic","PolylineMaterialAppearance","ChangeablePrimitive","initialiseOptions","options","fillOptions","_granularity","_height","_textureRotationAngle","_id","_createPrimitive","_primitive","_outlinePolygon","setAttribute","getAttribute","update","context","frameState","commandList","DeveloperError","geometry","getGeometry","destroy","Primitive","geometryInstances","GeometryInstance","pickPrimitive","strokeColor","getOutlineGeometry","attributes","ColorGeometryInstanceAttribute","fromColor","PerInstanceColorAppearance","flat","renderState","depthTest","enabled","lineWidth","min","strokeWidth","destroyObject","setStrokeStyle","equals","ExtentPrimitive","setExtent","getExtent","RectangleGeometry","rectangle","vertexFormat","VERTEX_FORMAT","stRotation","RectangleOutlineGeometry","isPolygon","setPositions","getPositions","PolygonGeometry","fromPositions","PolygonOutlineGeometry","CirclePrimitive","setRadius","setCenter","max","getCenter","getRadius","CircleGeometry","CircleOutlineGeometry","EllipsePrimitive","semiMajorAxis","semiMinorAxis","setSemiMajorAxis","getSemiMinorAxis","setSemiMinorAxis","getSemiMajorAxis","setRotation","getRotation","EllipseGeometry","_defineProperty","EllipseOutlineGeometry","PolylinePrimitive","setWidth","setGeodesic","getWidth","getGeodesic","PolylineGeometry","defaultBillboard","iconUrl","shiftX","shiftY","dragBillboard","getExtentCorners","cartographicArrayToCartesianArray","Rectangle","northwest","northeast","southeast","southwest","mn","mx","epsilon","EPSILON7","clone","from","to","Array","Date","RegExp","Function","String","Number","Boolean","defaultOptions","newOptions","_listeners","defaultCallback","cesium3","createBillboardGroup","points","markers","BillboardGroup","addBillboards","_options","BillboardCollection","_billboards","_orderedBillboards","createBillboard","billboard","pixelOffset","eyeOffset","horizontalOrigin","HorizontalOrigin","CENTER","verticalOrigin","VerticalOrigin","image","enableRotation","enable","getIndex","I","dragHandlers","onDragEnd","cartesian","onDrag","onDragStart","onDoubleClick","onClick","insertBillboard","splice","addBillboard","updateBillboardsPositions","getBillboard","countBillboards","removeBillboard","removeAll","setOnTop","raiseToTop","mouseHandler","precision","startDrawingPolyshape","poly","minPoints","pop","firstPoint","updateExtent","corners","highlighted","_highlighted","_strokeColor","fromCssColorString","editMode","_markers","updateHalfMarkers","editIndex","editMarkers","calculateHalfMarkerPosition","onEdited","cartographicToCartesian","EllipsoidGeodesic","interpolateUsingFraction","thisDragBillboard","thisDragHalfBillboard","dragHalfBillboard","handleMarkerChanges","halfPositions","handleEditMarkerChanges","_editMarkers","_globeClickhandler","Billboard","setEditable","_editable","editable","modeType","originalWidth","Extent","fromCartographicArray","cartesianArrayToCartographicArray","corner","ellipse","getMarkerPositions","Shapes","computeEllipseBoundary","getCircleCartesianCoordinates","createGeometry","PI_OVER_TWO","DrawHelperWidget","drawOptions","markerIcon","polylineIcon","polygonIcon","circleIcon","extentIcon","clearIcon","polylineDrawingOptions","polygonDrawingOptions","extentDrawingOptions","circleDrawingOptions","addIcon","url","__WEBPACK_AMD_DEFINE_RESULT__","__WEBPACK_AMD_DEFINE_FACTORY__","apply","__WEBPACK_AMD_DEFINE_ARRAY__","webpackPolyfill","deprecate","children"],"mappings":"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","file":"Cesiums.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Cesium\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Cesium\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Cesiums\"] = factory(require(\"Cesium\"));\n\telse\n\t\troot[\"Cesiums\"] = factory(root[\"Cesium\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","export const __dirpath = getPathDir();\r\n\r\n/**\r\n * 用于组织管理输出,打包输出的内容依赖此文件的输出\r\n */\r\n/**Scene*/\r\nexport {Cameras} from \"./Scene/Cameras\"\r\nimport \"./Scene/Cameras.css\"\r\n\r\n/**Core*/\r\nexport {Cartesian3s} from \"./Core/Cartesian3s\"\r\nexport {eventSystem} from \"./Core/EventSystem\"\r\n\r\n\r\n/**DataSources*/\r\nexport {DazzlingLabelEntity} from \"./DataSources/DazzlingLabelEntity\"\r\nexport {EditableEntity} from \"./DataSources/EditableEntity\"\r\n\r\n\r\n/**Util**/\r\nimport * as officialUtils from \"./Util/OfficialUtils\";\r\nexport const OfficialUtils = officialUtils;\r\n\r\n/**Widgets**/\r\nexport {Settings} from  \"./Widgets/Settings\";\r\n\r\n\r\n/*ThirdParty*/\r\nimport * as drawHelper from \"./ThirdParty/DrawHelper\";\r\nexport const DrawHelper = drawHelper;\r\n\r\nexport {ChoiceHelper} from \"./ThirdParty/ChoiceHelper\"\r\n\r\nimport \"./ThirdParty/DrawHelper.css\"\r\n\r\n\r\n\r\n//遍历script 获取src路径\r\nfunction getPathDir() {\r\n    let scriptSrc = \"\";\r\n    let nodeList = document.querySelectorAll(\"script\");\r\n    for(let i = 0; i< nodeList.length;i++){\r\n        if(/Cesiums[^\\/]*$/.test(nodeList.item(i).src)){\r\n            scriptSrc = nodeList.item(i).src;\r\n            break;\r\n        }\r\n    }\r\n\r\n    return scriptSrc.match(/(.+)\\/(Cesiums.js.*|Cesiums.min.js)/)[1];\r\n}\r\n\r\n","export const getWithDefault = (element, defaultElement) => {\r\n    return defined(element) ? element : defaultElement;\r\n}\r\n\r\nexport const defined = (element) =>{\r\n    return element !== null && element !== undefined;\r\n}\r\n\r\n","/**\r\n * 获取绕某点的圆 SampledPositionProperty\r\n * @param lon 角度\r\n * @param lat 角度\r\n * @param height\r\n * @param radius\r\n */\r\nexport const computeCirclularFlight = (lon, lat, height, radius) => {\r\n    let property = new Cesium.SampledPositionProperty();\r\n    let startAngle = Cesium.Math.nextRandomNumber() * 360.0;\r\n    let endAngle = startAngle + 360.0;\r\n\r\n    let increment = (Cesium.Math.nextRandomNumber() * 2.0 - 1.0) * 10.0 + 45.0;\r\n    for (let i = startAngle; i < endAngle; i += increment) {\r\n        let radians = Cesium.Math.toRadians(i);\r\n        let timeIncrement = i - startAngle;\r\n        let time = Cesium.JulianDate.addSeconds(start, timeIncrement, new Cesium.JulianDate());\r\n        let position = Cesium.Cartesian3.fromDegrees(lon + (radius * 1.5 * Math.cos(radians)), lat + (radius * Math.sin(radians)), height);\r\n        property.addSample(time, position);\r\n    }\r\n    return property;\r\n}\r\n\r\nexport const computeCirclularFlightPositions = (lon, lat, height, radius) => {\r\n    let positions = [];\r\n    let startAngle = Cesium.Math.nextRandomNumber() * 360.0;\r\n    let endAngle = startAngle + 360.0;\r\n\r\n    let increment = (Cesium.Math.nextRandomNumber() * 2.0 - 1.0) * 10.0 + 45.0;\r\n    for (let i = startAngle; i < endAngle; i += increment) {\r\n        let radians = Cesium.Math.toRadians(i);\r\n        let position = Cesium.Cartesian3.fromDegrees(lon + (radius * 1.5 * Math.cos(radians)), lat + (radius * Math.sin(radians)), height);\r\n        positions.push(position);\r\n    }\r\n    return positions;\r\n}\r\n\r\nexport const computeCirclularAugle = (increment) => {\r\n    let startAngle = Cesium.Math.nextRandomNumber() * 360.0;\r\n    let endAngle = startAngle + 360.0;\r\n    // let increment = (Cesium.Math.nextRandomNumber() * 2.0 - 1.0) * 10.0 + 45.0;\r\n\r\n    let angles = [];\r\n    for (let i = startAngle; i < endAngle; i += increment) {\r\n        angles.push(i)\r\n    }\r\n    return angles;\r\n}\r\n\r\nexport const computeCircle = (radius) => {\r\n    var positions = [];\r\n    for (var i = 0; i < 360; i++) {\r\n        var radians = Cesium.Math.toRadians(i);\r\n        positions.push(new Cesium.Cartesian2(radius * Math.cos(radians), radius * Math.sin(radians)));\r\n    }\r\n    return positions;\r\n}","import * as Cesium from \"Cesium\";\r\n\r\nexport class Cartesian3s {\r\n\r\n    /**\r\n     * 将地球坐标系基于WSG84椭球体转换成经纬度（弧度制）\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     * @returns {{height: *, latitude: *, longitude: *}}\r\n     */\r\n    static toRadians(cartesian3) {\r\n        return Cesium.Cartographic.fromCartesian(cartesian3);\r\n    }\r\n\r\n    /**\r\n     * 输出角度单位的经纬度\r\n     * @param {Cesium.Cartesian3}  cartesian3\r\n     * @returns {{height: *, latitude: *, longitude: *}}\r\n     */\r\n    static toDegrees(cartesian3) {\r\n        let cartographic = Cartesian3s.toRadians(cartesian3);\r\n        return {\r\n            height: cartographic.height,\r\n            latitude: Cesium.Math.toDegrees(cartographic.latitude),\r\n            longitude: Cesium.Math.toDegrees(cartographic.longitude)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 修正当前点位的高度\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     * @param {number} heightPlus - 修正高度，默认为5\r\n     */\r\n    static formatHeightPlus(cartesian3, heightPlus = 5) {\r\n        let fromCartesian = Cartesian3s.toRadians(cartesian3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, fromCartesian.height + heightPlus);\r\n    }\r\n\r\n    /**\r\n     * 修正当前点位的高度到0\r\n     * @param {Cesium.Cartesian3} cartesian3\r\n     */\r\n    static formatHeightZero(cartesian3) {\r\n        let fromCartesian = Cartesian3s.toRadians(cartesian3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n\r\n    static formatHeight(cartesian3, height) {\r\n        let fromCartesian = Cartesian3s.toRadians(cartesian3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, height);\r\n    }\r\n\r\n}","import * as Cesium from \"Cesium\";\r\nimport {defined} from \"../Util/NormalUtils\"\r\nimport {typeContaines} from \"../Util/TypeUtils\"\r\n\r\n/**\r\n * 接管Cesium的事件系统（对于entity和primitive）\r\n */\r\n\r\nclass EventSystem {\r\n\r\n    constructor(accuracy = 3) {\r\n        this._init = false;\r\n        this._accuracy = accuracy;\r\n    }\r\n\r\n    /**\r\n     * 单地图\r\n     * @param viewer\r\n     */\r\n    setView(viewer) {\r\n        if (!this._init) {\r\n            this.viewer = viewer;\r\n            if (defined(viewer)) {\r\n                this._init = true;\r\n                this.eventBind();\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n\r\n    setAccuracy(value = 3) {\r\n        this._accuracy = value;\r\n        return this;\r\n    }\r\n\r\n    eventBind() {\r\n        let handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftClick', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftDoubleClick', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n\r\n        handler.setInputAction((movement) => {\r\n\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftUp', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n        handler.setInputAction((movement) => {\r\n            this.callPrimitiveCallback('leftDown', movement.position);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n    }\r\n\r\n    callPrimitiveCallback(eventName, position) {\r\n        let pickedObject = this.viewer.scene.pick(position, this._accuracy, this._accuracy);\r\n        //primitive\r\n        if (pickedObject && pickedObject.primitive && pickedObject.primitive[eventName]) {\r\n            pickedObject.primitive[eventName](position);\r\n        }\r\n        //entity\r\n        if (pickedObject && typeContaines(pickedObject.id, \"Entity\") && pickedObject.id[eventName]) {\r\n            pickedObject.id[eventName](position);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {Cesium.Entity | Cesium.Primitive} obj\r\n     * @param {string} type\r\n     * @param callback\r\n     */\r\n    setListener(obj, type, callback) {\r\n        if (defined(obj) && defined(type) && (typeof callback === \"function\")) {\r\n            obj[type] = callback;\r\n        }\r\n    }\r\n    //pass\r\n    onLeftClick(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_CLICK, callback);\r\n    }\r\n\r\n    onLeftDoubleClick(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_DOUBLE_CLICK, callback);\r\n    }\r\n\r\n    onMouseMove(obj, callback) {\r\n        this.setListener(obj, EventType.MOUSE_MOVE, callback);\r\n    }\r\n\r\n    onLeftUp(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_UP, callback);\r\n    }\r\n\r\n    onLeftDown(obj, callback) {\r\n        this.setListener(obj, EventType.LEFT_DOWN, callback);\r\n    }\r\n}\r\n\r\nconst EventType = Object.freeze({\r\n    LEFT_CLICK: \"leftClick\",\r\n    LEFT_DOUBLE_CLICK: \"leftDoubleClick\",\r\n    MOUSE_MOVE: \"mouseMove\",\r\n    LEFT_UP: \"leftUp\",\r\n    LEFT_DOWN: \"leftDown\"\r\n})\r\n\r\nexport const eventSystem = new EventSystem();\r\n","import * as Cesium from \"Cesium\";\r\nimport {computeCirclularAugle} from \"../Util/OfficialUtils\"\r\nimport {Cartesian3s} from \"..\";\r\nimport {defined} from \"../Util/NormalUtils\"\r\n\r\nexport class Cameras {\r\n    /**\r\n     * 获取一个目标点位向摄像头方向移动distance米的点位\r\n     * @param camera\r\n     * @param position\r\n     * @param distance\r\n     * @returns {*}\r\n     */\r\n    static getPositionAwayByCamara(camera, position, distance) {\r\n        let totalDistance = Cesium.Cartesian3.distance(camera.position, position, new Cesium.Cartesian3());\r\n        let subtract = Cesium.Cartesian3.subtract(camera.position, position, new Cesium.Cartesian3());\r\n        let add = Cesium.Cartesian3.multiplyByScalar(subtract, distance / totalDistance, new Cesium.Cartesian3());\r\n        return Cesium.Cartesian3.add(position, add, new Cesium.Cartesian3())\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param camera\r\n     * @param position 围绕的点位\r\n     * @param radius 围绕的半径\r\n     * @param second 转一圈的秒数\r\n     * @param increment 绕圈精度\r\n     * @param pitch 俯角\r\n     */\r\n    static flyAroundPosition(camera, position, radius, second = 20, increment = 0.1, pitch = -45) {\r\n        let angles = computeCirclularAugle(increment);\r\n        let index = 0;\r\n        let timeInterval = second * 1000 / angles.length;\r\n\r\n        let interval = setInterval(() => {\r\n            camera.lookAt(position, new Cesium.HeadingPitchRange(Cesium.Math.toRadians(angles[index]), Cesium.Math.toRadians(pitch), radius))\r\n            camera.lookAtTransform(Cesium.Matrix4.IDENTITY);//勉强确保摄像头坐标系正确\r\n            index = (++index) % angles.length;\r\n        }, timeInterval);\r\n\r\n        return () => {\r\n            clearInterval(interval);\r\n            camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 类似于Camera.lookAt\r\n     * 第三个参数是 Cesium.HeadingPitchRange\r\n     * @param camera\r\n     * @param position 面向的点位\r\n     * @param heading\r\n     * @param pitch 俯仰角\r\n     * @param range 距离\r\n     * @param complete 飞行完成回调\r\n     * @param cancel 飞行取消回调\r\n     */\r\n    static flyAt(camera, position, {\r\n                     heading = 0,\r\n                     pitch = 0,\r\n                     range = 50,\r\n                 } = {},\r\n                 complete = () => {\r\n                 },\r\n                 cancel = () => {\r\n                 }) {\r\n        pitch = Cesium.Math.toRadians(pitch);\r\n        heading = Cesium.Math.toRadians(heading);\r\n\r\n        // let x = Math.sqrt(1 / (Math.pow(Math.tan(-pitch), 2) + 1) / (1 + Math.pow(Math.tan(-heading), 2)));\r\n        // // let y = Math.sqrt(1 / (Math.pow(Math.tan(-pitch), 2) + 1) / (1 / (Math.pow(Math.tan(-heading), 2) + 1)));\r\n        // let z = Math.sqrt(Math.pow(Math.tan(-pitch), 2) / (Math.pow(Math.tan(-pitch), 2) + 1));\r\n        // let y = Math.sqrt(1 - Math.pow(x, 2) - (Math.pow(z, 2)));\r\n        // let relativePosition = Cesium.Cartesian3.multiplyByScalar(new Cesium.Cartesian3(x, y, z), range, new Cesium.Cartesian3());\r\n\r\n        let rotationTranslation = Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(heading + Math.PI / 2, -pitch, 0)));\r\n        let relativePosition = Cesium.Matrix4.multiplyByPoint(rotationTranslation, new Cesium.Cartesian3(range, 0, 0), new Cesium.Cartesian3());\r\n\r\n        let earthTransform = Cesium.Transforms.eastNorthUpToFixedFrame(position, Cesium.Ellipsoid.WGS84, new Cesium.Matrix4());\r\n        let cameraPosition = Cesium.Matrix4.multiplyByPoint(earthTransform, relativePosition, new Cesium.Cartesian3());\r\n\r\n        camera.flyTo({\r\n            destination: cameraPosition,\r\n            orientation: {\r\n                heading: heading,\r\n                pitch: pitch,\r\n                roll: 0.0\r\n            },\r\n            complete: complete,\r\n            cancel: cancel\r\n        });\r\n    }\r\n\r\n    /**\r\n     *  保存当前摄像头的位置\r\n     * @param camera\r\n     * @returns {string} uri编码后的数据\r\n     */\r\n    static saveCameraStatus(camera) {\r\n        let data = {\r\n            position: camera.position,\r\n            heading: camera.heading,\r\n            pitch: camera.pitch,\r\n            roll: camera.roll,\r\n        };\r\n        var dataCompress = [\r\n            data.position.x.toFixed(2),\r\n            data.position.y.toFixed(2),\r\n            data.position.z.toFixed(2),\r\n            data.heading.toFixed(2),\r\n            data.pitch.toFixed(2),\r\n            data.roll.toFixed(2)\r\n        ]\r\n\r\n        return encodeURIComponent(dataCompress.join(\",\"));\r\n    }\r\n\r\n    /**\r\n     * 加载\r\n     * @param camera\r\n     * @param data\r\n     * @param isFly\r\n     */\r\n    static loadCameraStatus(camera, data, isFly = false, errorCallback) {\r\n        try {\r\n            let dataCompress = decodeURIComponent(data).split(\",\");\r\n\r\n            if (defined(dataCompress) && dataCompress.length >= 6) {\r\n                let target = {\r\n                    destination: {\r\n                        x: parseFloat(dataCompress[0]),\r\n                        y: parseFloat(dataCompress[1]),\r\n                        z: parseFloat(dataCompress[2])\r\n                    },\r\n                    orientation: {\r\n                        heading: parseFloat(dataCompress[3]),\r\n                        pitch: parseFloat(dataCompress[4]),\r\n                        roll: parseFloat(dataCompress[5])\r\n                    }\r\n                };\r\n                if (isFly) {\r\n                    camera.flyTo(target);\r\n                } else {\r\n                    camera.setView(target);\r\n                }\r\n            } else throw \"not define position| heading | pitch | roll\";\r\n        } catch (e) {\r\n            console.error(e);\r\n            if (typeof errorCallback === 'function') errorCallback(e);\r\n        }\r\n    }\r\n\r\n}\r\n","import {defined} from \"./NormalUtils\"\r\n\r\nexport const isType = (instance, typeName) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        return instance.constructor.toString().match(/^function\\s*([^\\s(]+)/)[1] === typeName;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * 类名包含\r\n * @param instance\r\n * @param typeName\r\n * @returns {boolean}\r\n */\r\nexport const typeContaines = (instance, typeName) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        let typeMatchGroup = instance.constructor.toString().match(/^function\\s*([^\\s(]+)/);\r\n        if (defined(typeMatchGroup) && defined(typeMatchGroup[1])) {\r\n            return typeMatchGroup[1].indexOf(typeName) !== -1;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport const getType = (instance) => {\r\n    if (typeof instance === \"object\" && defined(instance.constructor)) {\r\n        let typeMatchGroup = instance.constructor.toString().match(/^function\\s*([^\\s(]+)/);\r\n        if (defined(typeMatchGroup) && defined(typeMatchGroup[1])) {\r\n            return typeMatchGroup[1];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n","import * as Cesium from \"Cesium\";\r\nimport {Cartesian3s} from \"../Core/Cartesian3s\";\r\nimport {SimpleCosBuilder} from \"../Util/Math\"\r\nimport {BaseEntity} from \"./BaseEntity\";\r\nimport {__dirpath} from \"../index\";\r\n\r\n/**\r\n * 无法解决单个entity引用模型的问题\r\n */\r\nexport class DazzlingLabelEntity extends BaseEntity {\r\n    /**\r\n     *\r\n     * @param config\r\n     * @param modelColor\r\n     * @param width\r\n     * @param timePeriod\r\n     * @param relativeSize\r\n     */\r\n    constructor(config, {\r\n        modelColor = Cesium.Color.DARKVIOLET,\r\n        line: {\r\n            width = 5\r\n        } = {},\r\n        ring: {\r\n            timePeriod = 10,\r\n            relativeSize = 1\r\n        } = {}\r\n    } = {}) {\r\n        super(config)\r\n        // let simpleSin = new SimpleSinBuilder().setPeriod(20).setAmplitude(1).setPhase(0).build();\r\n        let simpleCos = new SimpleCosBuilder().setPeriod(timePeriod / 2).setAmplitude(-0.5).setPhase(0).build();\r\n        let startTime = Cesium.JulianDate.now();\r\n\r\n        this.ringEntity = new Cesium.Entity({\r\n            position: new Cesium.CallbackProperty((time, result) => {\r\n                return Cartesian3s.formatHeight(config.position,\r\n                    (0.5 + simpleCos.calc(Cesium.JulianDate.secondsDifference(Cesium.JulianDate.now(), startTime) % (timePeriod / 2))) * Cartesian3s.toRadians(config.position).height\r\n                );\r\n            }, false),\r\n            model: {\r\n                uri: __dirpath + \"/resources/圆环.glb\",\r\n                scale: new Cesium.CallbackProperty((time, result) => {\r\n                    // this.viewer.scene.camera.position\r\n                    return Cesium.Cartesian3.distance(config.position, this.viewer.scene.camera.position) * relativeSize / 340;\r\n                    // return 0.1;\r\n                }, false),\r\n                maximumScale: 1,\r\n                color: modelColor,\r\n                show: new Cesium.CallbackProperty((time, result) => {\r\n                    return this.selected;\r\n                }, false)\r\n            },\r\n            polyline: {\r\n                positions: [Cartesian3s.formatHeightZero(config.position), config.position],\r\n                width: width,\r\n                material: modelColor\r\n            }\r\n        });\r\n        this.ringEntity.parent = this;\r\n\r\n        this.initEvent();\r\n        this.selected = false;\r\n    }\r\n\r\n    setViewer(viewer) {\r\n        this.viewer = viewer;\r\n        viewer.entities.add(this);\r\n        viewer.entities.add(this.ringEntity);\r\n    }\r\n\r\n    removeViewer(viewer) {\r\n        viewer.entities.add(this);\r\n        viewer.entities.add(this.ringEntity);\r\n    }\r\n}\r\n\r\n","export const SimpleSin = class {\r\n    constructor(A, k, b) {\r\n        this.A = A;\r\n        this.k = k;\r\n        this.b = b;\r\n        return this;\r\n    }\r\n\r\n    calc(x) {\r\n        return Math.sin(this.k * x + this.b) * this.A;\r\n    }\r\n}\r\n\r\nexport const SimpleSinBuilder = class {\r\n    setPeriod(number) {\r\n        this.k = 2 * Math.PI / number;\r\n        return this;\r\n    }\r\n\r\n    setAmplitude(number) {\r\n        this.A = number;\r\n        return this;\r\n    }\r\n\r\n    setPhase(number) {\r\n        this.b = number;\r\n        return this;\r\n    }\r\n\r\n    build() {\r\n        return new SimpleSin(this.A, this.k, this.b)\r\n    }\r\n}\r\n\r\n\r\nexport const simpleCos = class  {\r\n    constructor(A, k, b) {\r\n        this.A = A;\r\n        this.k = k;\r\n        this.b = b;\r\n        return this;\r\n    }\r\n\r\n    calc(x) {\r\n        return Math.cos(this.k * x + this.b) * this.A;\r\n    }\r\n}\r\n\r\nexport const SimpleCosBuilder = class {\r\n    setPeriod(number) {\r\n        this.k = 2 * Math.PI / number;\r\n        return this;\r\n    }\r\n\r\n    setAmplitude(number) {\r\n        this.A = number;\r\n        return this;\r\n    }\r\n\r\n    setPhase(number) {\r\n        this.b = number;\r\n        return this;\r\n    }\r\n\r\n    build() {\r\n        return new simpleCos(this.A, this.k, this.b)\r\n    }\r\n}","import * as Cesium from \"Cesium\";\r\nimport {eventSystem} from \"../Core/EventSystem\";\r\n\r\n/**\r\n * 基础entity\r\n * 改变了，继承改变 display/hide/add/remove方向\r\n * 选择选中接口对外开放\r\n * 点击事件\r\n */\r\nexport class BaseEntity extends Cesium.Entity {\r\n    constructor(config) {\r\n        super(config);\r\n    }\r\n\r\n    setViewer(viewer) {\r\n        viewer.entities.add(this);\r\n    }\r\n\r\n    removeViewer(viewer) {\r\n        viewer.entities.remove(this);\r\n    }\r\n\r\n    display() {\r\n        this.show = true;\r\n    }\r\n\r\n    hide() {\r\n        this.show = false;\r\n    }\r\n\r\n    set selected(selected){\r\n        this._selected = selected;\r\n        if(this.selected){\r\n            typeof this._selectedCallback() === \"function\" && this._selectedCallback();\r\n        }else{\r\n            typeof this._releaseCallback === \"function\" && this._releaseCallback();\r\n        }\r\n    }\r\n\r\n    get selected(){\r\n        return this._selected;\r\n    }\r\n\r\n    setSelected(selected = true) {\r\n        this.selected = selected;\r\n    }\r\n\r\n    cancelSelected() {\r\n        this.selected = false;\r\n    }\r\n\r\n    onSelect(callback = () => {\r\n    }) {\r\n        this._selectedCallback = callback;\r\n    }\r\n\r\n    onRelease(callback = () => {\r\n    }) {\r\n        this._releaseCallback = callback;\r\n    }\r\n\r\n    initEvent() {\r\n        eventSystem.onLeftClick(this, (position) => {\r\n            // this.onSelected ^= true;//反向\r\n            if (typeof this.onClickCallback === \"function\") {\r\n                this.onClickCallback(position);\r\n            }\r\n        })\r\n    }\r\n\r\n    onClick(callback) {\r\n        this.onClickCallback = callback;\r\n    }\r\n}","import * as Cesium from \"Cesium\";\r\n\r\nexport class EditableEntity extends Cesium.Entity{\r\n    test(){\r\n        console.log(\"test\");\r\n    }\r\n\r\n    static test2(){\r\n        console.log(\"test2\");\r\n    }\r\n}","import * as Cesium from \"Cesium\";\r\n\r\n/**\r\n * 记录一些常用的设置\r\n */\r\nexport class Settings {\r\n    /**\r\n     * 清除默认的双击事件\r\n     * @param viewer\r\n     */\r\n    static cancelDefaultDbLeftClick(viewer){\r\n        viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)\r\n    }\r\n\r\n    static cancelTilt(viewer){\r\n        viewer.scene.screenSpaceCameraController.enableTilt = false;\r\n    }\r\n\r\n    static cancelRotate(viewer){\r\n        viewer.scene.screenSpaceCameraController.enableRotate = false;\r\n    }\r\n}","/*   if (typeof exports === 'object' && typeof module === 'object')\r\n       module.exports = factory(require('Cesium'), require('DrawHelper'));\r\n   else if (typeof define === 'function' && define.amd)\r\n       define('ChoiceHelper', [ 'Cesium', 'DrawHelper'], factory);\r\n   else {\r\n       root.ChoiceHelper = factory(root.Cesium, root.DrawHelper);\r\n   }*/\r\nimport * as Cesium from \"Cesium\";\r\nimport {DrawHelper} from \"../index\"\r\n\r\n// export const ChoiceHelper =  factory(Cesium,DrawHelper);\r\n\r\n\r\n/**\r\n * @param {Object} config\r\n * @param {Object} config.viewer - Cesium.viewer对象\r\n * @param {Object} config.toolbar - toolbar,为空则不创建\r\n * @param {Element} config.toolbar.container - toolbar所在容器\r\n * @param {string[]} config.toolbar.buttons - 包括 'polygon', 'circle', 'extent' 代表多边形、圆形、矩形\r\n * @param {Object} config.dom - dom事件绑定模式\r\n * @param {Element} config.polygon - 绑定开始画polygon的事件\r\n * @param {Element} config.marker - 绑定开始画marker的事件\r\n * @param {Element} config.extent - 绑定开始画extent的事件\r\n * @param {Element} config.circle - 绑定开始画circle的事件\r\n * @param {Element} config.clear - 清空绘制事件\r\n * @param {Element} config.cancel - 结束绘制事件\r\n * @param {Array} config.callbacks - 选择回调，可配置多种选择回调\r\n * @param {function(Cesium.Entity):boolean} config.callbacks.choice[].filter - 过滤器，即选择器,确认为需要选择的对象，返回ture\r\n * @param {function(Cesium.Entity[])} config.callbacks.choice[].onChoice - 选择回调\r\n * @param {function(Cesium.Cartesian3)} config.callbacks.marker - marker创建回调\r\n * @param {function} config.callbacks.afterClick - 工具栏点击回调\r\n * {\r\n *     viewer: viewer对象,\r\n *     toolbar:{\r\n *         container: toolbar所在容器,\r\n *         buttons: [],//\r\n *     },\r\n *     dom:{//\r\n *             polygon: function | dom ,\r\n *             marker: function | dom ,\r\n *             extent: function | dom ,\r\n *             circle: function | dom ,\r\n *             clear : dom,\r\n *             cancel : dom\r\n *     },\r\n *     callbacks:{\r\n *          choice:[{\r\n *             filter: function\r\n *             onChoice: function\r\n *         }],\r\n *         marker: function,\r\n *         afterClick: function,\r\n *     }\r\n * }\r\n * @constructor\r\n */\r\nexport function ChoiceHelper(config) {\r\n    this._cesiumViewer = config.viewer;\r\n    this.util = new Util(this._cesiumViewer);\r\n\r\n    this._scene = this._cesiumViewer.scene;\r\n    this._drawHelper = new DrawHelper(this._cesiumViewer);\r\n    this._option = config;\r\n    this._afterClick = config.callbacks.afterClick;\r\n\r\n    this._primitives = [];\r\n    var me = this;\r\n\r\n    if (Cesium.defined(config.toolbar) && Cesium.defined(config.toolbar.container)) {\r\n        this._toolbarContainer = config.toolbar.container;\r\n\r\n        this._toolbar = this._drawHelper.addToolbar(this._toolbarContainer, {\r\n            buttons: config.toolbar.buttons,\r\n            clickCallback: function (event) {\r\n                //移除之前绘制的\r\n                me._afterClick && me._afterClick();\r\n                me.util.getWithDefault(me._primitives, []).forEach(function (element, index) {\r\n                    me._scene.primitives.remove(element);\r\n                })\r\n            },\r\n            //点位选取策略配置\r\n            pickStrategy: pickStrategy\r\n        })\r\n    } else if (Cesium.defined(config.dom)) {\r\n        this._toolbar = this._drawHelper.addToolbar(document.body, {buttons: []});\r\n        var toolbar = this._toolbar;\r\n        config.dom.polygon && function () {\r\n            var lastOnclick = config.dom.polygon.onclick;\r\n            config.dom.polygon.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingPolygon({\r\n                    callback: function (positions, self) {\r\n                        toolbar.executeListeners({name: 'polygonCreated', positions: positions});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.polygon).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingPolygon({\r\n            //         callback: function (positions, self) {\r\n            //             toolbar.executeListeners({name: 'polygonCreated', positions: positions});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.polygon && function () {\r\n            var lastOnclick = config.dom.polyline.onclick;\r\n            config.dom.polyline.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingPolyline({\r\n                    callback: function (positions, self) {\r\n                        toolbar.executeListeners({name: 'polylineCreated', positions: positions});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.polyline).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingPolyline({\r\n            //         callback: function (positions, self) {\r\n            //             toolbar.executeListeners({name: 'polylineCreated', positions: positions});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.marker && function () {\r\n            var lastOnclick = config.dom.marker.onclick;\r\n            config.dom.marker.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingMarker({\r\n                    callback: function (position, self) {\r\n                        toolbar.executeListeners({name: 'markerCreated', position: position});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.marker).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingMarker({\r\n            //         callback: function (position, self) {\r\n            //             toolbar.executeListeners({name: 'markerCreated', position: position});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.extent && function () {\r\n            var lastOnclick = config.dom.extent.onclick;\r\n\r\n            config.dom.extent.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingExtent({\r\n                    callback: function (extent, self) {\r\n                        toolbar.executeListeners({name: 'extentCreated', extent: extent});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.extent).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingExtent({\r\n            //         callback: function (extent, self) {\r\n            //             toolbar.executeListeners({name: 'extentCreated', extent: extent});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.circle && function () {\r\n            var lastOnclick = config.dom.circle.onclick;\r\n\r\n            config.dom.circle.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.startDrawingCircle({\r\n                    callback: function (center, radius, self) {\r\n                        toolbar.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n                    },\r\n                    strategy: {\r\n                        pickStrategy: pickStrategy\r\n                    }\r\n                });\r\n            }\r\n            // $(config.dom.circle).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.startDrawingCircle({\r\n            //         callback: function (center, radius, self) {\r\n            //             toolbar.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n            //         },\r\n            //         strategy: {\r\n            //             pickStrategy: pickStrategy\r\n            //         }\r\n            //     });\r\n            // });\r\n        }();\r\n        config.dom.clear && function () {\r\n            var lastOnclick = config.dom.clear.onclick;\r\n\r\n            config.dom.clear.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n            }\r\n            // $(config.dom.clear).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //\r\n            // });\r\n        }();\r\n        config.dom.cancel && function () {\r\n            var lastOnclick = config.dom.cancel.onclick;\r\n\r\n            config.dom.cancel.onclick = function (e) {\r\n                lastOnclick && lastOnclick(e);\r\n                me._afterClick && me._afterClick();\r\n                me._drawHelper.stopDrawing()\r\n            }\r\n            // $(config.dom.cancel).on('click', function (e) {\r\n            //     me._afterClick && me._afterClick();\r\n            //     me._drawHelper.stopDrawing()\r\n            // });\r\n        }();\r\n    } else {\r\n        console.error(\"传入参数有误！\");\r\n        return;\r\n    }\r\n    this._eventInit();\r\n}\r\n\r\nvar pickStrategy = function (position, viewer) {\r\n    if (Cesium.defined(viewer.scene.pick(position)) && viewer.scene.pickPositionSupported) {\r\n        return viewer.scene.pickPosition(position);\r\n        // var fromCartesian = Cesium.Cartographic.fromCartesian(viewer.scene.pickPosition(position));\r\n        // return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    } else {\r\n        var fromCartesian = Cesium.Cartographic.fromCartesian(viewer.scene.camera.pickEllipsoid(position));\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n};\r\n\r\nChoiceHelper.prototype._optionReload = function () {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._eventInit = function () {\r\n    var me = this;\r\n    me._toolbar.addListener('polygonCreated', function (event) {\r\n        var polygon = new DrawHelper.PolygonPrimitive({\r\n            positions: event.positions,\r\n            material: Cesium.Material.fromType('Checkerboard')\r\n        });\r\n\r\n        console.log(event)\r\n        var LatLngPaths = [];\r\n\r\n        me.util.getWithDefault(event.positions, []).forEach(function (position, index) {\r\n            LatLngPaths.push(me.util.Cartesian3ToLatLng(position));\r\n        });\r\n\r\n\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var latlng = Cesium.Cartographic.fromCartesian(entity.position.getValue(0));\r\n                if (me.util._isInPolygon(latlng, LatLngPaths)) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            });\r\n            return parseEntities;\r\n        })\r\n\r\n\r\n    });\r\n    // circle.center :  Cartesian3\r\n    // circle.ellipsoid._maximumRadius : number\r\n    // circle.ellipsoid._minimumRadius : number\r\n    me._toolbar.addListener('circleCreated', function (event) {\r\n\r\n        // var r = event.radius\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var latlng = Cesium.Cartographic.fromCartesian(entity.position.getValue(0));\r\n                var groundPosition = Cesium.Cartesian3.fromRadians(latlng.longitude, latlng.latitude, 0.0);\r\n                if (Cesium.Cartesian3.distance(me.util.getCesiumHightZero(event.center), groundPosition) <= event.radius) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            })\r\n\r\n            return parseEntities;\r\n        });\r\n    });\r\n\r\n    //Cesium.Rectangle.subsample(e.extent)\r\n    me._toolbar.addListener('extentCreated', function (e) {\r\n        var extent = e.extent;\r\n\r\n        me._filterExecuter(function (entities) {\r\n            var parseEntities = [];\r\n\r\n            me.util.getWithDefault(entities, []).forEach(function (entity, index) {\r\n                var cartesian3ToLatLng = me.util.Cartesian3ToLatLng(entity.position.getValue(0));\r\n                if (extent.west <= cartesian3ToLatLng.longitude && extent.east >= cartesian3ToLatLng.longitude\r\n                    && extent.south <= cartesian3ToLatLng.latitude && extent.north >= cartesian3ToLatLng.latitude) {\r\n                    parseEntities.push(entity);\r\n                }\r\n            })\r\n\r\n            return parseEntities;\r\n        });\r\n    });\r\n\r\n    me._toolbar.addListener('markerCreated', function (event) {\r\n        me._option.callbacks.marker(event.position);\r\n        // loggingMessage('Marker created at ' + event.position.toString());\r\n        // create one common billboard collection for all billboards\r\n        // var b = new Cesium.BillboardCollection();\r\n        // viewer.scene.primitives.add(b);\r\n        // var billboard = b.add({\r\n        //     show : true,\r\n        //     position : event.position,\r\n        //     pixelOffset : new Cesium.Cartesian2(0, 0),\r\n        //     eyeOffset : new Cesium.Cartesian3(0.0, 0.0, 0.0),\r\n        //     horizontalOrigin : Cesium.HorizontalOrigin.CENTER,\r\n        //     verticalOrigin : Cesium.VerticalOrigin.CENTER,\r\n        //     scale : 1.0,\r\n        //     image: './img/glyphicons_242_google_maps.png',\r\n        //     color : new Cesium.Color(1.0, 1.0, 1.0, 1.0)\r\n        // });\r\n        // billboard.setEditable();\r\n    });\r\n}\r\n\r\n\r\nChoiceHelper.prototype.setOption = function (option) {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._callBack = function () {\r\n\r\n}\r\n\r\nChoiceHelper.prototype._filterExecuter = function (containsCallback) {\r\n    var me = this;\r\n    //选出在圈内的entities\r\n    var containEntities = containsCallback(me._cesiumViewer.entities.values);\r\n\r\n    me.util.getWithDefault(me._option.callbacks.choice, []).forEach(function (callback, index) {\r\n        var entities = [];\r\n        //过滤出需要的entity\r\n        me.util.getWithDefault(containEntities, []).forEach(function (entity, index2) {\r\n            if (callback.filter(entity)) entities.push(entity);\r\n        })\r\n        //callback\r\n        callback.onChoice(entities);\r\n    })\r\n\r\n};\r\n\r\n\r\nfunction Util(viewer) {\r\n    this._viewer = viewer;\r\n    this._ellipsoid = this._viewer.scene.globe._ellipsoid;\r\n}\r\n\r\n/**\r\n * 将Cartesian3转为经纬度\r\n * @param cartesian3\r\n * @returns {{height:number,latitude:number,longitude:number}}\r\n */\r\nUtil.prototype.Cartesian3ToLatLng = function (cartesian3) {\r\n    // return  Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return this._ellipsoid.cartesianToCartographic(cartesian3);\r\n}\r\n/**\r\n * 但是Cesium不支持此类\r\n * @param cartesian3\r\n * @return {{height: *, latitude: *, longitude: *}}\r\n * @constructor\r\n */\r\nUtil.prototype.Cartesian3ToDegrees = function (cartesian3) {\r\n    var cartographic = this._ellipsoid.cartesianToCartographic(cartesian3);\r\n    var degree = {\r\n        height: cartographic.height,\r\n        latitude: Cesium.Math.toDegrees(cartographic.latitude),\r\n        longitude: Cesium.Math.toDegrees(cartographic.longitude)\r\n    }\r\n    return degree;\r\n}\r\n\r\nUtil.prototype.getWithDefault = function (element, defaultElement) {\r\n    return element ? element : defaultElement;\r\n}\r\n\r\n/**\r\n * 获取当前点位的近地点位\r\n * @param {Cesium.Cartesian3} cartesian3\r\n * @return {Cesium.Cartesian3}\r\n */\r\nUtil.prototype.getCesiumHightZero = function (cartesian3) {\r\n    var fromCartesian = Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n}\r\n\r\n/**\r\n * 修正当前点位的高度\r\n * @param {Cesium.Cartesian3} cartesian3\r\n * @param {number} heightPlus\r\n * @return {Cesium.Cartesian3}\r\n */\r\nUtil.prototype.formatHetightPlusNumber = function (cartesian3, heightPlus) {\r\n    var fromCartesian = Cesium.Cartographic.fromCartesian(cartesian3);\r\n    return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, fromCartesian.height + heightPlus);\r\n\r\n}\r\n\r\n/**\r\n *\r\n * @param position\r\n * @param paths\r\n */\r\nUtil.prototype._isInPolygon = function (position, paths) {\r\n    var x = position.longitude;\r\n    var y = position.latitude;\r\n\r\n    var isum, icount, index = 0;\r\n    var dLon1 = 0, dLon2 = 0, dLat1 = 0, dLat2 = 0, dLon;\r\n\r\n    if (paths.size < 3) {\r\n        return false;\r\n    }\r\n\r\n    isum = 0;\r\n    icount = paths.length;\r\n\r\n    for (index = 0; index < icount - 1; index++) {\r\n        if (index === icount - 1) {\r\n            dLon1 = paths[index].longitude;\r\n            dLat1 = paths[index].latitude;\r\n            dLon2 = paths[0].longitude;\r\n            dLat2 = paths[0].latitude;\r\n        }\r\n        else {\r\n            dLon1 = paths[index].longitude;\r\n            dLat1 = paths[index].latitude;\r\n            dLon2 = paths[index + 1].longitude;\r\n            dLat2 = paths[index + 1].latitude;\r\n        }\r\n\r\n        if (((y >= dLat1) && (y < dLat2)) || ((y >= dLat2) && (y < dLat1))) {\r\n            if (Math.abs(dLat1 - dLat2) > 0) {\r\n                dLon = dLon1 - ((dLon1 - dLon2) * (dLat1 - y)) / (dLat1 - dLat2);\r\n                if (dLon < x)\r\n                    isum++;\r\n            }\r\n        }\r\n    }\r\n\r\n    return (isum % 2) !== 0;\r\n}\r\n\r\n","/**\r\n * Created by thomas on 9/01/14.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * (c) www.geocento.com\r\n * www.metaaps.com\r\n * <pre>\r\n *      update:\r\n *          2018-9-17:\r\n *              - pickStrategy属性兼容性\r\n *              - 适配stopDrawing在未开始标绘的情况\r\n *          2019-9-24:\r\n *              - 对属性带有modeType:billboard的entity加入setEditable(boolean)的方法,用于改变位置\r\n * </pre>\r\n *\r\n */\r\n(function webpackUniversalModuleDefinition(root, factory) {\r\n    if (typeof exports === 'object' && typeof module === 'object')\r\n        module.exports = factory(require('Cesium'));\r\n    else if (typeof define === 'function' && define.amd)\r\n        define('DrawHelper', ['Cesium'], factory);\r\n    else {\r\n        root.DrawHelper = factory(root.Cesium);\r\n    }\r\n}(window, function (Cesium) {\r\n    // static variables\r\n    var ellipsoid = Cesium.Ellipsoid.WGS84;\r\n\r\n    /**\r\n     *\r\n     * @param { Cesium.Cartesian2} position\r\n     * @param {Cesium.Viewer} viewer\r\n     * @return {Cesium.Cartesian3}\r\n     */\r\n    var defaultPickStrategy = function (position, viewer) {\r\n        return viewer.scene.camera.pickEllipsoid(position);\r\n    };\r\n\r\n    // constructor\r\n    function _(cesiumWidget) {\r\n        this._viewer = cesiumWidget;\r\n        this._scene = cesiumWidget.scene;\r\n        this._tooltip = createTooltip(cesiumWidget.container);\r\n        this._surfaces = [];\r\n        //适配\r\n        (Cesium.defined(Cesium.ContextLimits)) && (\r\n            Cesium.ContextLimits._maximumAliasedLineWidth = 10);\r\n\r\n        this.initialiseHandlers();\r\n\r\n        this.enhancePrimitives();\r\n        enhanceWithListeners(this);\r\n    }\r\n\r\n    _.prototype.initialiseHandlers = function () {\r\n        var scene = this._scene;\r\n        var _self = this;\r\n        // scene events\r\n        var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function callPrimitiveCallback(name, position) {\r\n            if (_self._handlersMuted == true) return;\r\n            var pickedObject = scene.pick(position);\r\n            if (pickedObject && pickedObject.primitive && pickedObject.primitive[name]) {\r\n                pickedObject.primitive[name](position);\r\n            }\r\n            if (pickedObject && pickedObject.id && pickedObject.id.constructor.toString().match(/^function\\s*([^\\s(]+)/)[1] === \"Entity\" && pickedObject.id[name]){\r\n                pickedObject.id[name](position);\r\n            }\r\n         }\r\n\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftClick', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftDoubleClick', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        var mouseOutObject;\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                if (_self._handlersMuted == true) return;\r\n                var pickedObject = scene.pick(movement.endPosition);\r\n                if (mouseOutObject && (!pickedObject || mouseOutObject != pickedObject.primitive)) {\r\n                    !(mouseOutObject.isDestroyed && mouseOutObject.isDestroyed()) && mouseOutObject.mouseOut(movement.endPosition);\r\n                    mouseOutObject = null;\r\n                }\r\n                if (pickedObject && pickedObject.primitive) {\r\n                    pickedObject = pickedObject.primitive;\r\n                    if (pickedObject.mouseOut) {\r\n                        mouseOutObject = pickedObject;\r\n                    }\r\n                    if (pickedObject.mouseMove) {\r\n                        pickedObject.mouseMove(movement.endPosition);\r\n                    }\r\n                }\r\n            }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftUp', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n        handler.setInputAction(\r\n            function (movement) {\r\n                callPrimitiveCallback('leftDown', movement.position);\r\n            }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n    }\r\n\r\n    _.prototype.setListener = function (primitive, type, callback) {\r\n        primitive[type] = callback;\r\n    }\r\n\r\n    _.prototype.muteHandlers = function (muted) {\r\n        this._handlersMuted = muted;\r\n    }\r\n\r\n    // register event handling for an editable shape\r\n    // shape should implement setEditMode and setHighlighted\r\n    _.prototype.registerEditableShape = function (surface) {\r\n        var _self = this;\r\n\r\n        // handlers for interactions\r\n        // highlight polygon when mouse is entering\r\n        setListener(surface, 'mouseMove', function (position) {\r\n            surface.setHighlighted(true);\r\n            if (!surface._editMode) {\r\n                _self._tooltip.showAt(position, \"Click to edit this shape\");\r\n            }\r\n        });\r\n        // hide the highlighting when mouse is leaving the polygon\r\n        setListener(surface, 'mouseOut', function (position) {\r\n            surface.setHighlighted(false);\r\n            _self._tooltip.setVisible(false);\r\n        });\r\n        setListener(surface, 'leftClick', function (position) {\r\n            surface.setEditMode(true);\r\n        });\r\n    }\r\n\r\n    _.prototype.startDrawing = function (cleanUp) {\r\n        // undo any current edit of shapes\r\n        this.disableAllEditMode();\r\n        // check for cleanUp first\r\n        if (this.editCleanUp) {\r\n            this.editCleanUp();\r\n        }\r\n        this.editCleanUp = cleanUp;\r\n        this.muteHandlers(true);\r\n    }\r\n\r\n    _.prototype.stopDrawing = function () {\r\n        // check for cleanUp first\r\n        if (this.editCleanUp) {\r\n            this.editCleanUp();\r\n            this.editCleanUp = null;\r\n        }\r\n        this.muteHandlers(false);\r\n    }\r\n\r\n    // make sure only one shape is highlighted at a time\r\n    _.prototype.disableAllHighlights = function () {\r\n        this.setHighlighted(undefined);\r\n    }\r\n\r\n    _.prototype.setHighlighted = function (surface) {\r\n        if (this._highlightedSurface && !this._highlightedSurface.isDestroyed() && this._highlightedSurface != surface) {\r\n            this._highlightedSurface.setHighlighted(false);\r\n        }\r\n        this._highlightedSurface = surface;\r\n    }\r\n\r\n    _.prototype.disableAllEditMode = function () {\r\n        this.setEdited(undefined);\r\n    }\r\n\r\n    _.prototype.setEdited = function (surface) {\r\n        if (this._editedSurface && !this._editedSurface.isDestroyed()) {\r\n            this._editedSurface.setEditMode(false);\r\n        }\r\n        this._editedSurface = surface;\r\n    }\r\n\r\n    var material = Cesium.Material.fromType(Cesium.Material.ColorType);\r\n    material.uniforms.color = new Cesium.Color(1.0, 1.0, 0.0, 0.5);\r\n\r\n    var defaultShapeOptions = {\r\n        ellipsoid: Cesium.Ellipsoid.WGS84,\r\n        textureRotationAngle: 0.0,\r\n        height: 0.0,\r\n        asynchronous: true,\r\n        show: true,\r\n        debugShowBoundingVolume: false,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    }\r\n\r\n    var defaultSurfaceOptions = copyOptions(defaultShapeOptions, {\r\n        appearance: new Cesium.EllipsoidSurfaceAppearance({\r\n            aboveGround: false\r\n        }),\r\n        material: material,\r\n        granularity: Math.PI / 180.0,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    });\r\n\r\n    var defaultPolygonOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultExtentOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultCircleOptions = copyOptions(defaultShapeOptions, {});\r\n    var defaultEllipseOptions = copyOptions(defaultSurfaceOptions, {rotation: 0});\r\n\r\n    var defaultPolylineOptions = copyOptions(defaultShapeOptions, {\r\n        width: 5,\r\n        geodesic: true,\r\n        granularity: 10000,\r\n        appearance: new Cesium.PolylineMaterialAppearance({\r\n            aboveGround: false\r\n        }),\r\n        material: material\r\n    });\r\n\r\n\r\n//    Cesium.Polygon.prototype.setStrokeStyle = setStrokeStyle;\r\n//\r\n//    Cesium.Polygon.prototype.drawOutline = drawOutline;\r\n//\r\n\r\n    var ChangeablePrimitive = (function () {\r\n        function _() {\r\n        }\r\n\r\n        _.prototype.initialiseOptions = function (options) {\r\n\r\n            fillOptions(this, options);\r\n\r\n            this._ellipsoid = undefined;\r\n            this._granularity = undefined;\r\n            this._height = undefined;\r\n            this._textureRotationAngle = undefined;\r\n            this._id = undefined;\r\n\r\n            // set the flags to initiate a first drawing\r\n            this._createPrimitive = true;\r\n            this._primitive = undefined;\r\n            this._outlinePolygon = undefined;\r\n\r\n        }\r\n\r\n        _.prototype.setAttribute = function (name, value) {\r\n            this[name] = value;\r\n            this._createPrimitive = true;\r\n        };\r\n\r\n        _.prototype.getAttribute = function (name) {\r\n            return this[name];\r\n        };\r\n\r\n        /**\r\n         * @private\r\n         */\r\n        _.prototype.update = function (context, frameState, commandList) {\r\n\r\n            if (!Cesium.defined(this.ellipsoid)) {\r\n                throw new Cesium.DeveloperError('this.ellipsoid must be defined.');\r\n            }\r\n\r\n            if (!Cesium.defined(this.appearance)) {\r\n                throw new Cesium.DeveloperError('this.material must be defined.');\r\n            }\r\n\r\n            if (this.granularity < 0.0) {\r\n                throw new Cesium.DeveloperError('this.granularity and scene2D/scene3D overrides must be greater than zero.');\r\n            }\r\n\r\n            if (!this.show) {\r\n                return;\r\n            }\r\n\r\n            if (!this._createPrimitive && (!Cesium.defined(this._primitive))) {\r\n                // No positions/hierarchy to draw\r\n                return;\r\n            }\r\n\r\n            if (this._createPrimitive ||\r\n                (this._ellipsoid !== this.ellipsoid) ||\r\n                (this._granularity !== this.granularity) ||\r\n                (this._height !== this.height) ||\r\n                (this._textureRotationAngle !== this.textureRotationAngle) ||\r\n                (this._id !== this.id)) {\r\n\r\n                var geometry = this.getGeometry();\r\n                if (!geometry) {\r\n                    return;\r\n                }\r\n\r\n                this._createPrimitive = false;\r\n                this._ellipsoid = this.ellipsoid;\r\n                this._granularity = this.granularity;\r\n                this._height = this.height;\r\n                this._textureRotationAngle = this.textureRotationAngle;\r\n                this._id = this.id;\r\n\r\n                this._primitive = this._primitive && this._primitive.destroy();\r\n                var me = this;\r\n                this._primitive = new Cesium.Primitive({\r\n                    geometryInstances: new Cesium.GeometryInstance({\r\n                        geometry: geometry,\r\n                        id: this.id,\r\n                        pickPrimitive: this\r\n                    }),\r\n                    appearance: this.appearance,\r\n                    asynchronous: this.asynchronous\r\n                });\r\n                // this._primitive = new Cesium.GroundPrimitive({\r\n                //     geometryInstances: new Cesium.GeometryInstance({\r\n                //         geometry: geometry,\r\n                //         id: me.id,\r\n                //         pickPrimitive: me\r\n                //     }),\r\n                //     attributes: {\r\n                //         // color :  Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.BLUE.withAlpha(0.5))\r\n                //         color: Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)\r\n                //     }\r\n                // });\r\n\r\n                this._outlinePolygon = this._outlinePolygon && this._outlinePolygon.destroy();\r\n                if (this.strokeColor && this.getOutlineGeometry) {\r\n                    // create the highlighting frame\r\n                    this._outlinePolygon = new Cesium.Primitive({\r\n                        geometryInstances: new Cesium.GeometryInstance({\r\n                            geometry: this.getOutlineGeometry(),\r\n                            attributes: {\r\n                                color: Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)\r\n                            }\r\n                        }),\r\n                        appearance: new Cesium.PerInstanceColorAppearance({\r\n                            flat: true,\r\n                            renderState: {\r\n                                depthTest: {\r\n                                    enabled: true\r\n                                },\r\n                                lineWidth: Math.min(this.strokeWidth || 4.0)\r\n                            }\r\n                        })\r\n                    });\r\n                }\r\n            }\r\n\r\n            var primitive = this._primitive;\r\n            // primitive.appearance.material = this.material;\r\n            // primitive.appearance = this.appearance;\r\n            primitive.appearance.material = this.material;\r\n            // primitive.debugShowBoundingVolume = this.debugShowBoundingVolume;\r\n            primitive.update(context, frameState, commandList);\r\n            //debug\r\n            // console.log(context)\r\n            // console.log(frameState)\r\n            // console.log(commandList)\r\n            this._outlinePolygon && this._outlinePolygon.update(context, frameState, commandList);\r\n\r\n        };\r\n\r\n        _.prototype.isDestroyed = function () {\r\n            return false;\r\n        };\r\n\r\n        _.prototype.destroy = function () {\r\n            this._primitive = this._primitive && this._primitive.destroy();\r\n            return Cesium.destroyObject(this);\r\n        };\r\n\r\n        _.prototype.setStrokeStyle = function (strokeColor, strokeWidth) {\r\n            if (!this.strokeColor || !this.strokeColor.equals(strokeColor) || this.strokeWidth != strokeWidth) {\r\n                this._createPrimitive = true;\r\n                this.strokeColor = strokeColor;\r\n                this.strokeWidth = strokeWidth;\r\n            }\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.ExtentPrimitive = (function () {\r\n        function _(options) {\r\n\r\n            if (!Cesium.defined(options.extent)) {\r\n                throw new Cesium.DeveloperError('Extent is required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.setExtent(options.extent);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setExtent = function (extent) {\r\n            this.setAttribute('extent', extent);\r\n        };\r\n\r\n        _.prototype.getExtent = function () {\r\n            return this.getAttribute('extent');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.extent)) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.RectangleGeometry({\r\n                rectangle: this.extent,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.RectangleOutlineGeometry({\r\n                rectangle: this.extent\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.PolygonPrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.isPolygon = true;\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setPositions = function (positions) {\r\n            this.setAttribute('positions', positions);\r\n        };\r\n\r\n        _.prototype.getPositions = function () {\r\n            return this.getAttribute('positions');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.positions) || this.positions.length < 3) {\r\n                return;\r\n            }\r\n\r\n            return Cesium.PolygonGeometry.fromPositions({\r\n                positions: this.positions,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return Cesium.PolygonOutlineGeometry.fromPositions({\r\n                positions: this.getPositions()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.CirclePrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            if (!(Cesium.defined(options.center) && Cesium.defined(options.radius))) {\r\n                throw new Cesium.DeveloperError('Center and radius are required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n            this.setRadius(options.radius);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setCenter = function (center) {\r\n            this.setAttribute('center', center);\r\n        };\r\n\r\n        _.prototype.setRadius = function (radius) {\r\n            this.setAttribute('radius', Math.max(0.1, radius));\r\n        };\r\n\r\n        _.prototype.getCenter = function () {\r\n            return this.getAttribute('center');\r\n        };\r\n\r\n        _.prototype.getRadius = function () {\r\n            return this.getAttribute('radius');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!(Cesium.defined(this.center) && Cesium.defined(this.radius))) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.CircleGeometry({\r\n                center: this.center,\r\n                radius: this.radius,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.CircleOutlineGeometry({\r\n                center: this.getCenter(),\r\n                radius: this.getRadius()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.EllipsePrimitive = (function () {\r\n        function _(options) {\r\n\r\n            if (!(Cesium.defined(options.center) && Cesium.defined(options.semiMajorAxis) && Cesium.defined(options.semiMinorAxis))) {\r\n                throw new Cesium.DeveloperError('Center and semi major and semi minor axis are required');\r\n            }\r\n\r\n            options = copyOptions(options, defaultEllipseOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setCenter = function (center) {\r\n            this.setAttribute('center', center);\r\n        };\r\n\r\n        _.prototype.setSemiMajorAxis = function (semiMajorAxis) {\r\n            if (semiMajorAxis < this.getSemiMinorAxis()) return;\r\n            this.setAttribute('semiMajorAxis', semiMajorAxis);\r\n        };\r\n\r\n        _.prototype.setSemiMinorAxis = function (semiMinorAxis) {\r\n            if (semiMinorAxis > this.getSemiMajorAxis()) return;\r\n            this.setAttribute('semiMinorAxis', semiMinorAxis);\r\n        };\r\n\r\n        _.prototype.setRotation = function (rotation) {\r\n            return this.setAttribute('rotation', rotation);\r\n        };\r\n\r\n        _.prototype.getCenter = function () {\r\n            return this.getAttribute('center');\r\n        };\r\n\r\n        _.prototype.getSemiMajorAxis = function () {\r\n            return this.getAttribute('semiMajorAxis');\r\n        };\r\n\r\n        _.prototype.getSemiMinorAxis = function () {\r\n            return this.getAttribute('semiMinorAxis');\r\n        };\r\n\r\n        _.prototype.getRotation = function () {\r\n            return this.getAttribute('rotation');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!(Cesium.defined(this.center) && Cesium.defined(this.semiMajorAxis) && Cesium.defined(this.semiMinorAxis))) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.EllipseGeometry({\r\n                ellipsoid: this.ellipsoid,\r\n                center: this.center,\r\n                semiMajorAxis: this.semiMajorAxis,\r\n                semiMinorAxis: this.semiMinorAxis,\r\n                rotation: this.rotation,\r\n                height: this.height,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                stRotation: this.textureRotationAngle,\r\n                ellipsoid: this.ellipsoid,\r\n                granularity: this.granularity\r\n            });\r\n        };\r\n\r\n        _.prototype.getOutlineGeometry = function () {\r\n            return new Cesium.EllipseOutlineGeometry({\r\n                center: this.getCenter(),\r\n                semiMajorAxis: this.getSemiMajorAxis(),\r\n                semiMinorAxis: this.getSemiMinorAxis(),\r\n                rotation: this.getRotation()\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n    _.PolylinePrimitive = (function () {\r\n\r\n        function _(options) {\r\n\r\n            options = copyOptions(options, defaultPolylineOptions);\r\n\r\n            this.initialiseOptions(options);\r\n\r\n        }\r\n\r\n        _.prototype = new ChangeablePrimitive();\r\n\r\n        _.prototype.setPositions = function (positions) {\r\n            this.setAttribute('positions', positions);\r\n        };\r\n\r\n        _.prototype.setWidth = function (width) {\r\n            this.setAttribute('width', width);\r\n        };\r\n\r\n        _.prototype.setGeodesic = function (geodesic) {\r\n            this.setAttribute('geodesic', geodesic);\r\n        };\r\n\r\n        _.prototype.getPositions = function () {\r\n            return this.getAttribute('positions');\r\n        };\r\n\r\n        _.prototype.getWidth = function () {\r\n            return this.getAttribute('width');\r\n        };\r\n\r\n        _.prototype.getGeodesic = function (geodesic) {\r\n            return this.getAttribute('geodesic');\r\n        };\r\n\r\n        _.prototype.getGeometry = function () {\r\n\r\n            if (!Cesium.defined(this.positions) || this.positions.length < 2) {\r\n                return;\r\n            }\r\n\r\n            return new Cesium.PolylineGeometry({\r\n                positions: this.positions,\r\n                height: this.height,\r\n                width: this.width < 1 ? 1 : this.width,\r\n                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,\r\n                ellipsoid: this.ellipsoid\r\n            });\r\n        }\r\n\r\n        return _;\r\n    })();\r\n\r\n\r\n    var defaultBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABbElEQVQoU2NkIAEwwtR6enqyc3Jy6jEzMyv9//+fl5GR8fPfv3/vff/+/dL27dt/gtSBFYMUcnBwePj4+ARYW1u7cHFxiX/9+vXl0aNH92zdunXDjx8/doA0gBV7eXmZ+/r6Zjo4OMR+//6dCWYbOzv7v3379i3evn379G3btp0EK3Z3d49tampq//79u/T///8Zfv36xfD792+Gf//+MbCwsDydOHFi5c6dOxeDFTs5OeV0dHT0vXr1ivXLl28Mf//+gXubjY3t9/Tp04r27ds3BazYysoqsaqqtuX7919S6IHz7dvXZzNnTqk5duzYfLBiY2NjG2dnt2w7O9ewf//+wd38/z/Dv717t686evTA1LNnzx4BK3ZwcOB49epViKOju7+NjYsNHx+/yKdPH94cPrz3yIEDOzeKiYmtOXDgwA94OMvIyHB+//7d+v///7oMDAwCDAwMHxgZGS9zcnIeffLkyXd4OBMbiQDHU6AM+91hMQAAAABJRU5ErkJggg==\",\r\n        shiftX: 0,\r\n        shiftY: 0,\r\n        strategy: {\r\n            pickStrategy: defaultPickStrategy\r\n        }\r\n    }\r\n\r\n    var dragBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABbElEQVQoU2NkIAEwwtR6enqyc3Jy6jEzMyv9//+fl5GR8fPfv3/vff/+/dL27dt/gtSBFYMUcnBwePj4+ARYW1u7cHFxiX/9+vXl0aNH92zdunXDjx8/doA0gBV7eXmZ+/r6Zjo4OMR+//6dCWYbOzv7v3379i3evn379G3btp0EK3Z3d49tampq//79u/T///8Zfv36xfD792+Gf//+MbCwsDydOHFi5c6dOxeDFTs5OeV0dHT0vXr1ivXLl28Mf//+gXubjY3t9/Tp04r27ds3BazYysoqsaqqtuX7919S6IHz7dvXZzNnTqk5duzYfLBiY2NjG2dnt2w7O9ewf//+wd38/z/Dv717t686evTA1LNnzx4BK3ZwcOB49epViKOju7+NjYsNHx+/yKdPH94cPrz3yIEDOzeKiYmtOXDgwA94OMvIyHB+//7d+v///7oMDAwCDAwMHxgZGS9zcnIeffLkyXd4OBMbiQDHU6AM+91hMQAAAABJRU5ErkJggg==\",\r\n        shiftX: 0,\r\n        shiftY: 0\r\n    }\r\n\r\n    var dragHalfBillboard = {\r\n        iconUrl: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAABCklEQVQoU5XRMUiEcBTH8e8/iBQMAoXAULBRqTWwGxvaagi3GxqjpragMWhrKhobbpOG2hoaL6G18MYTlIRAIUjQCDKU7mhwqDd/Hvze7wn+MWJi67qeA1aBZWAeeAfGwJMQ4qNxLf6Bm8A2sAEsAq/APXAD3DULE7wG7AF9YOZXsi9gAFwKIR5bXJZlX5KkU2Cp44SXqqqOZFketDjLsgNVVc+A2Q78mef5oaZp5y2O43jXMIwTQO/AaZIkx6ZpXrU4DMOebdv7gNeR2R+NRheO4wxbHEWRlKbpjuu6W0AP0Jp0wDAIgltd168ty6qmPfu+LxdFsQ6sAAvAG/CsKMqD53nltOe/PvEbmPRTDApQ3d8AAAAASUVORK5CYII=\",\r\n        shiftX: 0,\r\n        shiftY: 0\r\n    }\r\n\r\n    _.prototype.createBillboardGroup = function (points, options, callbacks) {\r\n        var markers = new _.BillboardGroup(this, options);\r\n        markers.addBillboards(points, callbacks);\r\n        return markers;\r\n    }\r\n\r\n    _.BillboardGroup = function (drawHelper, options) {\r\n\r\n        this._drawHelper = drawHelper;\r\n        this._scene = drawHelper._scene;\r\n\r\n        this._options = copyOptions(options, defaultBillboard);\r\n\r\n        // create one common billboard collection for all billboards\r\n        var b = new Cesium.BillboardCollection();\r\n        this._scene.primitives.add(b);\r\n        this._billboards = b;\r\n        // keep an ordered list of billboards\r\n        this._orderedBillboards = [];\r\n    }\r\n\r\n    _.BillboardGroup.prototype.createBillboard = function (position, callbacks) {\r\n\r\n        var billboard = this._billboards.add({\r\n            show: true,\r\n            position: position,\r\n            pixelOffset: new Cesium.Cartesian2(this._options.shiftX, this._options.shiftY),\r\n            eyeOffset: new Cesium.Cartesian3(0.0, 0.0, 0.0),\r\n            horizontalOrigin: Cesium.HorizontalOrigin.CENTER,\r\n            verticalOrigin: Cesium.VerticalOrigin.CENTER,\r\n            scale: 1.0,\r\n            image: this._options.iconUrl,\r\n            color: new Cesium.Color(1.0, 1.0, 1.0, 1.0)\r\n        });\r\n\r\n        // if editable\r\n        if (callbacks) {\r\n            var _self = this;\r\n            var screenSpaceCameraController = this._scene.screenSpaceCameraController;\r\n\r\n            function enableRotation(enable) {\r\n                screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            function getIndex() {\r\n                // find index\r\n                for (var i = 0, I = _self._orderedBillboards.length; i < I && _self._orderedBillboards[i] != billboard; ++i) ;\r\n                return i;\r\n            }\r\n\r\n            if (callbacks.dragHandlers) {\r\n                var _self = this;\r\n                setListener(billboard, 'leftDown', function (position) {\r\n                    // TODO - start the drag handlers here\r\n                    // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                    function onDrag(position) {\r\n                        billboard.position = position;\r\n                        // find index\r\n                        for (var i = 0, I = _self._orderedBillboards.length; i < I && _self._orderedBillboards[i] != billboard; ++i) ;\r\n                        callbacks.dragHandlers.onDrag && callbacks.dragHandlers.onDrag(getIndex(), position);\r\n                    }\r\n\r\n                    function onDragEnd(position) {\r\n                        handler.destroy();\r\n                        enableRotation(true);\r\n                        callbacks.dragHandlers.onDragEnd && callbacks.dragHandlers.onDragEnd(getIndex(), position);\r\n                    }\r\n\r\n                    var handler = new Cesium.ScreenSpaceEventHandler(_self._scene.canvas);\r\n\r\n                    handler.setInputAction(function (movement) {\r\n                        var cartesian = _self._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                        if (cartesian) {\r\n                            onDrag(cartesian);\r\n                        } else {\r\n                            onDragEnd(cartesian);\r\n                        }\r\n                    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                    handler.setInputAction(function (movement) {\r\n                        onDragEnd(_self._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                    }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                    enableRotation(false);\r\n\r\n                    callbacks.dragHandlers.onDragStart && callbacks.dragHandlers.onDragStart(getIndex(), _self._scene.camera.pickEllipsoid(position, ellipsoid));\r\n                });\r\n            }\r\n            if (callbacks.onDoubleClick) {\r\n                setListener(billboard, 'leftDoubleClick', function (position) {\r\n                    callbacks.onDoubleClick(getIndex());\r\n                });\r\n            }\r\n            if (callbacks.onClick) {\r\n                setListener(billboard, 'leftClick', function (position) {\r\n                    callbacks.onClick(getIndex());\r\n                });\r\n            }\r\n            if (callbacks.tooltip) {\r\n                setListener(billboard, 'mouseMove', function (position) {\r\n                    _self._drawHelper._tooltip.showAt(position, callbacks.tooltip());\r\n                });\r\n                setListener(billboard, 'mouseOut', function (position) {\r\n                    _self._drawHelper._tooltip.setVisible(false);\r\n                });\r\n            }\r\n        }\r\n\r\n        return billboard;\r\n    }\r\n\r\n    _.BillboardGroup.prototype.insertBillboard = function (index, position, callbacks) {\r\n        this._orderedBillboards.splice(index, 0, this.createBillboard(position, callbacks));\r\n    }\r\n\r\n    _.BillboardGroup.prototype.addBillboard = function (position, callbacks) {\r\n        this._orderedBillboards.push(this.createBillboard(position, callbacks));\r\n    }\r\n\r\n    _.BillboardGroup.prototype.addBillboards = function (positions, callbacks) {\r\n        var index = 0;\r\n        for (; index < positions.length; index++) {\r\n            this.addBillboard(positions[index], callbacks);\r\n        }\r\n    }\r\n\r\n    _.BillboardGroup.prototype.updateBillboardsPositions = function (positions) {\r\n        var index = 0;\r\n        for (; index < positions.length; index++) {\r\n            this.getBillboard(index).position = positions[index];\r\n        }\r\n    }\r\n\r\n    _.BillboardGroup.prototype.countBillboards = function () {\r\n        return this._orderedBillboards.length;\r\n    }\r\n\r\n    _.BillboardGroup.prototype.getBillboard = function (index) {\r\n        return this._orderedBillboards[index];\r\n    }\r\n\r\n    _.BillboardGroup.prototype.removeBillboard = function (index) {\r\n        this._billboards.remove(this.getBillboard(index));\r\n        this._orderedBillboards.splice(index, 1);\r\n    }\r\n\r\n    _.BillboardGroup.prototype.remove = function () {\r\n        this._billboards = this._billboards && this._billboards.removeAll() && this._billboards.destroy();\r\n    }\r\n\r\n    _.BillboardGroup.prototype.setOnTop = function () {\r\n        this._scene.primitives.raiseToTop(this._billboards);\r\n    }\r\n\r\n    _.prototype.startDrawingMarker = function (options) {\r\n\r\n        var options = copyOptions(options, defaultBillboard);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n\r\n        var primitives = scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var markers = new _.BillboardGroup(this, options);\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n                if (cartesian) {\r\n                    markers.addBillboard(cartesian);\r\n                    _self.stopDrawing();\r\n                    options.callback(cartesian, _self);\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(position, viewer);\r\n                if (cartesian) {\r\n                    tooltip.showAt(position, \"<p>Click to add your marker. Position is: </p>\" + getDisplayLatLngString(ellipsoid.cartesianToCartographic(cartesian)));\r\n                } else {\r\n                    tooltip.showAt(position, \"<p>Click on the globe to add your marker.</p>\");\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.startDrawingPolygon = function (options) {\r\n        // var options = copyOptions(options, defaultSurfaceOptions);\r\n        this.startDrawingPolyshape(true, options);\r\n    }\r\n\r\n    _.prototype.startDrawingPolyline = function (options) {\r\n        // var options = copyOptions(options, defaultPolylineOptions);\r\n        this.startDrawingPolyshape(false, options);\r\n    }\r\n\r\n    _.prototype.startDrawingPolyshape = function (isPolygon, options) {\r\n        options = isPolygon ? copyOptions(options, defaultSurfaceOptions) : copyOptions(options, defaultPolylineOptions);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                primitives && primitives.remove(poly);\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var minPoints = isPolygon ? 3 : 2;\r\n        var poly;\r\n        if (isPolygon) {\r\n            poly = new _.PolygonPrimitive(options);\r\n        } else {\r\n            poly = new _.PolylinePrimitive(options);\r\n        }\r\n        poly.asynchronous = false;\r\n        primitives.add(poly);\r\n\r\n        var positions = [];\r\n        var markers = new _.BillboardGroup(this, defaultBillboard);\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n\r\n            var position = movement.position;\r\n            if (position != null) {\r\n                if (positions.length < minPoints /*+ 2*/) {\r\n                    return;\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        _self.stopDrawing();\r\n                        if (typeof options.callback == 'function') {\r\n                            // remove overlapping ones\r\n                            var index = positions.length - 1;\r\n                            options.callback(positions, _self);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n\r\n            var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n            cartesian = getCesiumHightZero(cartesian);\r\n\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n\r\n                if (cartesian) {\r\n                    // first click\r\n                    if (positions.length == 0) {\r\n                        positions.push(cartesian.clone());\r\n                        markers.addBillboard(positions[0]);\r\n                    }\r\n                    if (positions.length >= minPoints) {\r\n                        poly.positions = positions;\r\n                        poly._createPrimitive = true;\r\n                    }\r\n                    // add new point to polygon\r\n                    // this one will move with the mouse\r\n                    positions.push(cartesian);\r\n                    // add marker at the new position\r\n                    markers.addBillboard(cartesian);\r\n                }\r\n            }\r\n\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (positions.length == 0) {\r\n                    tooltip.showAt(position, \"<p>Click to add first point</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    // var cartesian = scene.pickPosition(position);\r\n                    // cartesian = getCesiumHightZero(cartesian);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        positions.pop();\r\n                        // make sure it is slightly different\r\n                        // cartesian.y += (1 + Math.random());\r\n                        cartesian.y += Cesium.Math.EPSILON7;\r\n                        positions.push(cartesian);\r\n                        if (positions.length >= minPoints) {\r\n                            poly.positions = positions;\r\n                            poly._createPrimitive = true;\r\n                        }\r\n                        // update marker\r\n                        markers.getBillboard(positions.length - 1).position = cartesian;\r\n                        // show tooltip\r\n                        tooltip.showAt(position, \"<p>Click to add new point (\" + positions.length + \")</p>\" + (positions.length > minPoints ? \"<p>Double click to finish drawing</p>\" : \"\"));\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n\r\n    }\r\n\r\n    function getExtentCorners(value) {\r\n        return ellipsoid.cartographicArrayToCartesianArray([Cesium.Rectangle.northwest(value), Cesium.Rectangle.northeast(value), Cesium.Rectangle.southeast(value), Cesium.Rectangle.southwest(value)]);\r\n    }\r\n\r\n    _.prototype.startDrawingExtent = function (options) {\r\n\r\n        var options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n        this.startDrawing(\r\n            function () {\r\n                if (extent != null) {\r\n                    primitives && primitives.remove(extent);\r\n                }\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = this._scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var firstPoint = null;\r\n        var extent = null;\r\n        var markers = null;\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function updateExtent(value) {\r\n            if (extent == null) {\r\n                extent = new _.ExtentPrimitive({extent: value, material: options.material,});\r\n                extent.asynchronous = false;\r\n                primitives.add(extent);\r\n            }\r\n            extent.setExtent(value);\r\n            extent.rectangle = value;\r\n            // update the markers\r\n            var corners = getExtentCorners(value);\r\n            // create if they do not yet exist\r\n            if (markers == null) {\r\n                markers = new _.BillboardGroup(_self, defaultBillboard);\r\n                markers.addBillboards(corners);\r\n            } else {\r\n                markers.updateBillboardsPositions(corners);\r\n            }\r\n        }\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n\r\n                if (cartesian) {\r\n                    if (extent == null) {\r\n                        // create the rectangle\r\n                        firstPoint = ellipsoid.cartesianToCartographic(cartesian);\r\n                        var value = getExtent(firstPoint, firstPoint);\r\n                        updateExtent(value);\r\n                    } else {\r\n                        _self.stopDrawing();\r\n                        if (typeof options.callback == 'function') {\r\n                            options.callback(getExtent(firstPoint, ellipsoid.cartesianToCartographic(cartesian), _self));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (extent == null) {\r\n                    tooltip.showAt(position, \"<p>Click to start drawing rectangle</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        var value = getExtent(firstPoint, ellipsoid.cartesianToCartographic(cartesian));\r\n                        updateExtent(value);\r\n                        tooltip.showAt(position, \"<p>Drag to change rectangle extent</p><p>Click again to finish drawing</p>\");\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.startDrawingCircle = function (options) {\r\n\r\n        var options = copyOptions(options, defaultSurfaceOptions);\r\n\r\n        this.startDrawing(\r\n            function cleanUp() {\r\n                if (circle != null) {\r\n                    primitives && primitives.remove(circle);\r\n                }\r\n                markers && markers.remove();\r\n                mouseHandler && mouseHandler.destroy();\r\n                tooltip && tooltip.setVisible(false);\r\n            }\r\n        );\r\n\r\n        var _self = this;\r\n        var scene = this._scene;\r\n        var viewer = this._viewer;\r\n        var primitives = this._scene.primitives;\r\n        var tooltip = this._tooltip;\r\n\r\n        var circle = null;\r\n        var markers = null;\r\n\r\n        var mouseHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n\r\n        function pickPosition(position) {\r\n            if (Cesium.defined(viewer.scene.pick(position))) {\r\n                return getCesiumHightZero(viewer.scene.pickPosition(position));\r\n            } else {\r\n                return getCesiumHightZero(viewer.scene.camera.pickEllipsoid(position))\r\n            }\r\n        }\r\n\r\n\r\n        // Now wait for start\r\n        mouseHandler.setInputAction(function (movement) {\r\n            if (movement.position != null) {\r\n                // var cartesian = scene.camera.pickEllipsoid(movement.position, ellipsoid);\r\n                // var cartesian = scene.pickPosition(movement.position);\r\n                // cartesian = getCesiumHightZero(cartesian);\r\n                // var cartesian = pickPosition(movement.position);\r\n                var cartesian = options.strategy.pickStrategy(movement.position, viewer);\r\n                if (cartesian) {\r\n                    if (circle == null) {\r\n                        // create the circle\r\n                        circle = new _.CirclePrimitive({\r\n                            center: cartesian,\r\n                            radius: 0,\r\n                            asynchronous: false,\r\n                            material: options.material\r\n                        });\r\n                        primitives.add(circle);\r\n                        markers = new _.BillboardGroup(_self, defaultBillboard);\r\n                        markers.addBillboards([cartesian]);\r\n                    } else {\r\n                        if (typeof options.callback == 'function') {\r\n                            options.callback(circle.getCenter(), circle.getRadius(), _self);\r\n                        }\r\n                        _self.stopDrawing();\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n\r\n        mouseHandler.setInputAction(function (movement) {\r\n            var position = movement.endPosition;\r\n            if (position != null) {\r\n                if (circle == null) {\r\n                    tooltip.showAt(position, \"<p>Click to start drawing the circle</p>\");\r\n                } else {\r\n                    // var cartesian = scene.camera.pickEllipsoid(position, ellipsoid);\r\n                    // var cartesian = scene.pickPosition(position);\r\n                    var cartesian = options.strategy.pickStrategy(position, viewer);\r\n\r\n                    if (cartesian) {\r\n                        // Cesium.Cartographic.fromCartesian(circle.getCenter())\r\n                        circle.setRadius(Cesium.Cartesian3.distance(getCesiumHightZero(circle.getCenter()), getCesiumHightZero(cartesian)));\r\n                        // circle.setRadius(Cesium.Cartesian3.distance(circle.getCenter(), cartesian));\r\n                        markers.updateBillboardsPositions(cartesian);\r\n                        tooltip.showAt(position, \"<p>Move mouse to change circle radius</p><p>Click again to finish drawing</p>\");\r\n                    }\r\n                }\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n    }\r\n\r\n    _.prototype.enhancePrimitives = function () {\r\n\r\n        var drawHelper = this;\r\n\r\n        Cesium.Billboard.prototype.setEditable = function () {\r\n\r\n            if (this._editable) {\r\n                return;\r\n            }\r\n\r\n            this._editable = true;\r\n\r\n            var billboard = this;\r\n\r\n            var _self = this;\r\n\r\n            function enableRotation(enable) {\r\n                drawHelper._scene.screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            setListener(billboard, 'leftDown', function (position) {\r\n                // TODO - start the drag handlers here\r\n                // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                function onDrag(position) {\r\n                    billboard.position = position;\r\n                    _self.executeListeners({name: 'drag', positions: position});\r\n                }\r\n\r\n                function onDragEnd(position) {\r\n                    handler.destroy();\r\n                    enableRotation(true);\r\n                    _self.executeListeners({name: 'dragEnd', positions: position});\r\n                }\r\n\r\n                var handler = new Cesium.ScreenSpaceEventHandler(drawHelper._scene.canvas);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    var cartesian = drawHelper._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                    if (cartesian) {\r\n                        onDrag(cartesian);\r\n                    } else {\r\n                        onDragEnd(cartesian);\r\n                    }\r\n                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    onDragEnd(drawHelper._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                enableRotation(false);\r\n\r\n            });\r\n\r\n            enhanceWithListeners(billboard);\r\n\r\n        }\r\n\r\n        Cesium.Entity.prototype.setEditable = function (editable) {\r\n            if(editable ===  false){\r\n                var billboard = this;\r\n                removeListener(billboard,'leftDown');\r\n                this._editable = false;\r\n                return;\r\n            }\r\n\r\n            if (this.modeType !== 'billboard' || this._editable) {\r\n                return;\r\n            }\r\n\r\n            this._editable = true;\r\n\r\n            var billboard = this;\r\n\r\n            var _self = this;\r\n\r\n            function enableRotation(enable) {\r\n                drawHelper._scene.screenSpaceCameraController.enableRotate = enable;\r\n            }\r\n\r\n            setListener(billboard, 'leftDown', function (position) {\r\n                // TODO - start the drag handlers here\r\n                // create handlers for mouseOut and leftUp for the billboard and a mouseMove\r\n                function onDrag(position) {\r\n                    billboard.position = position;\r\n                    _self.executeListeners({name: 'drag', positions: position});\r\n                }\r\n\r\n                function onDragEnd(position) {\r\n                    handler.destroy();\r\n                    enableRotation(true);\r\n                    _self.executeListeners({name: 'dragEnd', positions: position});\r\n                }\r\n\r\n                var handler = new Cesium.ScreenSpaceEventHandler(drawHelper._scene.canvas);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    var cartesian = drawHelper._scene.camera.pickEllipsoid(movement.endPosition, ellipsoid);\r\n                    if (cartesian) {\r\n                        onDrag(cartesian);\r\n                    } else {\r\n                        onDragEnd(cartesian);\r\n                    }\r\n                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n                handler.setInputAction(function (movement) {\r\n                    onDragEnd(drawHelper._scene.camera.pickEllipsoid(movement.position, ellipsoid));\r\n                }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n                enableRotation(false);\r\n\r\n            });\r\n\r\n            enhanceWithListeners(billboard);\r\n        }\r\n\r\n        function setHighlighted(highlighted) {\r\n\r\n            var scene = drawHelper._scene;\r\n\r\n            // if no change\r\n            // if already highlighted, the outline polygon will be available\r\n            if (this._highlighted && this._highlighted == highlighted) {\r\n                return;\r\n            }\r\n            // disable if already in edit mode\r\n            if (this._editMode === true) {\r\n                return;\r\n            }\r\n            this._highlighted = highlighted;\r\n            // highlight by creating an outline polygon matching the polygon points\r\n            if (highlighted) {\r\n                // make sure all other shapes are not highlighted\r\n                drawHelper.setHighlighted(this);\r\n                this._strokeColor = this.strokeColor;\r\n                this.setStrokeStyle(Cesium.Color.fromCssColorString('white'), this.strokeWidth);\r\n            } else {\r\n                if (this._strokeColor) {\r\n                    this.setStrokeStyle(this._strokeColor, this.strokeWidth);\r\n                } else {\r\n                    this.setStrokeStyle(undefined, undefined);\r\n                }\r\n            }\r\n        }\r\n\r\n        function setEditMode(editMode) {\r\n            // if no change\r\n            if (this._editMode == editMode) {\r\n                return;\r\n            }\r\n            // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n            drawHelper.disableAllHighlights();\r\n            // display markers\r\n            if (editMode) {\r\n                drawHelper.setEdited(this);\r\n                var scene = drawHelper._scene;\r\n                var _self = this;\r\n                // create the markers and handlers for the editing\r\n                if (this._markers == null) {\r\n                    var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n                    var thisDragHalfBillboard = this.dragHalfBillboard? this.dragHalfBillboard: dragBillboard;\r\n                    var markers = new _.BillboardGroup(drawHelper, thisDragBillboard);\r\n                    var editMarkers = new _.BillboardGroup(drawHelper, thisDragHalfBillboard);\r\n\r\n                    // function for updating the edit markers around a certain point\r\n                    function updateHalfMarkers(index, positions) {\r\n                        // update the half markers before and after the index\r\n                        var editIndex = index - 1 < 0 ? positions.length - 1 : index - 1;\r\n                        if (editIndex < editMarkers.countBillboards()) {\r\n                            editMarkers.getBillboard(editIndex).position = calculateHalfMarkerPosition(editIndex);\r\n                        }\r\n                        editIndex = index;\r\n                        if (editIndex < editMarkers.countBillboards()) {\r\n                            editMarkers.getBillboard(editIndex).position = calculateHalfMarkerPosition(editIndex);\r\n                        }\r\n                    }\r\n\r\n                    function onEdited() {\r\n                        _self.executeListeners({name: 'onEdited', positions: _self.positions});\r\n                    }\r\n\r\n                    var handleMarkerChanges = {\r\n                        dragHandlers: {\r\n                            onDrag: function (index, position) {\r\n                                _self.positions[index] = position;\r\n                                updateHalfMarkers(index, _self.positions);\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDragEnd: function (index, position) {\r\n                                _self._createPrimitive = true;\r\n                                onEdited();\r\n                            }\r\n                        },\r\n                        onDoubleClick: function (index) {\r\n                            if (_self.positions.length < 4) {\r\n                                return;\r\n                            }\r\n                            // remove the point and the corresponding markers\r\n                            _self.positions.splice(index, 1);\r\n                            _self._createPrimitive = true;\r\n                            markers.removeBillboard(index);\r\n                            editMarkers.removeBillboard(index);\r\n                            updateHalfMarkers(index, _self.positions);\r\n                            onEdited();\r\n                        },\r\n                        tooltip: function () {\r\n                            if (_self.positions.length > 3) {\r\n                                return \"Double click to remove this point\";\r\n                            }\r\n                        }\r\n                    };\r\n                    // add billboards and keep an ordered list of them for the polygon edges\r\n                    markers.addBillboards(_self.positions, handleMarkerChanges);\r\n                    this._markers = markers;\r\n\r\n                    function calculateHalfMarkerPosition(index) {\r\n                        var positions = _self.positions;\r\n                        return ellipsoid.cartographicToCartesian(\r\n                            new Cesium.EllipsoidGeodesic(ellipsoid.cartesianToCartographic(positions[index]),\r\n                                ellipsoid.cartesianToCartographic(positions[index < positions.length - 1 ? index + 1 : 0])).interpolateUsingFraction(0.5)\r\n                        );\r\n                    }\r\n\r\n                    var halfPositions = [];\r\n                    var index = 0;\r\n                    var length = _self.positions.length + (this.isPolygon ? 0 : -1);\r\n                    for (; index < length; index++) {\r\n                        halfPositions.push(calculateHalfMarkerPosition(index));\r\n                    }\r\n                    var handleEditMarkerChanges = {\r\n                        dragHandlers: {\r\n                            onDragStart: function (index, position) {\r\n                                // add a new position to the polygon but not a new marker yet\r\n                                this.index = index + 1;\r\n                                _self.positions.splice(this.index, 0, position);\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDrag: function (index, position) {\r\n                                _self.positions[this.index] = position;\r\n                                _self._createPrimitive = true;\r\n                            },\r\n                            onDragEnd: function (index, position) {\r\n                                // create new sets of makers for editing\r\n                                markers.insertBillboard(this.index, position, handleMarkerChanges);\r\n                                editMarkers.getBillboard(this.index - 1).position = calculateHalfMarkerPosition(this.index - 1);\r\n                                editMarkers.insertBillboard(this.index, calculateHalfMarkerPosition(this.index), handleEditMarkerChanges);\r\n                                _self._createPrimitive = true;\r\n                                onEdited();\r\n                            }\r\n                        },\r\n                        tooltip: function () {\r\n                            return \"Drag to create a new point\";\r\n                        }\r\n                    };\r\n                    editMarkers.addBillboards(halfPositions, handleEditMarkerChanges);\r\n                    this._editMarkers = editMarkers;\r\n                    // add a handler for clicking in the globe\r\n                    this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                    this._globeClickhandler.setInputAction(\r\n                        function (movement) {\r\n                            var pickedObject = scene.pick(movement.position);\r\n                            if (!(pickedObject && pickedObject.primitive)) {\r\n                                _self.setEditMode(false);\r\n                            }\r\n                        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                    // set on top of the polygon\r\n                    markers.setOnTop();\r\n                    editMarkers.setOnTop();\r\n                }\r\n                this._editMode = true;\r\n            } else {\r\n                if (this._markers != null) {\r\n                    this._markers.remove();\r\n                    this._editMarkers.remove();\r\n                    this._markers = null;\r\n                    this._editMarkers = null;\r\n                    this._globeClickhandler.destroy();\r\n                }\r\n                this._editMode = false;\r\n            }\r\n\r\n        }\r\n\r\n        _.PolylinePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var polyline = this;\r\n            polyline.isPolygon = false;\r\n            polyline.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(polyline);\r\n\r\n            polyline.setEditMode = setEditMode;\r\n\r\n            var originalWidth = this.width;\r\n\r\n            polyline.setHighlighted = function (highlighted) {\r\n                // disable if already in edit mode\r\n                if (this._editMode === true) {\r\n                    return;\r\n                }\r\n                if (highlighted) {\r\n                    drawHelper.setHighlighted(this);\r\n                    this.setWidth(originalWidth * 2);\r\n                } else {\r\n                    this.setWidth(originalWidth);\r\n                }\r\n            }\r\n\r\n            polyline.getExtent = function () {\r\n                return Cesium.Extent.fromCartographicArray(ellipsoid.cartesianArrayToCartographicArray(this.positions));\r\n            }\r\n\r\n            enhanceWithListeners(polyline);\r\n\r\n            polyline.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.PolygonPrimitive.prototype.setEditable = function () {\r\n\r\n            var polygon = this;\r\n            polygon.asynchronous = false;\r\n\r\n            var scene = drawHelper._scene;\r\n\r\n            drawHelper.registerEditableShape(polygon);\r\n\r\n            polygon.setEditMode = setEditMode;\r\n\r\n            polygon.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(polygon);\r\n\r\n            polygon.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.ExtentPrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var extent = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            drawHelper.registerEditableShape(extent);\r\n            extent.asynchronous = false;\r\n\r\n            extent.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n                        var thisDragHalfBillboard = this.dragHalfBillboard? this.dragHalfBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(thisDragBillboard,thisDragHalfBillboard);\r\n\r\n                        function onEdited() {\r\n                            extent.executeListeners({name: 'onEdited', extent: extent.extent});\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    var corner = markers.getBillboard((index + 2) % 4).position;\r\n                                    extent.setExtent(getExtent(ellipsoid.cartesianToCartographic(corner), ellipsoid.cartesianToCartographic(position)));\r\n                                    markers.updateBillboardsPositions(getExtentCorners(extent.extent));\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the corners of this extent\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getExtentCorners(extent.extent), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                // disable edit if pickedobject is different or not an object\r\n                                try {\r\n                                    if (!(pickedObject && !pickedObject.isDestroyed() && pickedObject.primitive)) {\r\n                                        extent.setEditMode(false);\r\n                                    }\r\n                                } catch (e) {\r\n                                    extent.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            extent.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(extent);\r\n\r\n            extent.setEditMode(false);\r\n\r\n        }\r\n\r\n        _.EllipsePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var ellipse = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            ellipse.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(ellipse);\r\n\r\n            ellipse.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    var _self = this;\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(drawHelper,thisDragBillboard );\r\n\r\n                        function getMarkerPositions() {\r\n                            return Cesium.Shapes.computeEllipseBoundary(ellipsoid, ellipse.getCenter(), ellipse.getSemiMajorAxis(), ellipse.getSemiMinorAxis(), ellipse.getRotation() + Math.PI / 2, Math.PI / 2.0).splice(0, 4);\r\n                        }\r\n\r\n                        function onEdited() {\r\n                            ellipse.executeListeners({\r\n                                name: 'onEdited',\r\n                                center: ellipse.getCenter(),\r\n                                semiMajorAxis: ellipse.getSemiMajorAxis(),\r\n                                semiMinorAxis: ellipse.getSemiMinorAxis(),\r\n                                rotation: 0\r\n                            });\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    var distance = Cesium.Cartesian3.distance(ellipse.getCenter(), position);\r\n                                    if (index % 2 == 0) {\r\n                                        ellipse.setSemiMajorAxis(distance);\r\n                                    } else {\r\n                                        ellipse.setSemiMinorAxis(distance);\r\n                                    }\r\n                                    markers.updateBillboardsPositions(getMarkerPositions());\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the excentricity and radius\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getMarkerPositions(), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                if (!(pickedObject && pickedObject.primitive)) {\r\n                                    _self.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            ellipse.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(ellipse);\r\n\r\n            ellipse.setEditMode(false);\r\n        }\r\n\r\n        _.CirclePrimitive.prototype.getCircleCartesianCoordinates = function (granularity) {\r\n            var geometry = Cesium.CircleOutlineGeometry.createGeometry(new Cesium.CircleOutlineGeometry({\r\n                ellipsoid: ellipsoid,\r\n                center: this.getCenter(),\r\n                radius: this.getRadius(),\r\n                granularity: granularity\r\n            }));\r\n            var count = 0, value, values = [];\r\n            for (; count < geometry.attributes.position.values.length; count += 3) {\r\n                value = geometry.attributes.position.values;\r\n                values.push(new Cesium.Cartesian3(value[count], value[count + 1], value[count + 2]));\r\n            }\r\n            return values;\r\n        };\r\n\r\n        _.CirclePrimitive.prototype.setEditable = function () {\r\n\r\n            if (this.setEditMode) {\r\n                return;\r\n            }\r\n\r\n            var circle = this;\r\n            var scene = drawHelper._scene;\r\n\r\n            circle.asynchronous = false;\r\n\r\n            drawHelper.registerEditableShape(circle);\r\n\r\n            circle.setEditMode = function (editMode) {\r\n                // if no change\r\n                if (this._editMode == editMode) {\r\n                    return;\r\n                }\r\n                drawHelper.disableAllHighlights();\r\n                // display markers\r\n                if (editMode) {\r\n                    // make sure all other shapes are not in edit mode before starting the editing of this shape\r\n                    drawHelper.setEdited(this);\r\n                    var _self = this;\r\n                    // create the markers and handlers for the editing\r\n                    if (this._markers == null) {\r\n                        var thisDragBillboard = this.dragBillboard? this.dragBillboard: dragBillboard;\r\n\r\n                        var markers = new _.BillboardGroup(drawHelper, thisDragBillboard);\r\n\r\n                        function getMarkerPositions() {\r\n                            // return _self.getCircleCartesianCoordinates(Cesium.Math.PI_OVER_TWO);\r\n                            return _self.getCircleCartesianCoordinates(Cesium.Math.PI_OVER_TWO);\r\n                        }\r\n\r\n                        function onEdited() {\r\n                            circle.executeListeners({\r\n                                name: 'onEdited',\r\n                                center: circle.getCenter(),\r\n                                radius: circle.getRadius()\r\n                            });\r\n                        }\r\n\r\n                        var handleMarkerChanges = {\r\n                            dragHandlers: {\r\n                                onDrag: function (index, position) {\r\n                                    circle.setRadius(Cesium.Cartesian3.distance(circle.getCenter(), position));\r\n                                    markers.updateBillboardsPositions(getMarkerPositions());\r\n                                },\r\n                                onDragEnd: function (index, position) {\r\n                                    onEdited();\r\n                                }\r\n                            },\r\n                            tooltip: function () {\r\n                                return \"Drag to change the radius\";\r\n                            }\r\n                        };\r\n                        markers.addBillboards(getMarkerPositions(), handleMarkerChanges);\r\n                        this._markers = markers;\r\n                        // add a handler for clicking in the globe\r\n                        this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);\r\n                        this._globeClickhandler.setInputAction(\r\n                            function (movement) {\r\n                                var pickedObject = scene.pick(movement.position);\r\n                                if (!(pickedObject && pickedObject.primitive)) {\r\n                                    _self.setEditMode(false);\r\n                                }\r\n                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n                        // set on top of the polygon\r\n                        markers.setOnTop();\r\n                    }\r\n                    this._editMode = true;\r\n                } else {\r\n                    if (this._markers != null) {\r\n                        this._markers.remove();\r\n                        this._markers = null;\r\n                        this._globeClickhandler.destroy();\r\n                    }\r\n                    this._editMode = false;\r\n                }\r\n            }\r\n\r\n            circle.setHighlighted = setHighlighted;\r\n\r\n            enhanceWithListeners(circle);\r\n\r\n            circle.setEditMode(false);\r\n        }\r\n\r\n    }\r\n\r\n    _.DrawHelperWidget = (function () {\r\n\r\n        // constructor\r\n        function _(drawHelper, options) {\r\n\r\n            // container must be specified\r\n            if (!(Cesium.defined(options.container))) {\r\n                throw new Cesium.DeveloperError('Container is required');\r\n            }\r\n\r\n            var drawOptions = {\r\n                // markerIcon: \"./img/glyphicons_242_google_maps.png\",\r\n                // polylineIcon: \"./img/glyphicons_097_vector_path_line.png\",\r\n                // polygonIcon: \"./img/glyphicons_096_vector_path_polygon.png\",\r\n                // circleIcon: \"./img/glyphicons_095_vector_path_circle.png\",\r\n                // extentIcon: \"./img/glyphicons_094_vector_path_square.png\",\r\n                // clearIcon: \"./img/glyphicons_067_cleaning.png\",\r\n                markerIcon: \" marker\",\r\n                polylineIcon: \" polyline\",\r\n                polygonIcon: \" polygon\",\r\n                circleIcon: \" circle\",\r\n                extentIcon: \" extent\",\r\n                clearIcon: \" clear\",\r\n                polylineDrawingOptions: defaultPolylineOptions,\r\n                polygonDrawingOptions: defaultPolygonOptions,\r\n                extentDrawingOptions: defaultExtentOptions,\r\n                circleDrawingOptions: defaultCircleOptions,\r\n                strategy: {\r\n                    pickStrategy: options.pickStrategy ? options.pickStrategy : defaultPickStrategy\r\n                }\r\n            };\r\n\r\n            fillOptions(options, drawOptions);\r\n\r\n            var _self = this;\r\n\r\n            var toolbar = document.createElement('DIV');\r\n            toolbar.className = \"toolbar\";\r\n            options.container.appendChild(toolbar);\r\n\r\n            function addIcon(id, url, title, callback) {\r\n                var div = document.createElement('DIV');\r\n                div.className = 'button' + url;\r\n                div.title = title;\r\n                toolbar.appendChild(div);\r\n                div.onclick = callback;\r\n                // var span = document.createElement('SPAN');\r\n                // div.appendChild(span);\r\n                // var image = document.createElement('IMG');\r\n                // image.src = url;\r\n                // span.appendChild(image);\r\n                return div;\r\n            }\r\n\r\n            var scene = drawHelper._scene;\r\n            // console.log(options.buttons)\r\n\r\n            options.buttons.indexOf(\"marker\") !== -1 && addIcon('marker', options.markerIcon, 'Click to start drawing a 2D marker', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'markerClick'\r\n                });\r\n\r\n                drawHelper.startDrawingMarker({\r\n                    callback: function (position) {\r\n                        _self.executeListeners({name: 'markerCreated', position: position});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"polyline\") !== -1 && addIcon('polyline', options.polylineIcon, 'Click to start drawing a 2D polyline', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'polylineClick'\r\n                });\r\n\r\n                drawHelper.startDrawingPolyline({\r\n                    callback: function (positions) {\r\n                        _self.executeListeners({name: 'polylineCreated', positions: positions});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"polygon\") !== -1 && addIcon('polygon', options.polygonIcon, 'Click to start drawing a 2D polygon', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'polygonClick'\r\n                });\r\n\r\n                drawHelper.startDrawingPolygon({\r\n                    callback: function (positions) {\r\n                        _self.executeListeners({name: 'polygonCreated', positions: positions});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"extent\") !== -1 && addIcon('extent', options.extentIcon, 'Click to start drawing an Extent', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'extentClick'\r\n                });\r\n\r\n                drawHelper.startDrawingExtent({\r\n                    callback: function (extent) {\r\n                        _self.executeListeners({name: 'extentCreated', extent: extent});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            options.buttons.indexOf(\"circle\") !== -1 && addIcon('circle', options.circleIcon, 'Click to start drawing a Circle', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'circleClick'\r\n                });\r\n\r\n                drawHelper.startDrawingCircle({\r\n                    callback: function (center, radius) {\r\n                        _self.executeListeners({name: 'circleCreated', center: center, radius: radius});\r\n                    },\r\n                    strategy: options.strategy\r\n                });\r\n            })\r\n\r\n            // add a clear button at the end\r\n            // add a divider first\r\n            var div = document.createElement('DIV');\r\n            div.className = 'divider';\r\n            toolbar.appendChild(div);\r\n\r\n            options.buttons.indexOf(\"clear\") !== -1 &&\r\n            addIcon('clear', options.clearIcon, 'Remove all primitives', function () {\r\n                typeof options.clickCallback === 'function' &&\r\n                options.clickCallback({\r\n                    name: 'clearClick'\r\n                });\r\n\r\n                scene.primitives.removeAll();\r\n            });\r\n\r\n            enhanceWithListeners(this);\r\n\r\n        }\r\n\r\n\r\n        return _;\r\n\r\n    })();\r\n\r\n    /**\r\n     * 新增工具栏点击回调\r\n     * @param container\r\n     * @param options\r\n     * @param {function(event)} options.clickCallback - event.name包括${toolbarName}Click\r\n     * @returns {_|*}\r\n     */\r\n    _.prototype.addToolbar = function (container, options) {\r\n        options = copyOptions(options, {container: container});\r\n        return new _.DrawHelperWidget(this, options);\r\n    }\r\n\r\n    function getExtent(mn, mx) {\r\n        var e = new Cesium.Rectangle();\r\n\r\n        // Re-order so west < east and south < north\r\n        e.west = Math.min(mn.longitude, mx.longitude);\r\n        e.east = Math.max(mn.longitude, mx.longitude);\r\n        e.south = Math.min(mn.latitude, mx.latitude);\r\n        e.north = Math.max(mn.latitude, mx.latitude);\r\n\r\n        // Check for approx equal (shouldn't require abs due to re-order)\r\n        var epsilon = Cesium.Math.EPSILON7;\r\n\r\n        if ((e.east - e.west) < epsilon) {\r\n            e.east += epsilon * 2.0;\r\n        }\r\n\r\n        if ((e.north - e.south) < epsilon) {\r\n            e.north += epsilon * 2.0;\r\n        }\r\n\r\n        return e;\r\n    };\r\n\r\n    function createTooltip(frameDiv) {\r\n\r\n        var tooltip = function (frameDiv) {\r\n\r\n            var div = document.createElement('DIV');\r\n            div.className = \"twipsy right\";\r\n\r\n            var arrow = document.createElement('DIV');\r\n            arrow.className = \"twipsy-arrow\";\r\n            div.appendChild(arrow);\r\n\r\n            var title = document.createElement('DIV');\r\n            title.className = \"twipsy-inner\";\r\n\r\n            div.appendChild(title);\r\n\r\n            this._div = div;\r\n            this._title = title;\r\n\r\n            // add to frame div and display coordinates\r\n            frameDiv.appendChild(div);\r\n            this.addEvent();\r\n            this.setVisible(false);\r\n        }\r\n\r\n        tooltip.prototype.setVisible = function (visible) {\r\n            this._div.style.display = visible ? 'block' : 'none';\r\n        }\r\n\r\n        tooltip.prototype.showAt = function (position, message) {\r\n            if (position && message) {\r\n                this.setVisible(true);\r\n                this._title.innerHTML = message;\r\n                // this._div.style.left = position.x + 10 + \"px\";\r\n                // this._div.style.top = (position.y - this._div.clientHeight / 2) + \"px\";\r\n            }\r\n        }\r\n\r\n        tooltip.prototype.show = function (message) {\r\n            if (message) {\r\n                this.setVisible(true);\r\n                this._title.innerHTML = message;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * 解决拖动到tip上时宕机的问题\r\n         */\r\n        tooltip.prototype.addEvent = function () {\r\n            var me = this;\r\n            var count = 0;\r\n            document.body.addEventListener(\"mousemove\", function (ev) {\r\n                if (me._div.style.display === 'block' && (count = ((count++) % 3)) === 0) {\r\n                    me._div.style.left = ev.offsetX + 20 + \"px\";\r\n                    me._div.style.top = (ev.offsetY - me._div.clientHeight / 2) + \"px\";\r\n                }\r\n            })\r\n        }\r\n\r\n        return new tooltip(frameDiv);\r\n    }\r\n\r\n    function getDisplayLatLngString(cartographic, precision) {\r\n        return cartographic.longitude.toFixed(precision || 3) + \", \" + cartographic.latitude.toFixed(precision || 3);\r\n    }\r\n\r\n    function clone(from, to) {\r\n        if (from == null || typeof from != \"object\") return from;\r\n        if (from.constructor != Object && from.constructor != Array) return from;\r\n        if (from.constructor == Date || from.constructor == RegExp || from.constructor == Function ||\r\n            from.constructor == String || from.constructor == Number || from.constructor == Boolean)\r\n            return new from.constructor(from);\r\n\r\n        to = to || new from.constructor();\r\n\r\n        for (var name in from) {\r\n            to[name] = typeof to[name] == \"undefined\" ? clone(from[name], null) : to[name];\r\n        }\r\n\r\n        return to;\r\n    }\r\n\r\n    function fillOptions(options, defaultOptions) {\r\n        options = options || {};\r\n        var option;\r\n        for (option in defaultOptions) {\r\n            if (options[option] === undefined) {\r\n                options[option] = clone(defaultOptions[option]);\r\n            }\r\n        }\r\n    }\r\n\r\n    // shallow copy\r\n    function copyOptions(options, defaultOptions) {\r\n        var newOptions = clone(options), option;\r\n        for (option in defaultOptions) {\r\n            if (newOptions[option] === undefined) {\r\n                newOptions[option] = clone(defaultOptions[option]);\r\n            }\r\n        }\r\n        return newOptions;\r\n    }\r\n\r\n    function extendOptions(options, defaultOptions) {\r\n        var newOptions = clone(options), option;\r\n        for (option in defaultOptions) {\r\n            newOptions[option] = clone(defaultOptions[option]);\r\n        }\r\n        return newOptions;\r\n    }\r\n\r\n    function setListener(primitive, type, callback) {\r\n        primitive[type] = callback;\r\n    }\r\n\r\n    function removeListener(primitive, type) {\r\n        delete primitive[type];\r\n    }\r\n\r\n    function enhanceWithListeners(element) {\r\n\r\n        element._listeners = {};\r\n\r\n        element.addListener = function (name, callback) {\r\n            this._listeners[name] = (this._listeners[name] || []);\r\n            this._listeners[name].push(callback);\r\n            return this._listeners[name].length;\r\n        }\r\n\r\n        element.executeListeners = function (event, defaultCallback) {\r\n            if (this._listeners[event.name] && this._listeners[event.name].length > 0) {\r\n                var index = 0;\r\n                for (; index < this._listeners[event.name].length; index++) {\r\n                    this._listeners[event.name][index](event);\r\n                }\r\n            } else {\r\n                if (defaultCallback) {\r\n                    defaultCallback(event);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 获取当前点位的近地点位\r\n     * @param {Cesium.Cartesian3} cesium3\r\n     * @returns {Cesium.Cartesian3}\r\n     */\r\n    function getCesiumHightZero(cesium3) {\r\n        var fromCartesian = Cesium.Cartographic.fromCartesian(cesium3);\r\n        return Cesium.Cartesian3.fromRadians(fromCartesian.longitude, fromCartesian.latitude, 0);\r\n    }\r\n\r\n\r\n    return _;\r\n}));","module.exports = function(module) {\r\n\tif (!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n"],"sourceRoot":""}